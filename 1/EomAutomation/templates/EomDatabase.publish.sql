/*
Deployment script for DA_Monthly_Accounting

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar EomToolSecurity "EomToolSecurity"
:setvar DatabaseName "{%DATABASE_NAME%}"
:setvar DefaultFilePrefix "{%DATABASE_NAME%}"
:setvar DefaultDataPath "D:\Microsoft SQL Server\MSSQL11.SQLEXPRESS\MSSQL\DATA\"
:setvar DefaultLogPath "D:\Microsoft SQL Server\MSSQL11.SQLEXPRESS\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [master];


GO

IF (DB_ID(N'$(DatabaseName)') IS NOT NULL)
BEGIN
    raiserror(N'Target database [$(DatabaseName)] already exists. Script execution will be aborted', 20, -1) with log
END
GO

PRINT N'Creating $(DatabaseName)...'
GO
CREATE DATABASE [$(DatabaseName)]
    ON 
    PRIMARY(NAME = [$(DatabaseName)], FILENAME = N'$(DefaultDataPath)$(DefaultFilePrefix)_Primary.mdf')
    LOG ON (NAME = [$(DatabaseName)_log], FILENAME = N'$(DefaultLogPath)$(DefaultFilePrefix)_Primary.ldf') COLLATE SQL_Latin1_General_CP1_CI_AS
GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                NUMERIC_ROUNDABORT OFF,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL,
                RECOVERY FULL,
                CURSOR_CLOSE_ON_COMMIT OFF,
                AUTO_CREATE_STATISTICS ON,
                AUTO_SHRINK OFF,
                AUTO_UPDATE_STATISTICS ON,
                RECURSIVE_TRIGGERS OFF 
            WITH ROLLBACK IMMEDIATE;
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_CLOSE OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET READ_COMMITTED_SNAPSHOT OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET AUTO_UPDATE_STATISTICS_ASYNC OFF,
                PAGE_VERIFY NONE,
                DATE_CORRELATION_OPTIMIZATION OFF,
                DISABLE_BROKER,
                PARAMETERIZATION SIMPLE,
                SUPPLEMENTAL_LOGGING OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET TRUSTWORTHY OFF,
        DB_CHAINING OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
IF IS_SRVROLEMEMBER(N'sysadmin') = 1
    BEGIN
        IF EXISTS (SELECT 1
                   FROM   [master].[dbo].[sysdatabases]
                   WHERE  [name] = N'$(DatabaseName)')
            BEGIN
                EXECUTE sp_executesql N'ALTER DATABASE [$(DatabaseName)]
    SET HONOR_BROKER_PRIORITY OFF 
    WITH ROLLBACK IMMEDIATE';
            END
    END
ELSE
    BEGIN
        PRINT N'The database settings cannot be modified. You must be a SysAdmin to apply these settings.';
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET FILESTREAM(NON_TRANSACTED_ACCESS = OFF),
                CONTAINMENT = NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO




IF fulltextserviceproperty(N'IsFulltextInstalled') = 1
    EXECUTE sp_fulltext_database 'enable';


GO
PRINT N'Creating [accounting]...';


GO
CREATE USER [accounting] FOR LOGIN [DIRECTAGENTS\Accounting];


GO
REVOKE CONNECT TO [accounting];


GO
PRINT N'Creating [accountManagersOnly]...';


GO
CREATE USER [accountManagersOnly] FOR LOGIN [DIRECTAGENTS\AccountManagersOnly];


GO
REVOKE CONNECT TO [accountManagersOnly];


GO
PRINT N'Creating [DIRECTAGENTS\MConahan]...';


GO
CREATE USER [DIRECTAGENTS\MConahan] FOR LOGIN [DIRECTAGENTS\MConahan];


GO
REVOKE CONNECT TO [DIRECTAGENTS\MConahan];


GO
PRINT N'Creating [DIRECTAGENTS\MGlauberson]...';


GO
CREATE USER [DIRECTAGENTS\MGlauberson] FOR LOGIN [DIRECTAGENTS\MGlauberson];


GO
REVOKE CONNECT TO [DIRECTAGENTS\MGlauberson];


GO
PRINT N'Creating <unnamed>...';


GO
EXECUTE sp_addrolemember @rolename = N'db_datareader', @membername = N'accountManagersOnly';


GO
PRINT N'Creating <unnamed>...';


GO
EXECUTE sp_addrolemember @rolename = N'db_datawriter', @membername = N'accountManagersOnly';


GO
PRINT N'Creating <unnamed>...';


GO
EXECUTE sp_addrolemember @rolename = N'db_owner', @membername = N'accounting';


GO
PRINT N'Creating [DADatabaseSqlServer]...';


GO
CREATE ASSEMBLY [DADatabaseSqlServer]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300578A544D0000000000000000E00002210B0108000032000000060000000000005E51000000200000006000000000400000200000000200000400000000000000040000000000000000A0000000020000000000000300408500001000001000000000100000100000000000001000000000000000000000000C5100004F00000000600000D003000000000000000000000000000000000000008000000C000000885000001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000064310000002000000032000000020000000000000000000000000000200000602E72737263000000D0030000006000000004000000340000000000000000000000000000400000402E72656C6F6300000C00000000800000000200000038000000000000000000000000000040000042000000000000000000000000000000004051000000000000480000000200050048260000402A000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003E0002166A281100000A7D010000042A133003003000000001000011000F01281200000A16FE010A062D03002B1D02257B010000040F01281300000A281400000A281500000A7D010000042A6A0002257B010000040F017B01000004281500000A7D010000042A00133001000C0000000200001100027B010000040A2B00062A1B3003009C0000000300001100281700000A6F1800000A17FE01130511052D060038810000007201000070731900000A0A72310000706F1A00000A0B0706731B00000A0C066F1C00000A00086F1D00000AA5220000010D0916FE0216FE01130511052D3800281E00000A13040872060100706F1A00000A6F1F00000A00001104086F2000000A0000DE05260000DE0000282100000A6F2200000A000072780100706F1A00000A0B2A01100000000071000D7E00050100000113300300270100000400001100281700000A6F1800000A18FE01130611062D0600380C010000281700000A1F0E6F2300000A0A281700000A1F0F6F2300000A0B062D060716FE012B0116130611062D2700726D02007028080000060C0816FE0216FE01130611062D0D00729A070070280900000600000072DA07007028080000060D09172E06091AFE012B0117130611062D72001613042B570011041F0E2E0B11041F0FFE0116FE012B0116130611062D03002B35281700000A11046F2300000A16FE01130611062D1F00723608007011048C22000001726A080070282400000A2809000006002B49001104175813041104281700000A6F2500000AFE04130611062D9500726E08007028080000061305072C0A11051BFE0116FE012B0117130611062D0D0072CC080070280700000600002A001B3003004D00000005000011007201000070731900000A0A000206731B00000A0B00066F1C00000A00076F2600000A2600DE100714FE010C082D07076F2700000A00DC0000DE100614FE010C082D07066F2700000A00DC002A000000011C000002001500122700100000000002000C002F3B0010000000001B3003005400000006000011007201000070731900000A0A000206731B00000A0B00066F1C00000A00076F1D00000AA5220000010C080DDE240714FE01130411042D07076F2700000A00DC0614FE01130411042D07066F2700000A00DC00092A011C000002001500182D00120000000002000C00333F0012000000001B3002004400000007000011000002280A000006732800000A0A00281E00000A066F2000000A0000DE100614FE010B072D07066F2700000A00DC0000DE05260000DE0000282100000A6F2200000A002A011C000002000E00101E00100000000000000100313200050100000113300200110000000800001100725B0A007002282900000A0A2B00062A1E02282A00000A2A000000133001000F0000000800001100728B0A00700A06280E000006002A00133001000F000000080000110072A61300700A06280E000006002A001B3003004D00000005000011007201000070731900000A0A000206731B00000A0B00066F1C00000A00076F2600000A2600DE100714FE010C082D07076F2700000A00DC0000DE100614FE010C082D07066F2700000A00DC002A000000011C000002001500122700100000000002000C002F3B0010000000001B3003005400000006000011007201000070731900000A0A000206731B00000A0B00066F1C00000A00076F1D00000AA5220000010C080DDE240714FE01130411042D07076F2700000A00DC0614FE01130411042D07066F2700000A00DC00092A011C000002001500182D00120000000002000C00333F0012000000001B30020044000000070000110000022811000006732800000A0A00281E00000A066F2000000A0000DE100614FE010B072D07066F2700000A00DC0000DE05260000DE0000282100000A6F2200000A002A011C000002000E00101E00100000000000000100313200050100000113300200110000000800001100725B0A007002282900000A0A2B00062A1E02282A00000A2A0000001330050030000000090000110072D91B0070282C00000A72E51B0070178D010000010B0716028C03000001A207282D00000A282E00000A0A2B00062A1E02282A00000A2A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000D4040000237E0000400500002406000023537472696E677300000000640B0000F41B0000235553005827000010000000234755494400000068270000D802000023426C6F620000000000000002000001571502000900000000FA25330016000001000000280000000600000001000000140000000B0000002E0000001100000009000000010000000300000000000A0001000000000006008800810006008F0081000A00BF00AA000A008F01AA000600D001BE010600E701BE0106000402BE0106002302BE0106003C02BE0106005502BE0106007002BE0106008B02BE010600C302A4020600D702BE0106000303F0023F00170300000600460326030600660326030600840381000A00B5039A030A00D6039A030600DD03A4020600F303A4020600150481000A0033049A030A0047049A030A0052049A030A0077049A030A00AD0497040600BB0481000A00C70497040A00E504D2040A00F704D20406000F0581000A0015059A030E00590545050600B10581000A00C5059A030600EF05DA0506001106810000000000010000000000010001008001100022002C000500010001000921100040000000090001000100010010004B0000000500020005000100100054000000050002000C0001001000630000000500020013000100E3001F00502000000000860099000A0001006020000000008600C8000E0001009C20000000008600D30014000200B820000000008600D9001A000300D020000000009600E900230003008821000000009600F60023000300BC22000000009100030127000300342300000000910023012C000400B0230000000091004101270005001C2400000000910057013100060039240000000086186B010A000700442400000000960071012300070060240000000096008001230007007C24000000009100030127000700F42400000000910023012C0008007025000000009100410127000900DC25000000009100570131000A00F9250000000086186B010A000B000426000000009600990136000B0040260000000086186B010A000C0000000100A90100000100AF0100000100B50100000100B50100000100B50100000100B50100000100B50100000100B50100000100B50100000100B50100000100B70129006B013D0031006B013D0039006B013D0041006B013D0049006B013D0051006B013D0059006B013D0061006B013D0069006B01420071006B013D0079006B01470089006B014D0091006B010A0099006B010A00A1006B015200B1006B01A2001900FE03A80019000A04AE0019001D04B2001900FE03B70019002704BE00C9006B010A00D10064040A01D90085040F01E9006B013D00F100C2041401F9006B0118010101F2040A00090101051F01D1001D052301090126053D00190136052901210165052F01210171050A00D9007A057C01F1008A058101D900910588010901A10588012901BD050A00F9006B013D00F100D603AE0109006B010A0031016B010A003901FB053902F100D60340022100FE034A022E001B0070022E006B00B8022E000B0057022E00130070022E00230076022E002B0057022E00330085022E003B0070022E004B0070022E005B00A6022E006300AF0263007B005800A000B300D000C000B30042018001B300B801A001B300F60160025B013402C700CB0035018C0196019E01A801B40150020480000001000000DA0FC38C0000000000002C000000020000000000000000000000010078000000000002000000000000000000000001009E0000000000020000000000000000000000010045050000000000000000003C4D6F64756C653E004441446174616261736553716C5365727665722E646C6C005574696C6974696573004441446174616261736553716C5365727665720041676772656761746531005472696767657273005061796F757454726967676572730055736572446566696E656446756E6374696F6E73006D73636F726C69620053797374656D004F626A6563740056616C75655479706500496E69740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C4D6F6E657900416363756D756C617465004D65726765005465726D696E61746500746F74616C004974656D5472696767657231004974656D547269676765723200457865637574654E6F6E51756572794F6E54726967676572436F6E7465787400457865637574655363616C61724F6E54726967676572436F6E746578740052616973654572726F72416E64526F6C6C6261636B0047657453716C466F7252616973654572726F72002E63746F72005061796F75745472696767657231005061796F757454726967676572320053716C537472696E6700466F726D617443757272656E6379310076616C7565006F74686572007000616D6F756E740053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053657269616C697A61626C65417474726962757465004D6963726F736F66742E53716C5365727665722E5365727665720053716C55736572446566696E656441676772656761746541747472696275746500466F726D6174005374727563744C61796F7574417474726962757465004C61796F75744B696E64006F705F496D706C69636974006765745F49734E756C6C00446563696D616C006765745F56616C7565006F705F4164646974696F6E0053716C547269676765724174747269627574650053716C436F6E746578740053716C54726967676572436F6E74657874006765745F54726967676572436F6E746578740054726967676572416374696F6E006765745F54726967676572416374696F6E0053797374656D2E446174612E53716C436C69656E740053716C436F6E6E656374696F6E00537472696E67005472696D0053716C436F6D6D616E640053797374656D2E446174612E436F6D6D6F6E004462436F6E6E656374696F6E004F70656E004462436F6D6D616E6400457865637574655363616C617200496E7433320053716C50697065006765745F50697065007365745F436F6D6D616E64546578740045786563757465416E6453656E640053797374656D2E5472616E73616374696F6E73005472616E73616374696F6E006765745F43757272656E7400526F6C6C6261636B00497355706461746564436F6C756D6E00436F6E636174006765745F436F6C756D6E436F756E7400457865637574654E6F6E51756572790049446973706F7361626C6500446973706F73650053716C46756E6374696F6E4174747269627574650053797374656D2E476C6F62616C697A6174696F6E0043756C74757265496E666F00437265617465537065636966696343756C747572650049466F726D617450726F766964657200000000002F63006F006E007400650078007400200063006F006E006E0065006300740069006F006E003D0074007200750065000080D30D000A00730065006C00650063007400200063006F0075006E00740028002A0029000D000A00660072006F006D00200069006E007300650072007400650064000D000A007700680065007200650020006900740065006D005F007200650070006F007200740069006E0067005F007300740061007400750073005F006900640020003C003E002000310020006F00720020006900740065006D005F006100630063006F0075006E00740069006E0067005F007300740061007400750073005F006900640020003C003E00200031000D000A0000710D000A0052004100490053004500520052004F0052002800270069006C006C006500670061006C002000730074006100740075007300200066006F007200200069006E0073006500720074006500640020004900740065006D0027002C002000310031002C002000310029000D000A000180F30D000A00730065006C00650063007400200063006F0075006E00740028002A0029000D000A00660072006F006D00200069006E00730065007200740065006400200069006E006E006500720020006A006F0069006E002000430061006D0070006100690067006E0020006F006E00200069006E007300650072007400650064002E007000690064003D00430061006D0070006100690067006E002E007000690064000D000A00770068006500720065002000430061006D0070006100690067006E002E00630061006D0070006100690067006E005F007300740061007400750073005F00690064003C003E0033000D000A0000852B0D000A00200020002000200020002000200020002000200020002000730065006C00650063007400200063006F0075006E00740028002A0029000D000A00200020002000200020002000200020002000200020002000660072006F006D002000640065006C006500740065006400200061002C0069006E00730065007200740065006400200062000D000A002000200020002000200020002000200020002000200020007700680065007200650020000D000A0020002000200020002000200020002000200020002000200028000D000A00200020002000200020002000200020002000200020002000200020002000200061002E006900740065006D005F006100630063006F0075006E00740069006E0067005F007300740061007400750073005F006900640020003E00200062002E006900740065006D005F006100630063006F0075006E00740069006E0067005F007300740061007400750073005F00690064000D000A0020002000200020002000200020002000200020002000200029000D000A002000200020002000200020002000200020002000200020006F0072000D000A0020002000200020002000200020002000200020002000200028000D000A00200020002000200020002000200020002000200020002000200020002000200028000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200061002E006900740065006D005F007200650070006F007200740069006E0067005F007300740061007400750073005F006900640020003E00200062002E006900740065006D005F007200650070006F007200740069006E0067005F007300740061007400750073005F00690064000D000A00200020002000200020002000200020002000200020002000200020002000200029000D000A00200020002000200020002000200020002000200020002000200020002000200061006E00640020006E006F0074000D000A00200020002000200020002000200020002000200020002000200020002000200028000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200028000D000A0020002000200020002000200020002000200020002000200020002000200020002000200020002000200020002000200061002E006900740065006D005F007200650070006F007200740069006E0067005F007300740061007400750073005F006900640020003D00200034000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200029000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200061006E00640020000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200028000D000A0020002000200020002000200020002000200020002000200020002000200020002000200020002000200020002000200062002E006900740065006D005F007200650070006F007200740069006E0067005F007300740061007400750073005F006900640020003D00200032000D000A002000200020002000200020002000200020002000200020002000200020002000200020002000200029000D000A00200020002000200020002000200020002000200020002000200020002000200029000D000A0020002000200020002000200020002000200020002000200029000D000A00200020002000200020002000200020002000200020002000003F69006C006C006500670061006C002000730074006100740075007300200066006F0072002000750070006400610074006500640020004900740065006D00005B730065006C0065006300740020006900740065006D005F007200650070006F007200740069006E0067005F007300740061007400750073005F00690064002000660072006F006D00200069006E00730065007200740065006400003369006C006C006500670061006C002000750070006400610074006500200066006F00720020004900740065006D002000280000032900005D730065006C0065006300740020006900740065006D005F006100630063006F0075006E00740069006E0067005F007300740061007400750073005F00690064002000660072006F006D00200069006E0073006500720074006500640000818D0D000A00200020002000200020002000200020002000200020002000200020002000200049004E005300450052005400200049004E0054004F0020004900740065006D004100630063006F0075006E00740069006E00670053007400610074007500730048006900730074006F00720079005F004300680061006E006700650054006F005F0043006800650063006B005300690067006E006500640041006E0064005000610069006400200028006900740065006D005F00690064002C0020006300680061006E00670065005F006400610074006500740069006D00650029000D000A002000200020002000200020002000200020002000200020002000200020002000530045004C00450043005400200064002E00690064002C0020004700450054004400410054004500280029000D000A002000200020002000200020002000200020002000200020002000200020002000460052004F004D002000640065006C006500740065006400200064000D000A00200020002000200020002000200020002000200020002000002F52004100490053004500520052004F005200280027007B0030007D0027002C002000310031002C002000310029000189190D000A0049004E005300450052005400200049004E0054004F0020005B004400410044006100740061006200610073006500520032005D002E005B00640062006F005D002E005B005000610079006F007500740048006900730074006F00720079005D000D000A002000200020002000200020002000200020002000200028005B007000610079006F00750074005F007200650066005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B00630075007200720065006E00630079005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B007000610079006F00750074005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B007000610079006F00750074005F0074007900700065005D000D000A00200020002000200020002000200020002000200020002C005B007000690064005D000D000A00200020002000200020002000200020002000200020002C005B00610066006600690064005D000D000A00200020002000200020002000200020002000200020002C005B0069006D007000720065007300730069006F006E005D000D000A00200020002000200020002000200020002000200020002C005B0063006C00690063006B005D000D000A00200020002000200020002000200020002000200020002C005B006C006500610064005D000D000A00200020002000200020002000200020002000200020002C005B00700065007200630065006E0074005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B0066006C00610074005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B00700065007200630065006E0074005F007300750062005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B0066006C00610074005F007300750062005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B006500660066006500630074006900760065005F0064006100740065005D000D000A00200020002000200020002000200020002000200020002C005B006D006F0064006900660079005F0064006100740065005D000D000A00200020002000200020002000200020002000200020002C005B00700072006F0064007500630074005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B0068006900730074006F00720079005F00740069006D0065005D000D000A00200020002000200020002000200020002000200020002C005B0068006900730074006F00720079005F006D006F006400690066006900650072005D000D000A00200020002000200020002000200020002000200020002C005B0068006900730074006F00720079005F0061006300740069006F006E005D0029000D000A0020002000200020002000530045004C00450043005400200069006E007300650072007400650064002E00690064000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E00630075007200720065006E00630079005F00690064000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E007000610079006F00750074005F00690064000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E007000610079006F00750074005F0074007900700065000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E007000690064000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E00610066006600690064000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E0069006D007000720065007300730069006F006E000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E0063006C00690063006B000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E006C006500610064000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E00700065007200630065006E0074005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E0066006C00610074005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E00700065007200630065006E0074005F007300750062005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E0066006C00610074005F007300750062005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E006500660066006500630074006900760065005F0064006100740065000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E006D006F0064006900660079005F0064006100740065000D000A00200020002000200020002000200020002000200020002C0069006E007300650072007400650064002E00700072006F0064007500630074005F00690064000D000A00200020002000200020002000200020002000200020002C004700450054004400410054004500280029000D000A00200020002000200020002000200020002000200020002C002700640065006600610075006C00740027000D000A00200020002000200020002000200020002000200020002C002700630072006500610074006500640027000D000A00200020002000200020002000460052004F004D00200069006E007300650072007400650064002000200020002000200020000D000A000188310D000A0049004E005300450052005400200049004E0054004F0020005B004400410044006100740061006200610073006500520032005D002E005B00640062006F005D002E005B005000610079006F007500740048006900730074006F00720079005D000D000A002000200020002000200020002000200020002000200028005B007000610079006F00750074005F007200650066005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B00630075007200720065006E00630079005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B007000610079006F00750074005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B007000610079006F00750074005F0074007900700065005D000D000A00200020002000200020002000200020002000200020002C005B007000690064005D000D000A00200020002000200020002000200020002000200020002C005B00610066006600690064005D000D000A00200020002000200020002000200020002000200020002C005B0069006D007000720065007300730069006F006E005D000D000A00200020002000200020002000200020002000200020002C005B0063006C00690063006B005D000D000A00200020002000200020002000200020002000200020002C005B006C006500610064005D000D000A00200020002000200020002000200020002000200020002C005B00700065007200630065006E0074005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B0066006C00610074005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B00700065007200630065006E0074005F007300750062005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B0066006C00610074005F007300750062005F00730061006C0065005D000D000A00200020002000200020002000200020002000200020002C005B006500660066006500630074006900760065005F0064006100740065005D000D000A00200020002000200020002000200020002000200020002C005B006D006F0064006900660079005F0064006100740065005D000D000A00200020002000200020002000200020002000200020002C005B00700072006F0064007500630074005F00690064005D000D000A00200020002000200020002000200020002000200020002C005B0068006900730074006F00720079005F00740069006D0065005D000D000A00200020002000200020002000200020002000200020002C005B0068006900730074006F00720079005F006D006F006400690066006900650072005D000D000A00200020002000200020002000200020002000200020002C005B0068006900730074006F00720079005F0061006300740069006F006E005D0029000D000A0020002000200020002000530045004C00450043005400200064002E00690064000D000A00200020002000200020002000200020002000200020002C0064002E00630075007200720065006E00630079005F00690064000D000A00200020002000200020002000200020002000200020002C0064002E007000610079006F00750074005F00690064000D000A00200020002000200020002000200020002000200020002C0064002E007000610079006F00750074005F0074007900700065000D000A00200020002000200020002000200020002000200020002C0064002E007000690064000D000A00200020002000200020002000200020002000200020002C0064002E00610066006600690064000D000A00200020002000200020002000200020002000200020002C0064002E0069006D007000720065007300730069006F006E000D000A00200020002000200020002000200020002000200020002C0064002E0063006C00690063006B000D000A00200020002000200020002000200020002000200020002C0064002E006C006500610064000D000A00200020002000200020002000200020002000200020002C0064002E00700065007200630065006E0074005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0064002E0066006C00610074005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0064002E00700065007200630065006E0074005F007300750062005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0064002E0066006C00610074005F007300750062005F00730061006C0065000D000A00200020002000200020002000200020002000200020002C0064002E006500660066006500630074006900760065005F0064006100740065000D000A00200020002000200020002000200020002000200020002C0064002E006D006F0064006900660079005F0064006100740065000D000A00200020002000200020002000200020002000200020002C0064002E00700072006F0064007500630074005F00690064000D000A00200020002000200020002000200020002000200020002C004700450054004400410054004500280029000D000A00200020002000200020002000200020002000200020002C002700640065006600610075006C00740027000D000A00200020002000200020002000200020002000200020002C0027006D006F0064006900660069006500640027000D000A00200020002000200020002000460052004F004D002000640065006C006500740065006400200064000D000A00010B65006E002D0067006200010B7B0030003A0043007D00000000005E1522FF26B6C348ADCC8118B24BC90C0008B77A5C561934E0890320000105200101110D05200101110C042000110D0306110D03000001040001010E040001080E0400010E0E0600011111110D042001010E042001010205200101114104200101080520010111554901000100000003005402174973496E76617269616E74546F4475706C696361746573005402124973496E76617269616E74546F4E756C6C7301540E044E616D650853756D4D6F6E657905200101115D050001110D0A032000020420001161060001110D1161080002110D110D110D03070102040701110D3901000300540E044E616D650C4974656D5472696767657231540E06546172676574044974656D540E054576656E740A464F5220494E53455254040000126D04200011710320000E062002010E12750320001C05000012808D05200101127D0500001280910C070612750E127D0812808D023901000300540E044E616D650C4974656D5472696767657232540E06546172676574044974656D540E054576656E740A464F522055504441544504200102080600030E1C1C1C03200008090707020208080808020707031275127D020907051275127D080802050702127D020500020E0E1C0307010E3D01000300540E044E616D650E5061796F75745472696767657231540E06546172676574065061796F7574540E054576656E740A464F5220494E534552543D01000300540E044E616D650E5061796F75745472696767657232540E06546172676574065061796F7574540E054576656E740A464F5220555044415445040100000006000112809D0E0900030E1280A10E1D1C05000111110E06070211111D1C180100134441446174616261736553716C53657276657200000501000000000E0100094D6963726F736F667400002001001B436F7079726967687420C2A9204D6963726F736F6674203230313100000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010000000000578A544D000000000200000067000000A4500000A43200005253445305D76B59A353B948B26EC06A8426ED462D000000433A5C7A7A7A4E6F76454F4D5C7673325C456F6D417070735C4441446174616261736553716C5365727665725C6F626A5C44656275675C4441446174616261736553716C5365727665722E70646200003451000000000000000000004E51000000200000000000000000000000000000000000000000000040510000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058600000780300000000000000000000780334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE0000010000000100C38CDA0F00000100C38CDA0F3F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004D8020000010053007400720069006E006700460069006C00650049006E0066006F000000B4020000010030003000300030003000340062003000000034000A00010043006F006D00700061006E0079004E0061006D006500000000004D006900630072006F0073006F00660074000000500014000100460069006C0065004400650073006300720069007000740069006F006E00000000004400410044006100740061006200610073006500530071006C00530065007200760065007200000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003000350038002E00330036003000330035000000000050001800010049006E007400650072006E0061006C004E0061006D00650000004400410044006100740061006200610073006500530071006C005300650072007600650072002E0064006C006C0000005C001B0001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004D006900630072006F0073006F006600740020003200300031003100000000005800180001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000004400410044006100740061006200610073006500530071006C005300650072007600650072002E0064006C006C000000480014000100500072006F0064007500630074004E0061006D006500000000004400410044006100740061006200610073006500530071006C00530065007200760065007200000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003000350038002E00330036003000330035000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003000350038002E003300360030003300350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005000000C000000603100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating [SqlServerProject1]...';


GO
CREATE ASSEMBLY [SqlServerProject1]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300035E384E0000000000000000E00002210B010800000C000000060000000000008E2A0000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000402A00004B00000000400000C003000000000000000000000000000000000000006000000C000000C02900001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000940A000000200000000C000000020000000000000000000000000000200000602E72737263000000C00300000040000000040000000E0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001200000000000000000000000000004000004200000000000000000000000000000000702A0000000000004800000002000500302100009008000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B300300AD0000000100001100730F00000A0A7201000070731000000A0B007231000070028C030000017295000070281100000A07731200000A0C00076F1300000A00086F1400000A0D2B2300060972B90000706F1500000A741500000172C3000070281600000A6F1700000A2600096F1800000A130511052DD100DE120814FE01130511052D07086F1900000A00DC0000DE120714FE01130511052D07076F1900000A00DC00066F1A00000A731B00000A13042B0011042A000000011C000002002F0043720012000000000200120076880012000000001E02281C00000A2A42534A4201000100000000000C00000076322E302E35303732370000000005006C00000058020000237E0000C40200007C03000023537472696E67730000000040060000CC000000235553000C0700001000000023475549440000001C0700007401000023426C6F620000000000000002000001471502000900000000FA253300160000010000001A0000000200000002000000010000001C0000000C00000001000000010000000200000000000A00010000000000060045003E000A006D0058000A00770058000600AD009B000600C4009B000600E1009B00060000019B00060019019B00060032019B0006004D019B00060068019B000600A00181010600B4019B000600E001CD013B00F40100000600230203020600430203020A008E0273020600AF02A3020A00D302BD020600E1023E000A00EF02BD020A000D03FA020A001F03BD020A003B03FA0206005D033E0000000000010000000000010001000100100020000000050001000100502000000000960080000A0001002821000000008618910011000200000001009700210091001500290091001500310091001500390091001500410091001500490091001500510091001500590091001500610091001A00690091001500710091001F00810091002500890091001100910091001100990091001100A10091001500A900E802BB00B1009100C200B9001A031100B1002D03C900C9004803CE00A900E802D30099005103D900C9005803DF00D1006903110009007103E300110091001500090091001100200073002A002E002B00F5002E0013000C012E001B000C012E00230012012E000B00F5002E00330021012E003B000C012E004B000C012E005B0042012E0063004B012E006B005401E70004800000010000008710D96C00000000000061020000020000000000000000000000010035000000000002000000000000000000000001004C000000000000000000003C4D6F64756C653E0053716C53657276657250726F6A656374312E646C6C0055736572446566696E656446756E6374696F6E73006D73636F726C69620053797374656D004F626A6563740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C537472696E670053716C496E7433320047657443616D706169676E4E6F746573002E63746F72007069640053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C53657276657250726F6A65637431004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E4174747269627574650053797374656D2E5465787400537472696E674275696C6465720053797374656D2E446174612E53716C436C69656E740053716C436F6E6E656374696F6E00537472696E6700436F6E6361740053716C436F6D6D616E640053797374656D2E446174612E436F6D6D6F6E004462436F6E6E656374696F6E004F70656E0053716C44617461526561646572004578656375746552656164657200446244617461526561646572006765745F4974656D00417070656E6400526561640049446973706F7361626C6500446973706F736500546F537472696E67000000002F63006F006E007400650078007400200063006F006E006E0065006300740069006F006E003D0074007200750065000063730065006C0065006300740020006E006F00740065002000660072006F006D002000430061006D0070006100690067006E004E006F007400650073002000770068006500720065002000630061006D0070006100690067006E005F00690064003D00002320006F0072006400650072002000620079002000690064002000640065007300630000096E006F007400650000053B0020000000000021643E220A84A342B407D9B994EB265F0008B77A5C561934E0890600011109110D03200001042001010E042001010205200101113D0420010108808F010001005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A44617461416363657373010000000600030E1C1C1C062002010E125104200012610420011C0E0500020E0E0E052001124D0E032000020320000E0D0706124D1251125912611109021601001153716C53657276657250726F6A6563743100000501000000000E0100094D6963726F736F667400002001001B436F7079726967687420C2A9204D6963726F736F6674203230313100000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010000000000035E384E000000000200000063000000DC290000DC0B000052534453BE824FF0C5480245991229A3BB87634306000000433A5C7A7A7A4E6F76454F4D5C7673325C456F6D417070735C53716C53657276657250726F6A656374315C6F626A5C44656275675C53716C53657276657250726F6A656374312E7064620000682A000000000000000000007E2A0000002000000000000000000000000000000000000000000000702A00000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000680300000000000000000000680334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE0000010000000100D96C871000000100D96C87103F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004C8020000010053007400720069006E006700460069006C00650049006E0066006F000000A4020000010030003000300030003000340062003000000034000A00010043006F006D00700061006E0079004E0061006D006500000000004D006900630072006F0073006F006600740000004C0012000100460069006C0065004400650073006300720069007000740069006F006E0000000000530071006C00530065007200760065007200500072006F006A006500630074003100000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003200330031002E0032003700380036003500000000004C001600010049006E007400650072006E0061006C004E0061006D0065000000530071006C00530065007200760065007200500072006F006A0065006300740031002E0064006C006C0000005C001B0001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004D006900630072006F0073006F006600740020003200300031003100000000005400160001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530071006C00530065007200760065007200500072006F006A0065006300740031002E0064006C006C000000440012000100500072006F0064007500630074004E0061006D00650000000000530071006C00530065007200760065007200500072006F006A006500630074003100000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003200330031002E00320037003800360035000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003200330031002E00320037003800360035000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000903A00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating [SqlServerProjectForDADatabaseR3]...';


GO
CREATE ASSEMBLY [SqlServerProjectForDADatabaseR3]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300DD02774D0000000000000000E00002210B0108000018000000080000000000002E370000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000DC3600004F000000004000003004000000000000000000000000000000000000006000000C000000403600001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000034170000002000000018000000020000000000000000000000000000200000602E72737263000000300400000040000000060000001A0000000000000000000000000000400000402E72656C6F6300000C000000006000000002000000200000000000000000000000000000400000420000000000000000000000000000000010370000000000004800000002000500F42400004C1100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133002001000000001000011007201000070730F00000A0A2B00062A1E02281000000A2A4A00027E1400000A281500000A7D020000042A00133002002100000002000011000F01281600000A2D09020328080000062B01170A062D0802032805000006002A7A0002257B02000004032807000006281500000A281700000A7D020000042A52000203281800000A281900000A2805000006002A000000133002002400000003000011000F00281A00000A0B1201281B00000A7E010000048C21000001281C00000A0A2B00062A133002001C0000000200001100027C02000004281D00000A0328070000066F1E00000A0A2B00062A1B3002004800000004000011000003280A0000066F1F00000A0B2B1A076F2000000A0A020628080000060C082D080206280500000600076F2100000A0C082DDCDE100714FE010C082D07076F2200000A00DC002A0110000002000E002836001000000000133002004A00000005000011282700000A6F2800000A027B06000004330F027B050000041FFEFE0116FE012B01170C082D0B02167D05000004020A2B0716731A0000060A06027B080000047D07000004060B2B00072A0000133001000B000000060000110228130000060A2B00062A001B300500F400000007000011027B050000040B0745030000000700000009000000020000002B0738930000002B0538BE00000002157D05000004000002177D0500000402027C070000047C02000004281D00000A178D210000010C08167E010000049D086F2900000A7D0B00000402167D0C0000042B5E02027B0B000004027B0C0000049A7D0900000400027B09000004027C0A000004282A00000A16FE010D092D2302027B0A000004281900000A7D0400000402187D05000004170ADE3E02177D050000040002027B0C00000417587D0C000004027B0C000004027B0B0000048E69FE040D092D8E02281B0000060000160ADE0802281800000600DC00062A0110000004000000E9E9000800000000133001000B00000008000011027B040000040A2B00062A1A732B00000A7A0000133002002700000009000011027B050000040A061759450200000004000000020000002B042B042B022B0702281B000006002A0013300100100000000A000011027B040000048C050000010A2B00062A7A02281000000A02037D0500000402282700000A6F2800000A7D060000042A2202157D050000042A13300200150000000B0000111FFE731A0000060A06027D08000004060B2B00072A000000133004002B0000000C00001100027C02000004281D00000A178D210000010B07167E010000049D076F2C00000A281500000A0A2B00062A4E0002036F2D00000A281500000A7D020000042A0013300500290000000D0000110003027C02000004281D00000A178D210000010A06167E010000049D066F2C00000A6F2E00000A002A221F2C80010000042A3E0002166A283000000A7D030000042A0000133003003000000002000011000F01283100000A16FE010A062D03002B1D02257B030000040F01283200000A283300000A283400000A7D030000042A6A0002257B030000040F017B03000004283400000A7D030000042A0013300100100000000100001100720D000070281500000A0A2B00062A42534A4201000100000000000C00000076322E302E35303732370000000005006C0000002C060000237E000098060000CC07000023537472696E677300000000640E000018000000235553007C0E00001000000023475549440000008C0E0000C002000023426C6F6200000000000000020000015717A20B0902000000FA253300160000010000002A000000050000000C0000001B0000000C0000000600000034000000150000000D000000010000000200000002000000070000000200000001000000020000000100000000000A00010000000000060066005F0006006D005F000A009E0083000A00C400AF000A00F400AF0006003B0120010600630159010600750159010A008801AF000600BF01AD010600D601AD010600F301AD0106001202AD0106002B02AD0106004402AD0106005F02AD0106007A02AD010600B20293020600C602AD010600F202DF025300060300000600350315030600550315030A00930383000600A8035F000A00BE0383000A00DF0383000600E60393020600FC039302060007045F00060037045F00060051045F00060060045F0006006C0420010600A70494040600BC045F000600DC04940406001107DF0206003A072907060076075F000600A60715030600C1075F000000000001000000000001000100010010002E0000000500010001000921100043000000090001000300092110004B000000090003000F0003011000D00400000500040013003100E40013000100E8001600010091015F00010069054D0101000E06560101001906560106009D015D01060059065D0106006406D5000600700656010600860661010600910656015020000000009600CE000A0001006C20000000008618DE000F0001007420000000008600EF000F0001008820000000008600FD001A000100B52000000000810008011A000200D420000000008100080120000300EC200000000091000C01250004001C2100000000810011012B00050044210000000086001A0131000600C023000000009100490137000700E4230000000086004F01420008001B2400000000E601700147000800302400000000E60182014D00090065240000000091189F07C7010A006E24000000008600EF000F000A008024000000008600FD0053000A00BC240000000086001A0159000B00D8240000000086004F0142000C00A82100000000E101E8043D010C00002200000000E1013C0547010C00182200000000E101B304DE000C00282300000000E109760551010C003F2300000000E101C8050F000C00482300000000E101F3050F000C007C2300000000E1092E0659010C009823000000008618DE006E000C00B72300000000810078060F000D00000001009701000001009701000001009701000001009701000001009701000001009D01000001009D0100000100A30100000100A50100000100970100000100A701000001000E0603000D00050006000500950005000A0005008D00050091005100DE0020005900DE0020006100DE0020006900DE0020007100DE0020007900DE0020008100DE0020008900DE0020009100DE0063009900DE002000A100DE006800B100DE006E00B900DE000F00C100DE000F002100DE0020000900DE000F00C900DE000F00D100DE007D00E100DE00CF00F1000E04D50021001404D80029002004DE0021002B04E600F9003F04EF0029001404F40029004704FA0001015704FE00F1006504020121004704FE00F10011010D010C007A041901140088042B011901B304DE002101C8040F0029017A0447011901ED050F001901880459013101DE000F00390141076E0139015307FA00F1006707870101016D078E014101DE000F00F1008C07B50139009407FE004100820120004901DE000F0049001404160249002004DE00490047041C0249001404220249002B042A022000730073002E000B0033022E00130058022E006B00A0022E002B0033022E005B008E022E00630097022E004B0058022E0023005E022E001B0058022E0033006D022E003B00580263009300830083009300CB01A3007B017300600233017300800233017300C00233017300E002330173002003330173004003330173007800E200080130017401810195019D01A201A601AA01BB01C2010500010000009C0665010000EA066A01020016000300020019000500050026003F0005002800470005002A00430005002C00410005002E004900050030004500050032004B00120123010480000001000000F40F86A50000000000007303000002000000000000000000000001005600000000000200000000000000000000000100770000000000050003000000003C4D6F64756C653E0053716C53657276657250726F6A656374466F724441446174616261736552332E646C6C0055736572446566696E656446756E6374696F6E730053756D4B6579730041676772656761746531006D73636F726C69620053797374656D004F626A6563740056616C7565547970650053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E536572766572004942696E61727953657269616C697A650053797374656D2E446174612E53716C54797065730053716C537472696E6700436F6E7665727443757272656E6379002E63746F720073657000726573756C7400496E69740053716C496E74333200416363756D756C61746500416464005772617000436F6E7461696E73004D657267650053797374656D2E436F6C6C656374696F6E732E47656E657269630049456E756D657261626C656031004974656D73005465726D696E6174650053797374656D2E494F0042696E61727952656164657200526561640042696E6172795772697465720057726974650053716C4D6F6E657900746F74616C0076616C75650067726F757000720077006F746865720053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C53657276657250726F6A656374466F724441446174616261736552330053716C46756E6374696F6E4174747269627574650053657269616C697A61626C654174747269627574650053716C55736572446566696E656441676772656761746541747472696275746500466F726D6174005374727563744C61796F7574417474726962757465004C61796F75744B696E6400537472696E6700456D707479006F705F496D706C69636974006765745F49734E756C6C006F705F4164646974696F6E00436F6E7665727400546F496E743332006765745F56616C756500496E74333200546F537472696E67004368617200436F6E6361740049456E756D657261746F72603100476574456E756D657261746F72006765745F43757272656E740053797374656D2E436F6C6C656374696F6E730049456E756D657261746F72004D6F76654E6578740049446973706F7361626C6500446973706F7365003C4974656D733E645F5F300049456E756D657261626C650053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261626C653C53797374656D2E446174612E53716C54797065732E53716C496E7433323E2E476574456E756D657261746F720053797374656D2E436F6C6C656374696F6E732E49456E756D657261626C652E476574456E756D657261746F72003C3E325F5F63757272656E740053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E446174612E53716C54797065732E53716C496E7433323E2E6765745F43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E52657365740052657365740053797374656D2E49446973706F7361626C652E446973706F7365003C3E315F5F7374617465003C3E6C5F5F696E697469616C54687265616449640053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E6765745F43757272656E74003C3E335F5F67726F7570003C76616C75653E355F5F31003C693E355F5F32003C3E6D5F5F46696E616C6C7933003C3E375F5F7772617034003C3E375F5F77726170350053797374656D2E436F6C6C656374696F6E732E47656E657269632E49456E756D657261746F723C53797374656D2E446174612E53716C54797065732E53716C496E7433323E2E43757272656E740053797374656D2E436F6C6C656374696F6E732E49456E756D657261746F722E43757272656E7400446562756767657248696464656E4174747269627574650053797374656D2E546872656164696E6700546872656164006765745F43757272656E74546872656164006765745F4D616E6167656454687265616449640053706C6974005472795061727365004E6F74537570706F72746564457863657074696F6E005472696D456E640052656164537472696E67002E6363746F7200436F6D70696C657247656E65726174656441747472696275746500446563696D616C00000000000B480065006C006C006F00000766006F006F000000000001AFBA0568F7664693DCD537F560EE5B0008B77A5C561934E08904000011110320000102060303061111052001011115042001010E0500010E111505200102111505200101110C0A0001151219011115110C042000111105200101121D05200101122105200101112505200101111003061125042001010205200101115504200101080401000000040701111105200101116D4B01000200000003005402174973496E76617269616E74546F4475706C696361746573015402124973496E76617269616E74546F4E756C6C730154080B4D61784279746553697A65FFFFFFFF05200101117502060E05000111110E0320000203070102080002111111111111040001080E050001111508032000080320000E0500020E1C1C0407020E08042001020E0615121901111509200015128089011300071512808901111504200013000C0703111515128089011115020920001512808901111505200012808D0306111504200011150206080320001C0306110C03061D0E04280011150328001C05000012809D0C07031214151280890111150205070112808D0620011D0E1D03060002020E100807070402081D03020407011115030701080307011C0A070212141512190111150520010E1D0306070211111D030407011D03030000014A01000100000003005402174973496E76617269616E74546F4475706C696361746573005402124973496E76617269616E74546F4E756C6C7301540E044E616D650953756D4D6F6E65793205000111250A0520001180A907000111251180A90800021125112511252401001F53716C53657276657250726F6A656374466F7244414461746162617365523300000501000000000E0100094D6963726F736F667400002001001B436F7079726967687420C2A9204D6963726F736F6674203230313100000801000701000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010000000000DD02774D00000000020000007F0000005C3600005C18000052534453BD10B7EEA40AC04F94062F2FB814225305000000433A5C7A7A7A4E6F76454F4D5C7673325C456F6D417070735C53716C53657276657250726F6A656374466F724441446174616261736552335C6F626A5C44656275675C53716C53657276657250726F6A656374466F724441446174616261736552332E70646200000437000000000000000000001E37000000200000000000000000000000000000000000000000000010370000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000D80300000000000000000000D80334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE000001000000010086A5F40F0000010086A5F40F3F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00438030000010053007400720069006E006700460069006C00650049006E0066006F00000014030000010030003000300030003000340062003000000034000A00010043006F006D00700061006E0079004E0061006D006500000000004D006900630072006F0073006F00660074000000680020000100460069006C0065004400650073006300720069007000740069006F006E0000000000530071006C00530065007200760065007200500072006F006A0065006300740046006F007200440041004400610074006100620061007300650052003300000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003000380034002E00340032003300370034000000000068002400010049006E007400650072006E0061006C004E0061006D0065000000530071006C00530065007200760065007200500072006F006A0065006300740046006F0072004400410044006100740061006200610073006500520033002E0064006C006C0000005C001B0001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004D006900630072006F0073006F006600740020003200300031003100000000007000240001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530071006C00530065007200760065007200500072006F006A0065006300740046006F0072004400410044006100740061006200610073006500520033002E0064006C006C000000600020000100500072006F0064007500630074004E0061006D00650000000000530071006C00530065007200760065007200500072006F006A0065006300740046006F007200440041004400610074006100620061007300650052003300000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003000380034002E00340032003300370034000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003000380034002E0034003200330037003400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000303700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;


GO
PRINT N'Creating [dbo].[SumKeys]...';


GO
CREATE AGGREGATE [dbo].[SumKeys](@value INT)
    RETURNS NVARCHAR (4000)
    EXTERNAL NAME [SqlServerProjectForDADatabaseR3].[SumKeys];


GO
PRINT N'Creating [dbo].[SumMoney]...';


GO
CREATE AGGREGATE [dbo].[SumMoney](@value MONEY)
    RETURNS MONEY
    EXTERNAL NAME [DADatabaseSqlServer].[Aggregate1];


GO
PRINT N'Creating [dbo].[SumMoney2]...';


GO
CREATE AGGREGATE [dbo].[SumMoney2](@value MONEY)
    RETURNS NVARCHAR (4000)
    EXTERNAL NAME [SqlServerProjectForDADatabaseR3].[Aggregate1];


GO
PRINT N'Creating [dbo].[AccountManager]...';


GO
CREATE TABLE [dbo].[AccountManager] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [AccountManager_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [AccountManager_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[AdManager]...';


GO
CREATE TABLE [dbo].[AdManager] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [AdManager_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [AdManager_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[Advertiser]...';


GO
CREATE TABLE [dbo].[Advertiser] (
    [id]                INT           IDENTITY (1, 1) NOT NULL,
    [name]              VARCHAR (50)  NOT NULL,
    [status]            VARCHAR (50)  NULL,
    [payment_terms]     VARCHAR (50)  NULL,
    [invoicing_status]  VARCHAR (50)  NULL,
    [comments]          VARCHAR (255) NULL,
    [prev_open_balance] VARCHAR (100) NULL,
    [qb_name]           VARCHAR (100) NULL,
    [alt_name]          VARCHAR (100) NULL,
    CONSTRAINT [Advertiser_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [Advertiser_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[Affiliate]...';


GO
CREATE TABLE [dbo].[Affiliate] (
    [id]                 INT           IDENTITY (1, 1) NOT NULL,
    [name]               VARCHAR (255) NOT NULL,
    [media_buyer_id]     INT           NOT NULL,
    [affid]              INT           NOT NULL,
    [currency_id]        INT           NOT NULL,
    [email]              VARCHAR (255) NOT NULL,
    [add_code]           VARCHAR (100) NOT NULL,
    [net_term_type_id]   INT           NULL,
    [payment_method_id]  INT           NOT NULL,
    [name2]              AS            ((([name] + ' (') + [add_code]) + ')'),
    [date_created]       DATETIME      NULL,
    [date_modified]      DATETIME      NULL,
    [tracking_system_id] INT           NULL,
    [external_id]        INT           NULL,
    [status]             VARCHAR (50)  NULL,
    [margin_exempt]      BIT           NOT NULL,
    [payment_on_hold]    VARCHAR (100) NULL,
    [qb_name]            VARCHAR (100) NULL,
    CONSTRAINT [Affiliate_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [Affiliate_affid_UK] UNIQUE NONCLUSTERED ([affid] ASC)
);


GO
PRINT N'Creating [dbo].[AffiliatePaymentMethod]...';


GO
CREATE TABLE [dbo].[AffiliatePaymentMethod] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [AffiliatePaymentMethod_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [AffiliatePaymentMethod_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[Analyst]...';


GO
CREATE TABLE [dbo].[Analyst] (
    [id]         INT             IDENTITY (1, 1) NOT NULL,
    [manager_id] INT             NULL,
    [name]       VARCHAR (100)   NOT NULL,
    [comm_rate]  DECIMAL (10, 5) NOT NULL,
    CONSTRAINT [PK_Analyst] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [UK_Analyst_name] UNIQUE NONCLUSTERED ([name] ASC)
);


GO
PRINT N'Creating [dbo].[AnalystManager]...';


GO
CREATE TABLE [dbo].[AnalystManager] (
    [id]        INT             IDENTITY (1, 1) NOT NULL,
    [name]      VARCHAR (100)   NOT NULL,
    [comm_rate] DECIMAL (10, 5) NOT NULL,
    CONSTRAINT [PK_AnalystManager] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [UK_AnalystManager_name] UNIQUE NONCLUSTERED ([name] ASC)
);


GO
PRINT N'Creating [dbo].[AnalystRole]...';


GO
CREATE TABLE [dbo].[AnalystRole] (
    [person_id] INT NOT NULL,
    [pid]       INT NOT NULL,
    [affid]     INT NOT NULL,
    CONSTRAINT [PK_AnalystRole] PRIMARY KEY CLUSTERED ([person_id] ASC, [pid] ASC, [affid] ASC)
);


GO
PRINT N'Creating [dbo].[Batch]...';


GO
CREATE TABLE [dbo].[Batch] (
    [id]   INT           IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (255) NULL,
    CONSTRAINT [PK_Batch] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[BatchBatchUpdate]...';


GO
CREATE TABLE [dbo].[BatchBatchUpdate] (
    [batch_id]        INT NOT NULL,
    [batch_update_id] INT NOT NULL,
    CONSTRAINT [PK_BatchBatchUpdate] PRIMARY KEY CLUSTERED ([batch_id] ASC, [batch_update_id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[BatchUpdate]...';


GO
CREATE TABLE [dbo].[BatchUpdate] (
    [id]                                  INT           IDENTITY (1, 1) NOT NULL,
    [note]                                VARCHAR (MAX) NOT NULL,
    [author]                              VARCHAR (255) NOT NULL,
    [date_created]                        DATETIME      NOT NULL,
    [media_buyer_approval_status_id]      INT           NULL,
    [extra]                               VARCHAR (255) NULL,
    [from_media_buyer_approval_status_id] INT           NULL,
    CONSTRAINT [PK_BatchUpdate] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[CampAff]...';


GO
CREATE TABLE [dbo].[CampAff] (
    [pid]           INT NOT NULL,
    [affid]         INT NOT NULL,
    [analyst_id]    INT NULL,
    [strategist_id] INT NULL,
    CONSTRAINT [PK_CampAff] PRIMARY KEY CLUSTERED ([pid] ASC, [affid] ASC)
);


GO
PRINT N'Creating [dbo].[Campaign]...';


GO
CREATE TABLE [dbo].[Campaign] (
    [id]                       INT           IDENTITY (1, 1) NOT NULL,
    [account_manager_id]       INT           NOT NULL,
    [campaign_status_id]       INT           NOT NULL,
    [ad_manager_id]            INT           NOT NULL,
    [advertiser_id]            INT           NOT NULL,
    [pid]                      INT           NOT NULL,
    [campaign_name]            VARCHAR (255) NOT NULL,
    [campaign_type]            CHAR (3)      NULL,
    [modified]                 DATETIME      NULL,
    [created]                  DATETIME      NULL,
    [dt_campaign_status]       VARCHAR (25)  NULL,
    [dt_campaign_url]          VARCHAR (255) NULL,
    [dt_allowed_country_names] VARCHAR (255) NULL,
    [is_email]                 BIT           NULL,
    [is_search]                BIT           NULL,
    [is_display]               BIT           NULL,
    [is_coreg]                 BIT           NULL,
    [max_scrub]                INT           NULL,
    [notes]                    VARCHAR (MAX) NULL,
    [tracking_system_id]       INT           NULL,
    [external_id]              INT           NULL,
    [display_name]             VARCHAR (255) NULL,
    CONSTRAINT [Campaign_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [Campaign_pid_UK] UNIQUE NONCLUSTERED ([pid] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[CampaignNotes]...';


GO
CREATE TABLE [dbo].[CampaignNotes] (
    [id]                   INT           IDENTITY (1, 1) NOT NULL,
    [campaign_id]          INT           NOT NULL,
    [note]                 VARCHAR (MAX) NOT NULL,
    [added_by_system_user] VARCHAR (255) NULL,
    [created]              DATETIME      NOT NULL,
    CONSTRAINT [CampaignNotes_id_PK] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[CampaignStatus]...';


GO
CREATE TABLE [dbo].[CampaignStatus] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [CampaignStatus_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [CampaignStatus_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[Currency]...';


GO
CREATE TABLE [dbo].[Currency] (
    [id]                INT             IDENTITY (1, 1) NOT NULL,
    [name]              VARCHAR (50)    NOT NULL,
    [to_usd_multiplier] DECIMAL (14, 4) NOT NULL,
    CONSTRAINT [Currency_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [Currency_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[DTCampaignStatus]...';


GO
CREATE TABLE [dbo].[DTCampaignStatus] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (25) NOT NULL,
    CONSTRAINT [DTCampaignStatus_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [DTCampaignStatus_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[DTCampaignType]...';


GO
CREATE TABLE [dbo].[DTCampaignType] (
    [id]   INT      IDENTITY (1, 1) NOT NULL,
    [name] CHAR (3) NOT NULL,
    CONSTRAINT [DTCampaignType_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [DTCampaignType_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[IncomeType]...';


GO
CREATE TABLE [dbo].[IncomeType] (
    [id]      INT           NOT NULL,
    [name]    VARCHAR (100) NOT NULL,
    [qb_code] VARCHAR (100) NULL,
    CONSTRAINT [PK_IncomeType] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Invoice]...';


GO
CREATE TABLE [dbo].[Invoice] (
    [id]                INT IDENTITY (1, 1) NOT NULL,
    [invoice_status_id] INT NOT NULL,
    CONSTRAINT [PK_Invoice_1] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[InvoiceItem]...';


GO
CREATE TABLE [dbo].[InvoiceItem] (
    [id]              INT   IDENTITY (1, 1) NOT NULL,
    [invoice_id]      INT   NOT NULL,
    [pid]             INT   NULL,
    [affid]           INT   NULL,
    [currency_id]     INT   NOT NULL,
    [amount_per_unit] MONEY NOT NULL,
    [num_units]       INT   NOT NULL,
    [total_amount]    AS    ([amount_per_unit] * [num_units]),
    [unit_type_id]    INT   NULL,
    CONSTRAINT [PK_Invoice] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[InvoiceNote]...';


GO
CREATE TABLE [dbo].[InvoiceNote] (
    [id]         INT           IDENTITY (1, 1) NOT NULL,
    [invoice_id] INT           NOT NULL,
    [note]       VARCHAR (MAX) NOT NULL,
    [added_by]   VARCHAR (255) NULL,
    [created]    DATETIME      NOT NULL,
    CONSTRAINT [PK_InvoiceNote] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[InvoiceStatus]...';


GO
CREATE TABLE [dbo].[InvoiceStatus] (
    [id]   INT          NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [PK_InvoiceStatus] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[ItemAccountingStatus]...';


GO
CREATE TABLE [dbo].[ItemAccountingStatus] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [ItemAccountingStatus_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [ItemAccountingStatus_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[ItemReportingStatus]...';


GO
CREATE TABLE [dbo].[ItemReportingStatus] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [ItemReportingStatus_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [ItemReportingStatus_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[ItemVerificationDate]...';


GO
CREATE TABLE [dbo].[ItemVerificationDate] (
    [id]            INT  IDENTITY (1, 1) NOT NULL,
    [verified_date] DATE NOT NULL,
    [item_id]       INT  NOT NULL,
    CONSTRAINT [PK_ItemVerificationDate] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[MarginApproval]...';


GO
CREATE TABLE [dbo].[MarginApproval] (
    [id]                  INT            IDENTITY (1, 1) NOT NULL,
    [pid]                 INT            NULL,
    [affid]               INT            NULL,
    [revenue_currency_id] INT            NULL,
    [total_revenue]       MONEY          NULL,
    [cost_currency_id]    INT            NULL,
    [total_cost]          MONEY          NULL,
    [margin_pct]          DECIMAL (8, 4) NULL,
    [comment]             VARCHAR (MAX)  NULL,
    [added_by]            VARCHAR (255)  NULL,
    [created]             DATETIME       NOT NULL,
    [used]                DATETIME       NULL,
    CONSTRAINT [PK_MarginApproval] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[MediaBuyer]...';


GO
CREATE TABLE [dbo].[MediaBuyer] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [MediaBuyer_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [MediaBuyer_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[MediaBuyerApprovalStatus]...';


GO
CREATE TABLE [dbo].[MediaBuyerApprovalStatus] (
    [id]   INT          NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [PK_MediaBuyerApprovalStatus] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[NetTermType]...';


GO
CREATE TABLE [dbo].[NetTermType] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [NetTermType_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [NetTermType_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[PaymentBatch]...';


GO
CREATE TABLE [dbo].[PaymentBatch] (
    [id]                     INT           IDENTITY (1, 1) NOT NULL,
    [approver_identity]      VARCHAR (255) NULL,
    [payment_batch_state_id] INT           NOT NULL,
    [is_current]             BIT           NOT NULL,
    [payment_threshold]      MONEY         NULL,
    [parent_batch_id]        INT           NULL,
    [payment_method_id]      INT           NULL,
    [name]                   VARCHAR (255) NULL,
    [date_sent]              DATETIME      NULL,
    CONSTRAINT [PK_PaymentBatch] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[PaymentBatchState]...';


GO
CREATE TABLE [dbo].[PaymentBatchState] (
    [id]   INT          NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [PK_PaymentBatchState] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Payout]...';


GO
CREATE TABLE [dbo].[Payout] (
    [id]               INT          IDENTITY (1, 1) NOT NULL,
    [currency_id]      INT          NOT NULL,
    [payout_id]        VARCHAR (50) NOT NULL,
    [payout_type]      VARCHAR (20) NOT NULL,
    [pid]              INT          NOT NULL,
    [affid]            INT          NOT NULL,
    [impression]       MONEY        NULL,
    [click]            MONEY        NOT NULL,
    [lead]             MONEY        NOT NULL,
    [percent_sale]     MONEY        NOT NULL,
    [flat_sale]        MONEY        NOT NULL,
    [percent_sub_sale] MONEY        NOT NULL,
    [flat_sub_sale]    MONEY        NOT NULL,
    [effective_date]   DATE         NOT NULL,
    [modify_date]      DATE         NOT NULL,
    [product_id]       INT          NOT NULL,
    CONSTRAINT [Payout_id_PK] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Person]...';


GO
CREATE TABLE [dbo].[Person] (
    [id]         INT           NOT NULL,
    [first_name] VARCHAR (100) NOT NULL,
    [last_name]  VARCHAR (100) NOT NULL,
    CONSTRAINT [PK_Person] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[PubAttachment]...';


GO
CREATE TABLE [dbo].[PubAttachment] (
    [id]             INT             IDENTITY (1, 1) NOT NULL,
    [publisher_name] VARCHAR (MAX)   NOT NULL,
    [name]           NVARCHAR (255)  NOT NULL,
    [description]    NVARCHAR (255)  NULL,
    [binary_content] VARBINARY (MAX) NOT NULL,
    CONSTRAINT [PK_PubAttachment] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[Publisher]...';


GO
CREATE TABLE [dbo].[Publisher] (
    [id]    INT           IDENTITY (1, 1) NOT NULL,
    [name]  VARCHAR (255) NOT NULL,
    [affid] INT           NULL,
    CONSTRAINT [Publisher_id_PK] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[PubNotes]...';


GO
CREATE TABLE [dbo].[PubNotes] (
    [id]                   INT           IDENTITY (1, 1) NOT NULL,
    [publisher_name]       VARCHAR (MAX) NOT NULL,
    [note]                 VARCHAR (MAX) NOT NULL,
    [added_by_system_user] VARCHAR (255) NULL,
    [created]              DATETIME      NOT NULL,
    CONSTRAINT [PK_PubNotes] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[PubReportEmail]...';


GO
CREATE TABLE [dbo].[PubReportEmail] (
    [id]                     INT            IDENTITY (1, 1) NOT NULL,
    [to_email_address]       VARCHAR (255)  NULL,
    [sent_date]              DATETIME       NOT NULL,
    [subject]                VARCHAR (255)  NOT NULL,
    [body]                   NVARCHAR (MAX) NOT NULL,
    [pub_report_instance_id] INT            NOT NULL,
    CONSTRAINT [PubReportEmail_id_PK] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[PubReportInstance]...';


GO
CREATE TABLE [dbo].[PubReportInstance] (
    [id]                   INT            IDENTITY (1, 1) NOT NULL,
    [created_by_user_name] VARCHAR (255)  NOT NULL,
    [report_content]       NVARCHAR (MAX) NOT NULL,
    [path_to_hard_copy]    VARCHAR (255)  NOT NULL,
    [vendor_id]            INT            NOT NULL,
    [saved]                DATETIME       NOT NULL,
    [email_status_msg]     VARCHAR (255)  NOT NULL,
    CONSTRAINT [PubReportInstance_id_PK] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating [dbo].[Source]...';


GO
CREATE TABLE [dbo].[Source] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [Source_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [Source_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[Stat]...';


GO
CREATE TABLE [dbo].[Stat] (
    [id]                              INT             IDENTITY (1, 1) NOT NULL,
    [pid]                             INT             NOT NULL,
    [affid]                           INT             NOT NULL,
    [revenue_payout_id]               INT             NOT NULL,
    [cost_payout_id]                  INT             NOT NULL,
    [apiurl]                          VARCHAR (255)   NOT NULL,
    [clicks]                          INT             NOT NULL,
    [leads]                           INT             NOT NULL,
    [num_sales]                       INT             NOT NULL,
    [num_post_impression_sales]       INT             NOT NULL,
    [sale_amount]                     DECIMAL (12, 2) NOT NULL,
    [post_impression_sale_amount]     DECIMAL (12, 2) NOT NULL,
    [num_sub_sales]                   INT             NOT NULL,
    [num_post_impression_sub_sales]   INT             NOT NULL,
    [sub_sale_amount]                 DECIMAL (12, 2) NOT NULL,
    [post_impression_sub_sale_amount] DECIMAL (12, 2) NOT NULL,
    [stat_date]                       DATE            NOT NULL,
    CONSTRAINT [Stat_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [Stat_apiurl_UK] UNIQUE NONCLUSTERED ([apiurl] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[Strategist]...';


GO
CREATE TABLE [dbo].[Strategist] (
    [id]        INT             IDENTITY (1, 1) NOT NULL,
    [name]      VARCHAR (100)   NOT NULL,
    [comm_rate] DECIMAL (10, 5) NOT NULL,
    CONSTRAINT [PK_Strategist] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [UK_Strategist_name] UNIQUE NONCLUSTERED ([name] ASC)
);


GO
PRINT N'Creating [dbo].[TrackingSystem]...';


GO
CREATE TABLE [dbo].[TrackingSystem] (
    [id]   INT          NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [PK_TrackingSystem] PRIMARY KEY CLUSTERED ([id] ASC)
) ON [PRIMARY];


GO
PRINT N'Creating [dbo].[UnitType]...';


GO
CREATE TABLE [dbo].[UnitType] (
    [id]             INT          IDENTITY (1, 1) NOT NULL,
    [name]           VARCHAR (50) NOT NULL,
    [income_type_id] INT          NULL,
    CONSTRAINT [UnitType_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [UnitType_name_UK] UNIQUE NONCLUSTERED ([name] ASC)
);


GO
PRINT N'Creating [dbo].[Vendor]...';


GO
CREATE TABLE [dbo].[Vendor] (
    [id]   INT          IDENTITY (1, 1) NOT NULL,
    [name] VARCHAR (50) NOT NULL,
    CONSTRAINT [Vendor_id_PK] PRIMARY KEY CLUSTERED ([id] ASC),
    CONSTRAINT [Vendor_name_UK] UNIQUE NONCLUSTERED ([name] ASC) ON [PRIMARY]
);


GO
PRINT N'Creating [dbo].[DF_Affiliate_margin_exempt]...';


GO
ALTER TABLE [dbo].[Affiliate]
    ADD CONSTRAINT [DF_Affiliate_margin_exempt] DEFAULT ((0)) FOR [margin_exempt];


GO
PRINT N'Creating [dbo].[DF_BatchUpdate_date_created]...';


GO
ALTER TABLE [dbo].[BatchUpdate]
    ADD CONSTRAINT [DF_BatchUpdate_date_created] DEFAULT (getdate()) FOR [date_created];


GO
PRINT N'Creating unnamed constraint on [dbo].[CampaignNotes]...';


GO
ALTER TABLE [dbo].[CampaignNotes]
    ADD DEFAULT (getdate()) FOR [created];


GO
PRINT N'Creating [dbo].[DF_PaymentBatch_payment_batch_state_id]...';


GO
ALTER TABLE [dbo].[PaymentBatch]
    ADD CONSTRAINT [DF_PaymentBatch_payment_batch_state_id] DEFAULT ((1)) FOR [payment_batch_state_id];


GO
PRINT N'Creating unnamed constraint on [dbo].[PubNotes]...';


GO
ALTER TABLE [dbo].[PubNotes]
    ADD DEFAULT getdate() FOR [created];


GO
PRINT N'Creating [dbo].[Affiliate_AffiliatePaymentMethod_id_FK_AffiliatePaymentMethod_id_PK]...';


GO
ALTER TABLE [dbo].[Affiliate]
    ADD CONSTRAINT [Affiliate_AffiliatePaymentMethod_id_FK_AffiliatePaymentMethod_id_PK] FOREIGN KEY ([payment_method_id]) REFERENCES [dbo].[AffiliatePaymentMethod] ([id]);


GO
PRINT N'Creating [dbo].[Affiliate_Currency_id_FK_Currency_id_PK]...';


GO
ALTER TABLE [dbo].[Affiliate]
    ADD CONSTRAINT [Affiliate_Currency_id_FK_Currency_id_PK] FOREIGN KEY ([currency_id]) REFERENCES [dbo].[Currency] ([id]);


GO
PRINT N'Creating [dbo].[Affiliate_MediaBuyer_id_FK_MediaBuyer_id_PK]...';


GO
ALTER TABLE [dbo].[Affiliate]
    ADD CONSTRAINT [Affiliate_MediaBuyer_id_FK_MediaBuyer_id_PK] FOREIGN KEY ([media_buyer_id]) REFERENCES [dbo].[MediaBuyer] ([id]);


GO
PRINT N'Creating [dbo].[Affiliate_NetTermType_id_FK_NetTermType_id_PK]...';


GO
ALTER TABLE [dbo].[Affiliate]
    ADD CONSTRAINT [Affiliate_NetTermType_id_FK_NetTermType_id_PK] FOREIGN KEY ([net_term_type_id]) REFERENCES [dbo].[NetTermType] ([id]);


GO
PRINT N'Creating [dbo].[affiliate_tracking_system_fk]...';


GO
ALTER TABLE [dbo].[Affiliate]
    ADD CONSTRAINT [affiliate_tracking_system_fk] FOREIGN KEY ([tracking_system_id]) REFERENCES [dbo].[TrackingSystem] ([id]);


GO
PRINT N'Creating [dbo].[FK_Analyst_AnalystManager]...';


GO
ALTER TABLE [dbo].[Analyst]
    ADD CONSTRAINT [FK_Analyst_AnalystManager] FOREIGN KEY ([manager_id]) REFERENCES [dbo].[AnalystManager] ([id]);


GO
PRINT N'Creating [dbo].[FK_AnalystRole_Affiliate]...';


GO
ALTER TABLE [dbo].[AnalystRole]
    ADD CONSTRAINT [FK_AnalystRole_Affiliate] FOREIGN KEY ([affid]) REFERENCES [dbo].[Affiliate] ([affid]);


GO
PRINT N'Creating [dbo].[FK_AnalystRole_Campaign]...';


GO
ALTER TABLE [dbo].[AnalystRole]
    ADD CONSTRAINT [FK_AnalystRole_Campaign] FOREIGN KEY ([pid]) REFERENCES [dbo].[Campaign] ([pid]);


GO
PRINT N'Creating [dbo].[FK_AnalystRole_Person]...';


GO
ALTER TABLE [dbo].[AnalystRole]
    ADD CONSTRAINT [FK_AnalystRole_Person] FOREIGN KEY ([person_id]) REFERENCES [dbo].[Person] ([id]);


GO
PRINT N'Creating [dbo].[FK_BatchBatchUpdate_Batch]...';


GO
ALTER TABLE [dbo].[BatchBatchUpdate]
    ADD CONSTRAINT [FK_BatchBatchUpdate_Batch] FOREIGN KEY ([batch_id]) REFERENCES [dbo].[Batch] ([id]);


GO
PRINT N'Creating [dbo].[FK_BatchBatchUpdate_BatchUpdate]...';


GO
ALTER TABLE [dbo].[BatchBatchUpdate]
    ADD CONSTRAINT [FK_BatchBatchUpdate_BatchUpdate] FOREIGN KEY ([batch_update_id]) REFERENCES [dbo].[BatchUpdate] ([id]);


GO
PRINT N'Creating [dbo].[FK_BatchUpdate_MediaBuyerApprovalStatus]...';


GO
ALTER TABLE [dbo].[BatchUpdate]
    ADD CONSTRAINT [FK_BatchUpdate_MediaBuyerApprovalStatus] FOREIGN KEY ([media_buyer_approval_status_id]) REFERENCES [dbo].[MediaBuyerApprovalStatus] ([id]);


GO
PRINT N'Creating [dbo].[FK_BatchUpdate_MediaBuyerApprovalStatusFrom]...';


GO
ALTER TABLE [dbo].[BatchUpdate]
    ADD CONSTRAINT [FK_BatchUpdate_MediaBuyerApprovalStatusFrom] FOREIGN KEY ([from_media_buyer_approval_status_id]) REFERENCES [dbo].[MediaBuyerApprovalStatus] ([id]);


GO
PRINT N'Creating [dbo].[FK_CampAff_Affiliate]...';


GO
ALTER TABLE [dbo].[CampAff]
    ADD CONSTRAINT [FK_CampAff_Affiliate] FOREIGN KEY ([affid]) REFERENCES [dbo].[Affiliate] ([affid]);


GO
PRINT N'Creating [dbo].[FK_CampAff_Analyst]...';


GO
ALTER TABLE [dbo].[CampAff]
    ADD CONSTRAINT [FK_CampAff_Analyst] FOREIGN KEY ([analyst_id]) REFERENCES [dbo].[Analyst] ([id]);


GO
PRINT N'Creating [dbo].[FK_CampAff_Campaign]...';


GO
ALTER TABLE [dbo].[CampAff]
    ADD CONSTRAINT [FK_CampAff_Campaign] FOREIGN KEY ([pid]) REFERENCES [dbo].[Campaign] ([pid]);


GO
PRINT N'Creating [dbo].[FK_CampAff_Strategist]...';


GO
ALTER TABLE [dbo].[CampAff]
    ADD CONSTRAINT [FK_CampAff_Strategist] FOREIGN KEY ([strategist_id]) REFERENCES [dbo].[Strategist] ([id]);


GO
PRINT N'Creating [dbo].[Campaign_DTCampaignStatus_name_FK_DTCampaignStatus_name_UK]...';


GO
ALTER TABLE [dbo].[Campaign]
    ADD CONSTRAINT [Campaign_DTCampaignStatus_name_FK_DTCampaignStatus_name_UK] FOREIGN KEY ([dt_campaign_status]) REFERENCES [dbo].[DTCampaignStatus] ([name]);


GO
PRINT N'Creating [dbo].[Campaign_CampaignStatus_id_FK_CampaignStatus_id_PK]...';


GO
ALTER TABLE [dbo].[Campaign]
    ADD CONSTRAINT [Campaign_CampaignStatus_id_FK_CampaignStatus_id_PK] FOREIGN KEY ([campaign_status_id]) REFERENCES [dbo].[CampaignStatus] ([id]);


GO
PRINT N'Creating [dbo].[Campaign_Advertiser_id_FK_Advertiser_id_PK]...';


GO
ALTER TABLE [dbo].[Campaign]
    ADD CONSTRAINT [Campaign_Advertiser_id_FK_Advertiser_id_PK] FOREIGN KEY ([advertiser_id]) REFERENCES [dbo].[Advertiser] ([id]);


GO
PRINT N'Creating [dbo].[Campaign_AdManager_id_FK_AdManager_id_PK]...';


GO
ALTER TABLE [dbo].[Campaign]
    ADD CONSTRAINT [Campaign_AdManager_id_FK_AdManager_id_PK] FOREIGN KEY ([ad_manager_id]) REFERENCES [dbo].[AdManager] ([id]);


GO
PRINT N'Creating [dbo].[Campaign_AccountManager_id_FK_AccountManager_id_PK]...';


GO
ALTER TABLE [dbo].[Campaign]
    ADD CONSTRAINT [Campaign_AccountManager_id_FK_AccountManager_id_PK] FOREIGN KEY ([account_manager_id]) REFERENCES [dbo].[AccountManager] ([id]);


GO
PRINT N'Creating [dbo].[tracking_system_fk]...';


GO
ALTER TABLE [dbo].[Campaign]
    ADD CONSTRAINT [tracking_system_fk] FOREIGN KEY ([tracking_system_id]) REFERENCES [dbo].[TrackingSystem] ([id]);


GO
PRINT N'Creating [dbo].[CampaignNotes_Campaign_pid_FK_Campaign_pid_UK]...';


GO
ALTER TABLE [dbo].[CampaignNotes]
    ADD CONSTRAINT [CampaignNotes_Campaign_pid_FK_Campaign_pid_UK] FOREIGN KEY ([campaign_id]) REFERENCES [dbo].[Campaign] ([pid]);


GO
PRINT N'Creating [dbo].[FK_Invoice_InvoiceStatus]...';


GO
ALTER TABLE [dbo].[Invoice]
    ADD CONSTRAINT [FK_Invoice_InvoiceStatus] FOREIGN KEY ([invoice_status_id]) REFERENCES [dbo].[InvoiceStatus] ([id]);


GO
PRINT N'Creating [dbo].[FK_InvoiceItem_Affiliate]...';


GO
ALTER TABLE [dbo].[InvoiceItem]
    ADD CONSTRAINT [FK_InvoiceItem_Affiliate] FOREIGN KEY ([affid]) REFERENCES [dbo].[Affiliate] ([affid]);


GO
PRINT N'Creating [dbo].[FK_InvoiceItem_Campaign]...';


GO
ALTER TABLE [dbo].[InvoiceItem]
    ADD CONSTRAINT [FK_InvoiceItem_Campaign] FOREIGN KEY ([pid]) REFERENCES [dbo].[Campaign] ([pid]);


GO
PRINT N'Creating [dbo].[FK_InvoiceItem_Currency]...';


GO
ALTER TABLE [dbo].[InvoiceItem]
    ADD CONSTRAINT [FK_InvoiceItem_Currency] FOREIGN KEY ([currency_id]) REFERENCES [dbo].[Currency] ([id]);


GO
PRINT N'Creating [dbo].[FK_InvoiceItem_Invoice]...';


GO
ALTER TABLE [dbo].[InvoiceItem]
    ADD CONSTRAINT [FK_InvoiceItem_Invoice] FOREIGN KEY ([invoice_id]) REFERENCES [dbo].[Invoice] ([id]);


GO
PRINT N'Creating [dbo].[FK_InvoiceItem_UnitType]...';


GO
ALTER TABLE [dbo].[InvoiceItem]
    ADD CONSTRAINT [FK_InvoiceItem_UnitType] FOREIGN KEY ([unit_type_id]) REFERENCES [dbo].[UnitType] ([id]);


GO
PRINT N'Creating [dbo].[FK_InvoiceNote_Invoice]...';


GO
ALTER TABLE [dbo].[InvoiceNote]
    ADD CONSTRAINT [FK_InvoiceNote_Invoice] FOREIGN KEY ([invoice_id]) REFERENCES [dbo].[Invoice] ([id]);


GO
PRINT N'Creating [dbo].[FK_MarginApproval_Affiliate]...';


GO
ALTER TABLE [dbo].[MarginApproval]
    ADD CONSTRAINT [FK_MarginApproval_Affiliate] FOREIGN KEY ([affid]) REFERENCES [dbo].[Affiliate] ([affid]);


GO
PRINT N'Creating [dbo].[FK_MarginApproval_Campaign]...';


GO
ALTER TABLE [dbo].[MarginApproval]
    ADD CONSTRAINT [FK_MarginApproval_Campaign] FOREIGN KEY ([pid]) REFERENCES [dbo].[Campaign] ([pid]);


GO
PRINT N'Creating [dbo].[FK_MarginApproval_Currency]...';


GO
ALTER TABLE [dbo].[MarginApproval]
    ADD CONSTRAINT [FK_MarginApproval_Currency] FOREIGN KEY ([revenue_currency_id]) REFERENCES [dbo].[Currency] ([id]);


GO
PRINT N'Creating [dbo].[FK_MarginApproval_Currency1]...';


GO
ALTER TABLE [dbo].[MarginApproval]
    ADD CONSTRAINT [FK_MarginApproval_Currency1] FOREIGN KEY ([cost_currency_id]) REFERENCES [dbo].[Currency] ([id]);


GO
PRINT N'Creating [dbo].[FK_PaymentBatch_AffiliatePaymentMethod]...';


GO
ALTER TABLE [dbo].[PaymentBatch]
    ADD CONSTRAINT [FK_PaymentBatch_AffiliatePaymentMethod] FOREIGN KEY ([payment_method_id]) REFERENCES [dbo].[AffiliatePaymentMethod] ([id]);


GO
PRINT N'Creating [dbo].[FK_PaymentBatch_PaymentBatch]...';


GO
ALTER TABLE [dbo].[PaymentBatch]
    ADD CONSTRAINT [FK_PaymentBatch_PaymentBatch] FOREIGN KEY ([parent_batch_id]) REFERENCES [dbo].[PaymentBatch] ([id]);


GO
PRINT N'Creating [dbo].[FK_PaymentBatch_PaymentBatchState]...';


GO
ALTER TABLE [dbo].[PaymentBatch]
    ADD CONSTRAINT [FK_PaymentBatch_PaymentBatchState] FOREIGN KEY ([payment_batch_state_id]) REFERENCES [dbo].[PaymentBatchState] ([id]);


GO
PRINT N'Creating [dbo].[Payout_Currency_id_FK_Currency_id_PK]...';


GO
ALTER TABLE [dbo].[Payout]
    ADD CONSTRAINT [Payout_Currency_id_FK_Currency_id_PK] FOREIGN KEY ([currency_id]) REFERENCES [dbo].[Currency] ([id]);


GO
PRINT N'Creating [dbo].[Publisher_Affiliate_affid_FK_Affiliate_affid_UK]...';


GO
ALTER TABLE [dbo].[Publisher]
    ADD CONSTRAINT [Publisher_Affiliate_affid_FK_Affiliate_affid_UK] FOREIGN KEY ([affid]) REFERENCES [dbo].[Affiliate] ([affid]);


GO
PRINT N'Creating [dbo].[PubReportEmail_PubReportInstance_id_FK_PubReportInstance_id_PK]...';


GO
ALTER TABLE [dbo].[PubReportEmail]
    ADD CONSTRAINT [PubReportEmail_PubReportInstance_id_FK_PubReportInstance_id_PK] FOREIGN KEY ([pub_report_instance_id]) REFERENCES [dbo].[PubReportInstance] ([id]);


GO
PRINT N'Creating [dbo].[PubReportInstance_Vendor_id_FK_Vendor_id_PK]...';


GO
ALTER TABLE [dbo].[PubReportInstance]
    ADD CONSTRAINT [PubReportInstance_Vendor_id_FK_Vendor_id_PK] FOREIGN KEY ([vendor_id]) REFERENCES [dbo].[Vendor] ([id]);


GO
PRINT N'Creating [dbo].[Stat_Payout_id_FK_Payout_id_PK1]...';


GO
ALTER TABLE [dbo].[Stat]
    ADD CONSTRAINT [Stat_Payout_id_FK_Payout_id_PK1] FOREIGN KEY ([cost_payout_id]) REFERENCES [dbo].[Payout] ([id]);


GO
PRINT N'Creating [dbo].[Stat_Payout_id_FK_Payout_id_PK]...';


GO
ALTER TABLE [dbo].[Stat]
    ADD CONSTRAINT [Stat_Payout_id_FK_Payout_id_PK] FOREIGN KEY ([revenue_payout_id]) REFERENCES [dbo].[Payout] ([id]);


GO
PRINT N'Creating [dbo].[Stat_Campaign_pid_FK_Campaign_pid_UK]...';


GO
ALTER TABLE [dbo].[Stat]
    ADD CONSTRAINT [Stat_Campaign_pid_FK_Campaign_pid_UK] FOREIGN KEY ([pid]) REFERENCES [dbo].[Campaign] ([pid]);


GO
PRINT N'Creating [dbo].[Stat_Affiliate_affid_FK_Affiliate_affid_UK]...';


GO
ALTER TABLE [dbo].[Stat]
    ADD CONSTRAINT [Stat_Affiliate_affid_FK_Affiliate_affid_UK] FOREIGN KEY ([affid]) REFERENCES [dbo].[Affiliate] ([affid]);


GO
PRINT N'Creating [dbo].[FK_UnitType_IncomeType]...';


GO
ALTER TABLE [dbo].[UnitType]
    ADD CONSTRAINT [FK_UnitType_IncomeType] FOREIGN KEY ([income_type_id]) REFERENCES [dbo].[IncomeType] ([id]);


GO
PRINT N'Creating [dbo].[tr_Affiliate_IU]...';


GO
-- =============================================
-- Author:		Aaron Anodide
-- Create date: 4/10/12
-- Description:	Set created_date after an Affiliate is inserted
--              and update modified date after Affiliate is updated.
--              Additionally ensures that date_created never changes.
-- =============================================
CREATE TRIGGER [dbo].[tr_Affiliate_IU] 
   ON  [dbo].[Affiliate] 
   AFTER INSERT, UPDATE
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	-- Get the current date.
	DECLARE @getDate DATETIME = GETDATE()

    -- Set the initial values of date_created and date_modified.
    UPDATE
		dbo.Affiliate
    SET 
		 date_created = @getDate
    FROM
		dbo.Affiliate A 
		INNER JOIN INSERTED I ON A.id = I.id
		LEFT OUTER JOIN DELETED D ON I.id = D.id
	WHERE
		D.id IS NULL
		
	-- Ensure the value of date_created does never changes.
    -- Update the value of date_modified to the current date.
    UPDATE
		dbo.Affiliate
    SET
		 date_created = D.date_created
		,date_modified = @getDate
    FROM 
		dbo.Affiliate A 
		INNER JOIN INSERTED I ON A.id = I.id
		INNER JOIN DELETED D ON I.id = D.id 
END
-- ===========================
-- TODO: improve this trigger using the following re-write from http://stackoverflow.com/questions/10097685/are-these-joins-inside-an-after-insert-update-trigger-equiv-to-using-if-update
-- ===========================
--CREATE TRIGGER [dbo].[tr_Affiliate_IU]  
--   ON  [dbo].[Affiliate]  
--   AFTER INSERT, UPDATE 
--AS 
--BEGIN 
--    -- SET NOCOUNT ON added to prevent extra result sets from 
--    -- interfering with SELECT statements. 
--    SET NOCOUNT ON; 
 
--    -- Get the current date. 
--    DECLARE @getDate DATETIME = GETDATE() 
 
--    -- Set the initial values of date_created and date_modified. 
--    UPDATE 
--        dbo.Affiliate 
--    SET  
--      -- If there is a record for this ID in Deleted 
--         date_created = case when D.id is not null  
--                          -- Take date of creation from Deleted 
--                             then D.date_created  
--                             else @getDate  
--                             end 
--        ,date_modified = @getDate 
--    FROM 
--        dbo.Affiliate A  
--        INNER JOIN INSERTED I ON A.id = I.id 
--        LEFT OUTER JOIN DELETED D ON I.id = D.id 
--END 
GO
PRINT N'Creating [dbo].[tr_CampaignNotes_U]...';


GO
CREATE TRIGGER tr_CampaignNotes_U on CampaignNotes FOR UPDATE AS
    BEGIN
        RAISERROR ('cannot update note', 16, 1)
        ROLLBACK TRANSACTION
        RETURN
    END
GO
PRINT N'Creating [dbo].[AccountManagerAccessList]...';


GO
CREATE VIEW [dbo].[AccountManagerAccessList]
AS
select substring(P.Tag,19,100) as Name
from [$(EomToolSecurity)].[dbo].Groups G
join [$(EomToolSecurity)].[dbo].RoleGroup RG ON G.Id=RG.Groups_Id
join [$(EomToolSecurity)].[dbo].RolePermission RP ON RG.Roles_Id=RP.Roles_Id
join [$(EomToolSecurity)].[dbo].Permissions P ON RP.Permissions_Id=P.Id
where WindowsIdentity like '%' + SUSER_NAME() + '%' and Tag like 'Workflow.Finalize%'
GO
PRINT N'Creating [dbo].[AdvertiserView1]...';


GO
CREATE view [dbo].[AdvertiserView1] as
select 
	A.id			AdvertiserID,
	A.name			AdvertiserName
from Advertiser A
GO
PRINT N'Creating [dbo].[Affiliate_Default_Payout_View_1]...';


GO
CREATE VIEW [dbo].[Affiliate_Default_Payout_View_1]
AS
SELECT     TOP (100) PERCENT D.pid, P.lead, P.currency_id
FROM         dbo.Payout AS P INNER JOIN
                          (SELECT     pid, MAX(effective_date) AS maxd, payout_type, affid
                            FROM          dbo.Payout
                            WHERE      (payout_type = 'affiliate') AND (affid = 0)
                            GROUP BY pid, payout_type, affid) AS D ON P.pid = D.pid AND P.effective_date = D.maxd AND P.payout_type = D.payout_type AND P.affid = D.affid
ORDER BY D.pid
GO
PRINT N'Creating [dbo].[AffiliatePayoutView1]...';


GO
CREATE view [dbo].[AffiliatePayoutView1] as
select 
	P.id			AffiliatePayoutID,
	P.payout_id		AffiliatePayoutPayoutID,
	P.pid			AffiliatePayoutCampaignPID,
	P.affid			AffiliatePayoutAffiliateAffid,
	C.name			AffiliatePayoutCurrency,
	CASE WHEN P.affid = 0 THEN 'Y' ELSE 'N' END AffiliatePayoutIsDefault
from Payout P
inner join Currency C on P.currency_id = C.id
where payout_type = 'affiliate'
GO
PRINT N'Creating [dbo].[AffiliateView1]...';


GO
CREATE view [dbo].[AffiliateView1] as
select 
	A.id			AffiateID,
	A.affid			AffilaiteAffilaiteID,
	A.name			AffiliateName,
	A.email			AffiliateEmail,
	A.add_code		AffiliateAddCode,
	N.name			AffiliateNetTerm,
	P.name			AffiliatePaymentMethod,
	C.name			AffiliatePaymentCurrency,
	MB.name			MediaBuyerName,
    A.date_created  Created
from Affiliate A
inner join MediaBuyer MB on A.media_buyer_id = MB.id
inner join Currency C on A.currency_id = C.id
inner join NetTermType N on A.net_term_type_id = N.id
inner join AffiliatePaymentMethod P on A.payment_method_id = P.id
GO
PRINT N'Creating [dbo].[AffiliateView1Details1]...';


GO
create view [dbo].[AffiliateView1Details1] as
select 
	A.id			AffiateID,
	A.affid			AffilaiteAffilaiteID,
	A.name			AffiliateName,
	A.email			AffiliateEmail,
	A.add_code		AffiliateAddCode,
	N.name			AffiliateNetTerm,
	P.name			AffiliatePaymentMethod,
	C.name			AffiliatePaymentCurrency,
	MB.name			MediaBuyerName
from Affiliate A
inner join MediaBuyer MB on A.media_buyer_id = MB.id
inner join Currency C on A.currency_id = C.id
inner join NetTermType N on A.net_term_type_id = N.id
inner join AffiliatePaymentMethod P on A.payment_method_id = P.id
GO
PRINT N'Creating [dbo].[Campaign_Default_Payout_View_1]...';


GO
CREATE VIEW [dbo].[Campaign_Default_Payout_View_1]
AS
SELECT     TOP (100) PERCENT D.pid, P.lead, P.currency_id
FROM         dbo.Payout AS P INNER JOIN
                          (SELECT     pid, MAX(effective_date) AS maxd, payout_type, affid
                            FROM          dbo.Payout
                            WHERE      (payout_type = 'campaign') AND (affid = 0)
                            GROUP BY pid, payout_type, affid) AS D ON P.pid = D.pid AND P.effective_date = D.maxd AND P.payout_type = D.payout_type AND P.affid = D.affid
ORDER BY D.pid
GO
PRINT N'Creating [dbo].[CampaignPayoutView1]...';


GO
CREATE view [dbo].[CampaignPayoutView1] as
select 
	P.id			CampaignPayoutID,
	P.payout_id		CampaignPayoutPayoutID,
	P.pid			CampaignPayoutCampaignPID,
	P.affid			CampaignPayoutAffiliateAffid,
	C.name			CampaignPayoutCurrency,
	CASE WHEN P.affid = 0 THEN 'Y' ELSE 'N' END CampaignPayoutIsDefault
from Payout P
inner join Currency C on P.currency_id = C.id
where payout_type = 'campaign'
GO
PRINT N'Creating [dbo].[CampaignView1]...';


GO
--drop view StatView1 as
--select 
--	S.id		StatID, 
--	RevP.id		StatRevPayoutID, 
--	RevC.id		CostPayoutID,
--	C.id		CampaignID,
--	C.pid		CampaignPID
--from Stat S
--go
--select * from StatView1
--go

--drop view ItemView1 as
--select 
--	I.id ItemID, 
--	S.StatID, 
--	S.RevPayoutID, 
--	S.CostPayoutID
--from Item I
--inner join Campaign C on I.pid = C.pid
--inner join Affiliate A on I.affid = A.affid
--inner join [Source] SR on I.source_id = SR.id
--inner join UnitType UT on I.unit_type_id = UT.id
--inner join ItemAccountingStatus IAS on I.item_accounting_status_id = IAS.id
--inner join ItemReportingStatus IRS on I.item_reporting_status_id = IRS.id
--left outer join StatView1 S on I.stat_id_n = S.StatID
--go
--select * from ItemView1
--go

CREATE view [dbo].[CampaignView1] as
select
	C.id				CampaignID,
	C.pid				CampaignPID,
	C.campaign_name		CampaignName
from Campaign C
inner join AdManager AD on C.ad_manager_id = AD.id
inner join AccountManager AM on C.account_manager_id = AM.id
inner join CampaignStatus CS on C.campaign_status_id = CS.id
inner join Advertiser AV on C.advertiser_id = AV.id
GO
PRINT N'Creating [dbo].[CampaignView1Details1]...';


GO
CREATE view [dbo].[CampaignView1Details1] as
select
	C.id				CampaignID,
	C.pid				CampaignPID,
	C.campaign_name		CampaignName,
	AM.name				CampaignAccountManagerName,
	AD.name				CampaignAdManagerName,
	AV.name				CampaignAdvertiserName,
	CS.name				CampaignStatus
from Campaign C
inner join AdManager AD on C.ad_manager_id = AD.id
inner join AccountManager AM on C.account_manager_id = AM.id
inner join CampaignStatus CS on C.campaign_status_id = CS.id
inner join Advertiser AV on C.advertiser_id = AV.id
GO
PRINT N'Creating [dbo].[DA_Wiki_View_1]...';


GO
CREATE VIEW [dbo].[DA_Wiki_View_1]
AS
SELECT     dbo.Campaign.pid AS PID, dbo.Campaign.campaign_name AS Campaign, dbo.Campaign.campaign_type AS Type, dbo.Advertiser.name AS Advertiser, 
                      dbo.DTCampaignStatus.name AS Status, dbo.AccountManager.name AS AM, dbo.AdManager.name AS AD, dbo.Campaign.notes AS Notes, 
                      dbo.Campaign.dt_campaign_url AS URL, dbo.Campaign.dt_allowed_country_names AS Countries, dbo.Campaign.is_email AS Email, 
                      dbo.Campaign.is_search AS Search, dbo.Campaign.is_display AS Display, dbo.Campaign.is_coreg AS CoReg, dbo.Campaign.max_scrub AS [Max Scrub], 
                      dbo.Campaign.modified AS Modified, dbo.Campaign.created AS Created
FROM         dbo.Campaign INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.DTCampaignStatus ON dbo.Campaign.dt_campaign_status = dbo.DTCampaignStatus.name
GO
PRINT N'Creating [dbo].[FakePublishers]...';


GO
CREATE VIEW [dbo].[FakePublishers]
AS
SELECT DISTINCT name
FROM         dbo.Affiliate
WHERE     (name IN ('DAS', 'DA- Marchex', 'Direct Agents Search Team', 'Extra', 'Direct Agents Creative Servcies'))
GO
PRINT N'Creating [dbo].[LatestCampaignNote]...';


GO
CREATE VIEW [dbo].[LatestCampaignNote] AS

with T as 
(
	select id, campaign_id, note,
	row_number() over(partition by campaign_id order by id desc) as rn
	from CampaignNotes
)
select campaign_id, note from T
where rn=1
GO
PRINT N'Creating [dbo].[PayoutView1]...';


GO
--<?xml version="1.0" encoding="utf-8"?>
--<payout xmlns="http://www.digitalriver.com/directtrack/api/payout/v1_0" 
--xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
--xsi:schemaLocation="http://www.digitalriver.com/directtrack/api/payout/v1_0 payout.xsd"
--location="https://da-tracking.com/apifleet/rest/1137/payout/c3954">
--<payoutType>campaign</payoutType>
--<campaignResourceURL location="../campaign/1654"/>
--<affiliate allAffiliates="1"/>
--<impression>0</impression>
--<click>0</click>
--<lead>0</lead>
--<percentSale>0</percentSale>
--<flatSale>0</flatSale>
--<percentSubSale>0</percentSubSale>
--<flatSubSale>0</flatSubSale>
--<currency>USD</currency>
--</payout>

CREATE view [dbo].[PayoutView1] as
select 
	*
from Payout P
GO
PRINT N'Creating [dbo].[PayoutView1Details1]...';


GO
CREATE view [dbo].[PayoutView1Details1] as
select	
	id					PayoutID, 
	payout_id			PayoutPayoutID,
	pid					PayoutCampaignPID,
	affid				PayoutAffiliateAffid,
	impression,
	click,
	lead, 
	percent_sale		percentSale, 
	flat_sale			flatSale, 
	percent_sub_sale	percentSubSale, 
	flat_sub_sale		flatSubSale, 
	effective_date		effectiveDate, 
	modify_date			modifyDate, 
	product_id			productId
from
	Payout P
GO
PRINT N'Creating [dbo].[vCampaigns]...';


GO
CREATE VIEW [dbo].[vCampaigns]
AS
SELECT     TOP (100) PERCENT dbo.Campaign.pid AS PID, dbo.Campaign.campaign_name AS Name, COALESCE (dbo.Campaign.campaign_type, 'not set') AS Type, 
                      dbo.CampaignStatus.name AS Status, dbo.AccountManager.name AS AM, dbo.AdManager.name AS AD, dbo.Advertiser.name AS Client
FROM         dbo.Campaign INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id
ORDER BY PID
GO
PRINT N'Creating [dbo].[vPublisherReportEmails]...';


GO
CREATE VIEW [dbo].[vPublisherReportEmails]
AS
SELECT     dbo.Vendor.name, dbo.PubReportEmail.to_email_address, dbo.PubReportEmail.sent_date, dbo.PubReportEmail.subject, 
                      dbo.PubReportInstance.created_by_user_name, dbo.PubReportInstance.path_to_hard_copy, dbo.PubReportInstance.saved, 
                      dbo.PubReportInstance.email_status_msg
FROM         dbo.PubReportEmail INNER JOIN
                      dbo.PubReportInstance ON dbo.PubReportEmail.pub_report_instance_id = dbo.PubReportInstance.id INNER JOIN
                      dbo.Vendor ON dbo.PubReportInstance.vendor_id = dbo.Vendor.id
GO
PRINT N'Creating [dbo].[ConvertCurrency]...';


GO
CREATE FUNCTION [dbo].[ConvertCurrency]
( )
RETURNS NVARCHAR (4000)
AS
 EXTERNAL NAME [SqlServerProjectForDADatabaseR3].[UserDefinedFunctions].[ConvertCurrency]


GO
PRINT N'Creating [dbo].[FormatCurrency1]...';


GO
CREATE FUNCTION [dbo].[FormatCurrency1]
(@amount MONEY)
RETURNS NVARCHAR (4000)
AS
 EXTERNAL NAME [DADatabaseSqlServer].[UserDefinedFunctions].[FormatCurrency1]


GO
PRINT N'Creating [dbo].[GetCampaignNotes]...';


GO
CREATE FUNCTION [dbo].[GetCampaignNotes]
(@pid INT)
RETURNS NVARCHAR (4000)
AS
 EXTERNAL NAME [SqlServerProject1].[UserDefinedFunctions].[GetCampaignNotes]


GO
PRINT N'Creating [dbo].[ListAnalysts]...';


GO

CREATE FUNCTION [dbo].[ListAnalysts]
(@pid int, @affid int)
RETURNS [varchar](4000)
AS 
BEGIN

DECLARE @analystString varchar(4000)

SELECT @analystString = COALESCE(@analystString + ', ', '') + first_name + ' ' + last_name
FROM AnalystRole ar
JOIN Person p ON ar.person_id = p.id
WHERE ar.pid = @pid AND ar.affid = @affid
ORDER BY first_name,last_name

RETURN ISNULL(@analystString,'')

END
GO
PRINT N'Creating [dbo].[tousd]...';


GO
CREATE FUNCTION [dbo].[tousd] 
(@Currency int, @Amount money)
RETURNS money
AS
BEGIN
return (@Amount * (select to_usd_multiplier from Currency where name=@Currency))
end
GO
PRINT N'Creating [dbo].[tousd3]...';


GO
CREATE FUNCTION [dbo].[tousd3] 
(@Currency int, @Amount money)
RETURNS money
AS
BEGIN
return (@Amount * (select to_usd_multiplier from Currency where id=@Currency))
end
GO
PRINT N'Creating [dbo].[Item]...';


GO
CREATE TABLE [dbo].[Item] (
    [id]                             INT             IDENTITY (1, 1) NOT NULL,
    [name]                           VARCHAR (300)   NULL,
    [pid]                            INT             NOT NULL,
    [affid]                          INT             NOT NULL,
    [source_id]                      INT             NOT NULL,
    [unit_type_id]                   INT             NOT NULL,
    [stat_id_n]                      INT             NULL,
    [revenue_currency_id]            INT             NOT NULL,
    [cost_currency_id]               INT             NOT NULL,
    [revenue_per_unit]               MONEY           NOT NULL,
    [cost_per_unit]                  MONEY           NOT NULL,
    [num_units]                      DECIMAL (16, 6) NOT NULL,
    [notes]                          NVARCHAR (MAX)  NOT NULL,
    [accounting_notes]               NVARCHAR (255)  NOT NULL,
    [item_accounting_status_id]      INT             NOT NULL,
    [item_reporting_status_id]       INT             NOT NULL,
    [campaign_status_id]             INT             NOT NULL,
    [total_revenue]                  AS              ([num_units] * [revenue_per_unit]),
    [total_cost]                     AS              ([num_units] * [cost_per_unit]),
    [margin]                         AS              ([dbo].[tousd3]([revenue_currency_id], [num_units] * [revenue_per_unit]) - [dbo].[tousd3]([cost_currency_id], [num_units] * [cost_per_unit])),
    [modified]                       AS              (GETDATE()),
    [media_buyer_approval_status_id] INT             NOT NULL,
    [batch_id]                       INT             NULL,
    [payment_batch_id]               INT             NULL,
    CONSTRAINT [Item_id_PK] PRIMARY KEY CLUSTERED ([id] ASC)
);


GO
PRINT N'Creating unnamed constraint on [dbo].[Item]...';


GO
ALTER TABLE [dbo].[Item]
    ADD DEFAULT 1 FOR [campaign_status_id];


GO
PRINT N'Creating unnamed constraint on [dbo].[Item]...';


GO
ALTER TABLE [dbo].[Item]
    ADD DEFAULT 1 FOR [media_buyer_approval_status_id];


GO
PRINT N'Creating [dbo].[Item_UnitType_id_FK_UnitType_id_PK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_UnitType_id_FK_UnitType_id_PK] FOREIGN KEY ([unit_type_id]) REFERENCES [dbo].[UnitType] ([id]);


GO
PRINT N'Creating [dbo].[Item_Stat_id_FK_Stat_id_PK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_Stat_id_FK_Stat_id_PK] FOREIGN KEY ([stat_id_n]) REFERENCES [dbo].[Stat] ([id]);


GO
PRINT N'Creating [dbo].[Item_Source_id_FK_Source_id_PK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_Source_id_FK_Source_id_PK] FOREIGN KEY ([source_id]) REFERENCES [dbo].[Source] ([id]);


GO
PRINT N'Creating [dbo].[Item_ItemReportingStatus_id_FK_ItemReportingStatus_id_PK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_ItemReportingStatus_id_FK_ItemReportingStatus_id_PK] FOREIGN KEY ([item_reporting_status_id]) REFERENCES [dbo].[ItemReportingStatus] ([id]);


GO
PRINT N'Creating [dbo].[Item_ItemAccountingStatus_id_FK_ItemAccountingStatus_id_PK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_ItemAccountingStatus_id_FK_ItemAccountingStatus_id_PK] FOREIGN KEY ([item_accounting_status_id]) REFERENCES [dbo].[ItemAccountingStatus] ([id]);


GO
PRINT N'Creating [dbo].[Item_Currency_id_FK_Currency_id_PK1]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_Currency_id_FK_Currency_id_PK1] FOREIGN KEY ([cost_currency_id]) REFERENCES [dbo].[Currency] ([id]);


GO
PRINT N'Creating [dbo].[Item_Currency_id_FK_Currency_id_PK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_Currency_id_FK_Currency_id_PK] FOREIGN KEY ([revenue_currency_id]) REFERENCES [dbo].[Currency] ([id]);


GO
PRINT N'Creating [dbo].[Item_Campaign_pid_FK_Campaign_pid_UK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_Campaign_pid_FK_Campaign_pid_UK] FOREIGN KEY ([pid]) REFERENCES [dbo].[Campaign] ([pid]);


GO
PRINT N'Creating [dbo].[Item_Affiliate_affid_FK_Affiliate_affid_UK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_Affiliate_affid_FK_Affiliate_affid_UK] FOREIGN KEY ([affid]) REFERENCES [dbo].[Affiliate] ([affid]);


GO
PRINT N'Creating unnamed constraint on [dbo].[Item]...';


GO
ALTER TABLE [dbo].[Item]
    ADD FOREIGN KEY ([media_buyer_approval_status_id]) REFERENCES [dbo].[MediaBuyerApprovalStatus] ([id]);


GO
PRINT N'Creating [dbo].[FK_Item_PaymentBatch]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [FK_Item_PaymentBatch] FOREIGN KEY ([payment_batch_id]) REFERENCES [dbo].[PaymentBatch] ([id]);


GO
PRINT N'Creating [dbo].[FK_Item_Batch]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [FK_Item_Batch] FOREIGN KEY ([batch_id]) REFERENCES [dbo].[Batch] ([id]);


GO
PRINT N'Creating [dbo].[Item_CampaignStatus_id_FK_CampaignStatus_id_PK]...';


GO
ALTER TABLE [dbo].[Item]
    ADD CONSTRAINT [Item_CampaignStatus_id_FK_CampaignStatus_id_PK] FOREIGN KEY ([campaign_status_id]) REFERENCES [dbo].[CampaignStatus] ([id]);


GO
PRINT N'Creating [dbo].[FK_ItemVerificationDate_Item]...';


GO
ALTER TABLE [dbo].[ItemVerificationDate]
    ADD CONSTRAINT [FK_ItemVerificationDate_Item] FOREIGN KEY ([item_id]) REFERENCES [dbo].[Item] ([id]);


GO
PRINT N'Creating [dbo].[ab_Advertisers_TotalRevenue]...';


GO
CREATE VIEW [dbo].[ab_Advertisers_TotalRevenue]
AS
SELECT     TOP (100) PERCENT dbo.Advertiser.id AS AdvertiserId, dbo.Advertiser.name AS AdvertiserName, dbo.Item.revenue_currency_id AS RevenueCurrencyId, 
                      SUM(dbo.Item.total_revenue) AS TotalRevenue
FROM         dbo.Advertiser INNER JOIN
                      dbo.Campaign ON dbo.Advertiser.id = dbo.Campaign.advertiser_id INNER JOIN
                      dbo.Item ON dbo.Campaign.pid = dbo.Item.pid
GROUP BY dbo.Advertiser.name, dbo.Item.revenue_currency_id, dbo.Advertiser.id
ORDER BY AdvertiserName
GO
PRINT N'Creating [dbo].[AccountingDetails]...';


GO
CREATE VIEW [dbo].[AccountingDetails]
AS
SELECT     COALESCE (dbo.Publisher.name, dbo.Affiliate.name) AS Publisher, dbo.Affiliate.name AS Affiliate, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid, 
                      dbo.Campaign.campaign_name AS Campaign, dbo.Currency.name AS [Rev Curr], Currency_1.name AS [Cost Curr], Currency_2.name AS [Pay Curr], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.Item.cost_per_unit AS [Cost/Unit], SUM(dbo.Item.num_units) AS Units, dbo.UnitType.name AS [Unit Type], 
                      SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.Item.total_cost) AS Cost, dbo.MediaBuyer.name AS [Media Buyer], dbo.AdManager.name AS [Ad Manager], 
                      dbo.AccountManager.name AS [Account Manager], dbo.ItemAccountingStatus.name AS [Accounting Status], SUM(dbo.tousd3(dbo.Item.revenue_currency_id, 
                      dbo.Item.revenue_per_unit) * dbo.Item.num_units) AS [Rev USD], SUM(dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) * dbo.Item.num_units) 
                      AS [Cost USD]
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid LEFT OUTER JOIN
                      dbo.Publisher ON dbo.Item.affid = dbo.Publisher.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.Currency AS Currency_2 ON dbo.Affiliate.currency_id = Currency_2.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.AccountManagerAccessList ON dbo.AccountManager.name = dbo.AccountManagerAccessList.name
GROUP BY COALESCE (dbo.Publisher.name, dbo.Affiliate.name), dbo.Affiliate.name, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, 
                      dbo.Currency.name, Currency_1.name, Currency_2.name, dbo.Item.revenue_per_unit, dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, 
                      dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name
GO
PRINT N'Creating [dbo].[AccountingDetailsWithMargin]...';


GO
CREATE VIEW [dbo].[AccountingDetailsWithMargin]
AS
SELECT *, ([Rev USD])-([Cost USD]) [Margin USD]
FROM AccountingDetails
GO
PRINT N'Creating [dbo].[AccountingDetailsWithPercentMargin]...';


GO
CREATE VIEW [dbo].[AccountingDetailsWithPercentMargin]
AS
SELECT 
	*,
	CASE WHEN [Rev USD]!=0 THEN 
		([Margin USD]/[Rev USD])*100 
	ELSE 
		0 
	END 
	AS [%Margin]
FROM AccountingDetailsWithMargin
GO
PRINT N'Creating [dbo].[AccountingSheet2]...';


GO
CREATE VIEW [dbo].[AccountingSheet2] AS
WITH T AS (
	SELECT  TOP (100) PERCENT 
		  dbo.SumKeys(item.id) ItemIds
		, dbo.Affiliate.name2 AS Publisher
		, dbo.Advertiser.name AS Advertiser
		, dbo.Campaign.pid AS [Campaign Number]
		, dbo.Campaign.campaign_name AS [Campaign Name]
		, dbo.Currency.name AS [Rev Currency]
		, Currency_1.name AS [Cost Currency]
		, dbo.Item.revenue_per_unit AS [Rev/Unit]
		, dbo.tousd3(dbo.Item.revenue_currency_id
		, dbo.Item.revenue_per_unit) AS [Rev/Unit USD]
		, dbo.Item.cost_per_unit AS [Cost/Unit]
		, dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) AS [Cost/Unit USD]
		, SUM(dbo.Item.num_units) AS Units
		, dbo.UnitType.name AS [Unit Type]
		, SUM(dbo.Item.total_revenue) AS Revenue
		, SUM(dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit) * dbo.Item.num_units) AS [Revenue USD]
		, SUM(dbo.Item.total_cost) AS Cost
		, SUM(dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) * dbo.Item.num_units) AS [Cost USD]
		, SUM(dbo.Item.margin) AS Margin
		, dbo.MediaBuyer.name AS [Media Buyer]
		, dbo.AdManager.name AS [Ad Manager]
		, dbo.AccountManager.name AS [Account Manager]
		, dbo.CampaignStatus.name AS Status
		, dbo.ItemAccountingStatus.name AS [Accounting Status]
		, dbo.NetTermType.name
		, dbo.AffiliatePaymentMethod.name AS [Aff Pay Method]
		, dbo.Affiliate.currency_id
		, Currency_2.name AS Expr1
		, Currency_2.name AS [Pub Pay Curr]
		, Source.name AS Source
	FROM
		dbo.Item INNER JOIN
		dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
		dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
		dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
		dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
		dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
		dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
		dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
		dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
		dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
		dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
		dbo.CampaignStatus ON dbo.Item.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
		dbo.Source AS Source ON dbo.Item.source_id = Source.id LEFT OUTER JOIN
		dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id LEFT OUTER JOIN
		dbo.Currency AS Currency_2 ON dbo.Affiliate.currency_id = Currency_2.id LEFT OUTER JOIN
		dbo.NetTermType ON dbo.Affiliate.net_term_type_id = dbo.NetTermType.id LEFT OUTER JOIN
		dbo.AffiliatePaymentMethod ON dbo.Affiliate.payment_method_id = dbo.AffiliatePaymentMethod.id INNER JOIN
		dbo.AccountManagerAccessList ON dbo.AccountManager.name = dbo.AccountManagerAccessList.name
	GROUP BY 
		  dbo.Affiliate.name2
		, dbo.Advertiser.name
		, dbo.Campaign.pid
		, dbo.Campaign.campaign_name
		, dbo.Currency.name
		, Currency_1.name
		, dbo.Item.revenue_per_unit
		, dbo.Item.cost_per_unit
		, dbo.MediaBuyer.name
		, dbo.AdManager.name
		, dbo.AccountManager.name
		, dbo.ItemAccountingStatus.name
		, dbo.UnitType.name
		, dbo.CampaignStatus.name
		, dbo.tousd3(dbo.Item.revenue_currency_id
		, dbo.Item.revenue_per_unit)
		, dbo.tousd3(dbo.Item.cost_currency_id
		, dbo.Item.cost_per_unit)
		, dbo.NetTermType.name
		, dbo.AffiliatePaymentMethod.name
		, dbo.Affiliate.currency_id
		, Currency_2.name
		, Source.name
	--HAVING      
		--(dbo.CampaignStatus.name = 'Verified')
	ORDER BY 
		Publisher
)
SELECT
	  T.Publisher
	, T.Advertiser
	--, T.[Campaign Number]
	, T.[Campaign Name] [Campaign]
	, T.[Rev Currency] [Rev Curr]
	, T.[Cost Currency] [Cost Curr]
	, T.[Rev/Unit]
	--, T.[Rev/Unit USD]
	, T.[Cost/Unit]
	--, T.[Cost/Unit USD]
	, T.Units
	, T.[Unit Type]
	, T.Revenue [Rev]
	--, T.[Revenue USD]
	, T.Cost
	--, T.[Cost USD]
	--, T.[Revenue USD] - T.[Cost USD] AS Margin
	, (CASE WHEN [Revenue USD] = 0 THEN 0 ELSE ([Revenue USD] - [Cost USD]) / [Revenue USD] END) * 100 AS [%Margin]
	, T.Status [Campaign Status]
	, T.[Accounting Status]
	--, T.[Media Buyer], T.[Ad Manager]
	--, T.[Account Manager]
	---, T.name, T.[Aff Pay Method]
	--, T.[Pub Pay Curr]
	--, T.[Cost USD] / dbo.Currency.to_usd_multiplier AS [Pub Payout]
	--, dbo.GetCampaignNotes(T.[Campaign Number]) AS CampaignNotes
	--, T.[Source]
	, T.ItemIds
FROM 
	T INNER JOIN 
	dbo.Currency ON T.currency_id = dbo.Currency.id
GO
PRINT N'Creating [dbo].[AccountingView1]...';


GO

CREATE VIEW [dbo].[AccountingView1]
AS
SELECT     TOP (100) PERCENT dbo.Affiliate.name2 AS Publisher, dbo.affiliate.qb_name AS [Pub QB Name], dbo.Advertiser.name AS Advertiser, dbo.Advertiser.qb_name AS [Adv QB Name], dbo.Advertiser.alt_name AS [Adv Alt Name],
                      dbo.Advertiser.payment_terms AS [Adv Payment Terms], dbo.Campaign.pid AS [Campaign Number],
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency],
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit) AS [Rev/Unit USD],
                      dbo.Item.cost_per_unit AS [Cost/Unit], dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) AS [Cost/Unit USD], SUM(dbo.Item.num_units) AS Units,
                      dbo.UnitType.name AS [Unit Type], dbo.IncomeType.name AS [Income Type], dbo.IncomeType.qb_code AS [Cost Code], SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit) 
                      * dbo.Item.num_units) AS [Revenue USD], SUM(dbo.Item.total_cost) AS Cost, SUM(dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) 
                      * dbo.Item.num_units) AS [Cost USD], SUM(dbo.Item.margin) AS Margin, dbo.MediaBuyer.name AS [Media Buyer], dbo.ListAnalysts(Item.pid,Item.affid) AS Analysts,
                      dbo.Analyst.name AS [Analyst], dbo.Analyst.comm_rate AS [AN CommRate], dbo.AdManager.name AS [Ad Manager],
                      dbo.AnalystManager.name AS [Analyst Manager], dbo.AnalystManager.comm_rate AS [ANMGR CommRate],
                      dbo.Strategist.name AS [Strategist], dbo.Strategist.comm_rate AS [STR CommRate],
                      dbo.AccountManager.name AS [Account Manager], dbo.CampaignStatus.name AS Status, dbo.MediaBuyerApprovalStatus.name AS [MediaBuyerApproval Status],
                      dbo.ItemAccountingStatus.name AS [Accounting Status], dbo.NetTermType.name, dbo.AffiliatePaymentMethod.name AS [Aff Pay Method], dbo.Affiliate.currency_id,
                      Currency_2.name AS Expr1, Currency_2.name AS [Pub Pay Curr], Source.name AS Source,
                      dbo.Affiliate.[status] AS [Publisher Status], dbo.Affiliate.[payment_on_hold] AS [Publisher Payment On Hold]
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Item.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.Source AS Source ON dbo.Item.source_id = Source.id INNER JOIN
                      dbo.MediaBuyerApprovalStatus ON dbo.Item.media_buyer_approval_status_id = dbo.MediaBuyerApprovalStatus.id LEFT OUTER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id LEFT OUTER JOIN
                      dbo.Currency AS Currency_2 ON dbo.Affiliate.currency_id = Currency_2.id LEFT OUTER JOIN
                      dbo.NetTermType ON dbo.Affiliate.net_term_type_id = dbo.NetTermType.id LEFT OUTER JOIN
                      dbo.AffiliatePaymentMethod ON dbo.Affiliate.payment_method_id = dbo.AffiliatePaymentMethod.id LEFT OUTER JOIN
                      dbo.IncomeType ON dbo.UnitType.income_type_id = dbo.IncomeType.id LEFT OUTER JOIN
                      dbo.CampAff ON dbo.Item.pid = dbo.CampAff.pid AND dbo.Item.affid = dbo.CampAff.affid LEFT OUTER JOIN
                      dbo.Analyst ON dbo.CampAff.analyst_id = dbo.Analyst.id LEFT OUTER JOIN
                      dbo.AnalystManager ON dbo.Analyst.manager_id = dbo.AnalystManager.id LEFT OUTER JOIN
                      dbo.Strategist ON dbo.CampAff.strategist_id = dbo.Strategist.id INNER JOIN
                      dbo.AccountManagerAccessList ON dbo.AccountManager.name = dbo.AccountManagerAccessList.name
GROUP BY dbo.Affiliate.name2, dbo.Affiliate.qb_name, dbo.Advertiser.name, dbo.Advertiser.qb_name, dbo.Advertiser.alt_name, dbo.Advertiser.payment_terms, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit,
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, dbo.IncomeType.name, dbo.IncomeType.qb_code,
                      dbo.CampaignStatus.name, dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit), dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit),
                      dbo.NetTermType.name, dbo.AffiliatePaymentMethod.name, dbo.Affiliate.currency_id, Currency_2.name, Source.name, dbo.MediaBuyerApprovalStatus.name,
                      dbo.Affiliate.[status], dbo.Affiliate.[payment_on_hold], dbo.ListAnalysts(Item.pid,Item.affid),
                      dbo.Analyst.name, dbo.Analyst.comm_rate, dbo.AnalystManager.name, dbo.AnalystManager.comm_rate, dbo.Strategist.name, dbo.Strategist.comm_rate
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[AccountingView2]...';


GO

CREATE VIEW [dbo].[AccountingView2] AS
SELECT     dbo.AccountingView1.Publisher, dbo.AccountingView1.[Pub QB Name],
           CASE WHEN dbo.AccountingView1.[Adv Alt Name] <> '' THEN dbo.AccountingView1.[Adv Alt Name] ELSE dbo.AccountingView1.Advertiser END AS [Advertiser],
                      dbo.AccountingView1.[Adv QB Name], dbo.AccountingView1.[Adv Payment Terms],
                      dbo.AccountingView1.[Campaign Number], dbo.AccountingView1.[Campaign Name], 
                      dbo.AccountingView1.[Rev Currency], dbo.AccountingView1.[Cost Currency], dbo.AccountingView1.[Rev/Unit], dbo.AccountingView1.[Rev/Unit USD], 
                      dbo.AccountingView1.[Cost/Unit], dbo.AccountingView1.[Cost/Unit USD], dbo.AccountingView1.Units,
                      dbo.AccountingView1.[Unit Type], dbo.AccountingView1.[Income Type], dbo.AccountingView1.[Cost Code],
					  dbo.AccountingView1.Revenue, dbo.AccountingView1.[Revenue USD], dbo.AccountingView1.Cost, dbo.AccountingView1.[Cost USD],
                      dbo.AccountingView1.[Revenue USD] - dbo.AccountingView1.[Cost USD] AS Margin, (CASE WHEN [Revenue USD] = 0 THEN 0 ELSE ([Revenue USD] - [Cost USD]) / [Revenue USD] END) * 100 AS [%Margin],
					  sum([Cost USD]) over(partition by [Campaign Number]) as [Total Campaign Cost USD], dbo.AccountingView1.[Media Buyer], dbo.AccountingView1.[Analyst], dbo.AccountingView1.[Ad Manager], dbo.AccountingView1.[Account Manager], 
                      dbo.AccountingView1.Status, dbo.AccountingView1.[MediaBuyerApproval Status], dbo.AccountingView1.[Accounting Status], dbo.AccountingView1.name, dbo.AccountingView1.[Aff Pay Method], 
                      dbo.AccountingView1.[Pub Pay Curr], dbo.AccountingView1.[Cost USD] / dbo.Currency.to_usd_multiplier AS [Pub Payout],
					  CASE WHEN sum([Cost USD]) over(partition by [Campaign Number])=0 THEN 0 ELSE [Cost USD] * 100.0 / sum([Cost USD]) over(partition by [Campaign Number]) END as [Percentage of Traffic Generated],
                      dbo.GetCampaignNotes(dbo.AccountingView1.[Campaign Number]) AS CampaignNotes, dbo.AccountingView1.[Source]
FROM         dbo.AccountingView1 INNER JOIN
                      dbo.Currency ON dbo.AccountingView1.currency_id = dbo.Currency.id
WHERE        dbo.AccountingView1.Revenue<>0 OR dbo.AccountingView1.Cost<>0
GO
PRINT N'Creating [dbo].[AccountManagerView]...';


GO
CREATE VIEW [dbo].[AccountManagerView]
AS
SELECT     TOP (100) PERCENT dbo.Affiliate.name2 AS Publisher, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid AS [Campaign Number], 
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.Item.cost_per_unit AS [Cost/Unit], SUM(dbo.Item.num_units) AS Units, dbo.UnitType.name AS [Unit Type], 
                      SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.Item.total_cost) AS Cost, SUM(dbo.Item.margin) AS Margin, dbo.MediaBuyer.name AS [Media Buyer], 
                      dbo.AdManager.name AS [Ad Manager], dbo.AccountManager.name AS [Account Manager], dbo.CampaignStatus.name AS Status, 
                      dbo.ItemAccountingStatus.name AS [Accounting Status], dbo.[Source].name AS [Source]
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.[Source] ON dbo.Item.source_id = dbo.Source.id INNER JOIN
                      dbo.AccountManagerAccessList ON dbo.AccountManager.name = dbo.AccountManagerAccessList.name
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name, dbo.[Source].name
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[AdvertiserPaymentStatus]...';


GO
CREATE VIEW [dbo].[AdvertiserPaymentStatus] AS
SELECT
dbo.AccountingView1.[Publisher Payment On Hold] AS [Payment On Hold],
dbo.AccountingView1.Publisher,
dbo.AccountingView1.[Publisher Status],
dbo.AccountingView1.[name] AS [Publisher Net Terms],
dbo.AccountingView1.Advertiser,
dbo.Advertiser.[status] AS [Advertiser Status],
dbo.Advertiser.[payment_terms] AS [Advertiser Payment Terms],
CASE WHEN sum([Cost USD]) over(partition by [Campaign Number])=0 THEN 0 ELSE [Cost USD] * 100.0 / sum([Cost USD]) over(partition by [Campaign Number]) END as [Percentage of Traffic Generated],
dbo.Advertiser.[comments] AS [Comments],
dbo.Advertiser.[prev_open_balance] AS [Previous Periods Open Balance],
dbo.Advertiser.[invoicing_status] AS [Current Period Invoicing Status],
CASE WHEN dbo.AccountingView1.[Status]='default' THEN 'Unfinalized' ELSE 'Finalized' END AS [Finalization Status],
dbo.AccountingView1.[Accounting Status],
dbo.AccountingView1.[Unit Type],
dbo.AccountingView1.[Campaign Name],
dbo.AccountingView1.[Rev Currency],
dbo.AccountingView1.[Revenue],
dbo.AccountingView1.[Revenue USD],
dbo.AccountingView1.[Pub Pay Curr],
dbo.AccountingView1.[Cost USD] / dbo.Currency.to_usd_multiplier AS [Pub Payout],
dbo.AccountingView1.[Media Buyer],
dbo.AccountingView1.[Ad Manager],
dbo.AccountingView1.[Account Manager]
FROM dbo.AccountingView1
	 INNER JOIN dbo.Currency ON dbo.AccountingView1.currency_id = dbo.Currency.id
	 INNER JOIN dbo.Campaign ON dbo.AccountingView1.[Campaign Number] = dbo.Campaign.pid
	 INNER JOIN dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id
WHERE        dbo.AccountingView1.Revenue<>0 OR dbo.AccountingView1.Cost<>0
GO
PRINT N'Creating [dbo].[AverageMarginRpt]...';


GO
CREATE view [dbo].[AverageMarginRpt] as
select top(100) percent [Affiliate], avg([%Margin]) [Avg %Margin], avg([Margin USD]) [Avg Margin]
from (
	select top(100) percent
		  A.name2 [Affiliate]
		, I.total_revenue * CUR1.to_usd_multiplier [Revenue USD]
		, I.margin [Margin USD]
		, I.margin  / I.total_revenue * CUR1.to_usd_multiplier [%Margin]
		, AM.name [AM]
	from Item I
		inner join Affiliate A on I.affid=A.affid
		inner join Campaign CP on I.pid=CP.pid
		inner join AccountManager AM on CP.account_manager_id=AM.id
		inner join Currency CUR1 on I.revenue_currency_id=CUR1.id
	where I.total_revenue != 0
) A
group by [Affiliate]
order by [Avg %Margin]


--where I.id in (16153,16164,16172,16181,16195,16201,16203,16219,16228,16231)

--select 
--	  C.campaign_name [Campaign]
--	, A.add_code [CD#]
--	, sum(I.total_revenue * CUR1.to_usd_multiplier) [Revenue USD]
--	, sum(I.margin) [Margin USD]
--	, I.total_revenue * CUR1.to_usd_multiplier / I.margin [%Margin] 
--from Item I
--	inner join Affiliate A on I.affid=A.affid
--	inner join Campaign C on I.pid=C.pid
--	inner join Currency CUR1 on I.revenue_currency_id=CUR1.id
--	left outer join Stat S on I.stat_id_n=S.id
--	left outer join Payout P on S.cost_payout_id=P.id
--group by
--	  C.campaign_name
--	, A.add_code
--	, I.total_revenue * CUR1.to_usd_multiplier / I.margin
--	, I.margin
--having (I.margin != 0)
--order by [%Margin]
GO
PRINT N'Creating [dbo].[CampaignPublisherPaymentBatchesSummary]...';


GO
CREATE VIEW CampaignPublisherPaymentBatchesSummary AS
SELECT
		COALESCE(Publisher.name, Affiliate.name) AS PublisherName
		,NetTermType.name AS NetTermTypeName
		,AffiliatePaymentMethod.name AS PaymentMethodName
		,AffiliateCurrency.name AS AffiliateCurrencyName
		,SUM(Item.total_cost * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS SumItemTotalCost
		,ItemAccountingStatus.name AS ItemAccountingStatusName
		,PaymentBatch.id AS PaymentBatchId
		,dbo.SumKeys(Item.id) AS ItemIds
FROM
	Item
	INNER JOIN ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id
	INNER JOIN Currency ItemCurrency ON Item.cost_currency_id = ItemCurrency.id
	INNER JOIN Affiliate ON Item.affid = Affiliate.affid
	INNER JOIN NetTermType ON Affiliate.net_term_type_id = NetTermType.id
	INNER JOIN AffiliatePaymentMethod ON Affiliate.payment_method_id = AffiliatePaymentMethod.id
	INNER JOIN Currency AffiliateCurrency ON Affiliate.currency_id = AffiliateCurrency.id
	LEFT OUTER JOIN Publisher ON Affiliate.affid = Publisher.affid
	LEFT OUTER JOIN PaymentBatch ON Item.payment_batch_id = PaymentBatch.id
WHERE
	ItemAccountingStatus.name IN ('Approved', 'Check Signed and Paid', 'Hold')
GROUP BY
		COALESCE(Publisher.name, Affiliate.name)
	,NetTermType.name
	,AffiliatePaymentMethod.name
	,AffiliateCurrency.name
	,ItemAccountingStatus.name
	,PaymentBatch.id
GO
PRINT N'Creating [dbo].[CampaignsMargin]...';


GO
CREATE VIEW [dbo].[CampaignsMargin]
AS
SELECT     [Campaign Name], [Rev Currency], [Cost Currency], SUM(Revenue) AS TotalRevenue, SUM(Cost) AS TotalCost, AVG([%Margin]) AS AvgPercentMargin, 
                      dbo.SumKeys([%Margin]) AS Margins
FROM         dbo.AccountingView2
GROUP BY [Campaign Name], [Rev Currency], [Cost Currency]
GO
PRINT N'Creating [dbo].[CampaignsPublisherReportDetails]...';


GO
CREATE VIEW [dbo].[CampaignsPublisherReportDetails]
AS

SELECT *, B.[ToBePaid] + B.[Paid] AS Total
FROM
(
	SELECT
		 ItemIDs
		,CampaignStatusName AS CampaignStatus
		,PublisherName AS Publisher
		,AffiliateAddCode AS AddCode
		,CampaignName AS CampaignName
		,NumUnits AS NumUnits
		,CostPerUnit AS CostPerUnit
		,NetTermTypeName AS NetTerms
		,AffiliateCurrencyName AS PayCurrency
		,IsCPM AS [IsCPM]
		,MediaBuyer
		,COALESCE(COALESCE([default],0)	+ COALESCE([Verified], 0) + COALESCE([Approved], 0), 0) AS ToBePaid
		,COALESCE([Check Signed and Paid], 0) AS [Paid]
	FROM
	(
		SELECT
			  COALESCE(Publisher.name, Affiliate.name) AS PublisherName
			 ,NetTermType.name AS NetTermTypeName
			 ,AffiliateCurrency.name AS AffiliateCurrencyName
			 ,SUM(Item.total_cost * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS SumItemTotalCost
			 ,ItemAccountingStatus.name AS ItemAccountingStatusName
			 ,CampaignStatus.name AS CampaignStatusName
			 ,Campaign.campaign_name AS CampaignName
			 ,SUM(Item.num_units) AS NumUnits
			 ,Item.cost_per_unit * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier AS CostPerUnit
			 ,Affiliate.add_code AS AffiliateAddCode
			 ,CASE WHEN UnitType.name = 'CPM' THEN 'Yes' ELSE 'No' END AS IsCPM
			 ,MediaBuyer.name AS MediaBuyer
			 ,dbo.SumKeys(Item.id) AS ItemIDs
		FROM
			Item
			INNER JOIN UnitType ON Item.unit_type_id = UnitType.id
			INNER JOIN ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id
			INNER JOIN Currency ItemCurrency ON Item.cost_currency_id = ItemCurrency.id
			INNER JOIN Affiliate ON Item.affid = Affiliate.affid
			INNER JOIN MediaBuyer ON Affiliate.media_buyer_id = MediaBuyer.id
			INNER JOIN NetTermType ON Affiliate.net_term_type_id = NetTermType.id
			INNER JOIN Currency AffiliateCurrency ON Affiliate.currency_id = AffiliateCurrency.id
			INNER JOIN Campaign ON Item.pid = Campaign.pid
			INNER JOIN CampaignStatus ON Item.campaign_status_id = CampaignStatus.id
			LEFT OUTER JOIN Publisher ON Affiliate.affid = Publisher.affid
		GROUP BY
			 COALESCE(Publisher.name, Affiliate.name)
			,NetTermType.name
			,AffiliateCurrency.name
			,ItemAccountingStatus.name
			,CampaignStatus.name
			,Campaign.campaign_name
			,Affiliate.add_code
			,UnitType.name
			,MediaBuyer.name
			,Item.cost_per_unit * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier
	) AS A 
	PIVOT
	(
		SUM(SumItemTotalCost)
		FOR ItemAccountingStatusName in ([default], [Verified], [Approved], [Check Signed and Paid])
	) AS P
) AS B
GO
PRINT N'Creating [dbo].[CampaignsPublisherReportSummary]...';


GO
CREATE VIEW [dbo].[CampaignsPublisherReportSummary]
AS
SELECT 
	 *
	,B.[Unverified] + B.[Verified] + B.[Approved] AS [ToBePaid]
	,B.[Unverified] + B.[Verified] + B.[Approved] + B.[Paid] AS [Total]
FROM
(
	SELECT
		 CampaignStatusName AS [CampaignStatus]
		,PublisherName AS [Publisher]
		,NetTermTypeName AS [NetTerms]
		,AffiliateCurrencyName AS [PayCurrency]
		,COALESCE([default], 0) AS [Unverified]
		,COALESCE([Verified], 0) AS [Verified]
		,COALESCE([Approved], 0) AS [Approved]
		,COALESCE([Check Signed and Paid], 0) AS [Paid]
	FROM
	(
		SELECT
			  COALESCE(Publisher.name, Affiliate.name) AS PublisherName
			 ,NetTermType.name AS NetTermTypeName
			 ,AffiliateCurrency.name AS AffiliateCurrencyName
			 ,SUM(Item.total_cost * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS SumItemTotalCost
			 ,ItemAccountingStatus.name AS ItemAccountingStatusName
			 ,CampaignStatus.name AS CampaignStatusName
		FROM
			Item
			INNER JOIN ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id
			INNER JOIN Currency ItemCurrency ON Item.cost_currency_id = ItemCurrency.id
			INNER JOIN Affiliate ON Item.affid = Affiliate.affid
			INNER JOIN NetTermType ON Affiliate.net_term_type_id = NetTermType.id
			INNER JOIN Currency AffiliateCurrency ON Affiliate.currency_id = AffiliateCurrency.id
			INNER JOIN CampaignStatus ON Item.campaign_status_id = CampaignStatus.id
			LEFT OUTER JOIN Publisher ON Affiliate.affid = Publisher.affid
		GROUP BY
			 COALESCE(Publisher.name, Affiliate.name)
			,NetTermType.name
			,AffiliateCurrency.name
			,ItemAccountingStatus.name
			,CampaignStatus.name
	) AS A
	PIVOT
	(
		SUM(SumItemTotalCost)
		FOR ItemAccountingStatusName in ([default], [Verified], [Approved], [Check Signed and Paid], [Hold])
	) AS P
) AS B
GO
PRINT N'Creating [dbo].[CampaignWorkflow]...';


GO
CREATE VIEW [dbo].[CampaignWorkflow]
AS
SELECT     dbo.Campaign.id, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Campaign.modified, dbo.AccountManager.name AS AM, dbo.Advertiser.name AS Advertiser, 
                      dbo.Currency.name AS Curr, SUM(dbo.Item.total_revenue) AS Revenue, SUM(CASE Item.campaign_status_id WHEN 1 THEN Item.total_revenue ELSE 0 END) 
                      AS RevDefault, SUM(CASE Item.campaign_status_id WHEN 2 THEN Item.total_revenue ELSE 0 END) AS RevFinalized, 
                      SUM(CASE Item.campaign_status_id WHEN 4 THEN Item.total_revenue ELSE 0 END) AS RevVerified, dbo.CampaignStatus.name AS Status, 
                      dbo.LatestCampaignNote.note AS Note, CampaignStatus_1.name AS ItemCampaignStatus, COUNT(DISTINCT dbo.Item.affid) AS NumAffiliates, 
                      COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 1 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet7, 
                      COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 2 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet15, 
                      COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 3 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet30, 
                      COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 4 THEN Item.affid ELSE NULL END) AS NumAffiliatesNetBiWeekly, 
                      COUNT(DISTINCT CASE Item.campaign_status_id WHEN 1 THEN Item.affid ELSE NULL END) AS NumDefault, 
                      COUNT(DISTINCT CASE Item.campaign_status_id WHEN 2 THEN Item.affid ELSE NULL END) AS NumFinalized, 
                      COUNT(DISTINCT CASE Item.campaign_status_id WHEN 4 THEN Item.affid ELSE NULL END) AS NumVerified
FROM         dbo.Campaign INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.Item ON dbo.Campaign.pid = dbo.Item.pid INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.CampaignStatus AS CampaignStatus_1 ON dbo.Item.campaign_status_id = CampaignStatus_1.id LEFT OUTER JOIN
                      dbo.LatestCampaignNote ON dbo.Campaign.pid = dbo.LatestCampaignNote.campaign_id INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.AccountManagerAccessList ON dbo.AccountManager.name = dbo.AccountManagerAccessList.name
GROUP BY dbo.Campaign.id, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Campaign.modified, dbo.AccountManager.name, dbo.Advertiser.name, dbo.Currency.name,
                       dbo.CampaignStatus.name, dbo.LatestCampaignNote.note, CampaignStatus_1.name
GO
PRINT N'Creating [dbo].[CommissionView]...';


GO

CREATE VIEW [dbo].[CommissionView] AS
SELECT     dbo.AccountingView1.Publisher,
           CASE WHEN [Adv Alt Name] <> '' THEN [Adv Alt Name] ELSE dbo.AccountingView1.Advertiser END AS [Advertiser],
           dbo.AccountingView1.[Campaign Number], dbo.AccountingView1.[Campaign Name],
           dbo.AccountingView1.[Rev/Unit USD], dbo.AccountingView1.[Cost/Unit USD], dbo.AccountingView1.Units,
           dbo.AccountingView1.[Revenue USD], dbo.AccountingView1.[Cost USD],
           dbo.AccountingView1.[Revenue USD] - dbo.AccountingView1.[Cost USD] AS Margin,
           dbo.AccountingView1.[Media Buyer], '' AS [MB CommRate], '' AS [MB Commissions],
           dbo.AccountingView1.Analysts AS OldAnalysts,
           ISNULL(dbo.AccountingView1.Analyst,'') AS Analyst,
           AccountingView1.[AN CommRate],
           CASE WHEN [AN CommRate] IS NULL THEN 0 ELSE [AN CommRate] * Margin END AS [AN Commissions],
	       ISNULL(dbo.AccountingView1.[Analyst Manager],'') AS [Analyst Manager],
           dbo.AccountingView1.[ANMGR CommRate],
           CASE WHEN [ANMGR CommRate] IS NULL THEN 0 ELSE [ANMGR CommRate] * Margin END AS [ANMGR Commissions],
           ISNULL(dbo.AccountingView1.[Strategist],'') AS Strategist,
           dbo.AccountingView1.[STR CommRate], CASE WHEN [STR CommRate] IS NULL THEN 0 ELSE [STR CommRate] * Margin END AS [STR Commissions],
           dbo.AccountingView1.[Ad Manager], '' AS [AD CommRate], '' AS [AD Commissions],
           dbo.AccountingView1.[Account Manager], '' AS [AM CommRate], '' AS [AM Commissions],
           (CASE WHEN [Revenue USD] = 0 THEN 0 ELSE ([Revenue USD] - [Cost USD]) / [Revenue USD] END) * 100 AS [%Margin],
           dbo.AccountingView1.[Unit Type], dbo.AccountingView1.Status
FROM       dbo.AccountingView1
GO
PRINT N'Creating [dbo].[EarlyPublisherList]...';


GO
CREATE VIEW EarlyPublisherList AS
SELECT     TOP (100) PERCENT dbo.NetTermType.name, dbo.Affiliate.name2 AS Publisher, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid AS [Campaign Number], 
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.Item.cost_per_unit AS [Cost/Unit], dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) AS [Cost/UnitUSD], 
                      SUM(dbo.Item.num_units) AS Units, dbo.UnitType.name AS [Unit Type], SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.Item.total_cost) AS Cost, 
                      dbo.tousd3(dbo.Item.cost_currency_id, SUM(dbo.Item.total_cost)) AS CostUSD, SUM(dbo.Item.margin) AS Margin, dbo.MediaBuyer.name AS [Media Buyer], 
                      dbo.AdManager.name AS [Ad Manager], dbo.AccountManager.name AS [Account Manager], dbo.CampaignStatus.name AS Status, 
                      dbo.ItemAccountingStatus.name AS [Accounting Status], dbo.Source.name AS Source
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.NetTermType ON dbo.Affiliate.net_term_type_id = dbo.NetTermType.id INNER JOIN
                      dbo.Source ON dbo.Item.source_id = dbo.Source.id
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name, dbo.NetTermType.name, dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit), dbo.Item.cost_currency_id, 
                      dbo.Source.name
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[Eddy_Accounting_View_1]...';


GO
CREATE VIEW [dbo].[Eddy_Accounting_View_1]
AS
SELECT     TOP (100) PERCENT dbo.Affiliate.name2 AS Publisher, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid AS [Campaign Number], 
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit) AS [Rev/Unit USD], 
                      dbo.Item.cost_per_unit AS [Cost/Unit], dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) AS [Cost/Unit USD], SUM(dbo.Item.num_units) AS Units, 
                      dbo.UnitType.name AS [Unit Type], SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit) 
                      * dbo.Item.num_units) AS [Revenue USD], SUM(dbo.Item.total_cost) AS Cost, SUM(dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) 
                      * dbo.Item.num_units) AS [Cost USD], SUM(dbo.Item.margin) AS Margin, dbo.MediaBuyer.name AS [Media Buyer], dbo.AdManager.name AS [Ad Manager], 
                      dbo.AccountManager.name AS [Account Manager], dbo.CampaignStatus.name AS Status, dbo.ItemAccountingStatus.name AS [Accounting Status], 
                      dbo.NetTermType.name, dbo.AffiliatePaymentMethod.name AS [Aff Pay Method], dbo.Affiliate.currency_id, Currency_2.name AS Expr1, 
                      Currency_2.name AS [Pub Pay Curr]
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.NetTermType ON dbo.Affiliate.net_term_type_id = dbo.NetTermType.id INNER JOIN
                      dbo.AffiliatePaymentMethod ON dbo.Affiliate.payment_method_id = dbo.AffiliatePaymentMethod.id INNER JOIN
                      dbo.Currency AS Currency_2 ON dbo.Affiliate.currency_id = Currency_2.id
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name, dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit), dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit), 
                      dbo.NetTermType.name, dbo.AffiliatePaymentMethod.name, dbo.Affiliate.currency_id, Currency_2.name
HAVING      (dbo.CampaignStatus.name = 'Verified')
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[Eddy_Accounting_View_2]...';


GO
CREATE VIEW [dbo].[Eddy_Accounting_View_2]
AS
SELECT     dbo.Eddy_Accounting_View_1.Publisher, dbo.Eddy_Accounting_View_1.Advertiser, dbo.Eddy_Accounting_View_1.[Campaign Number], 
                      dbo.Eddy_Accounting_View_1.[Campaign Name], dbo.Eddy_Accounting_View_1.[Rev Currency], dbo.Eddy_Accounting_View_1.[Cost Currency], 
                      dbo.Eddy_Accounting_View_1.[Rev/Unit], dbo.Eddy_Accounting_View_1.[Rev/Unit USD], dbo.Eddy_Accounting_View_1.[Cost/Unit], 
                      dbo.Eddy_Accounting_View_1.[Cost/Unit USD], dbo.Eddy_Accounting_View_1.Units, dbo.Eddy_Accounting_View_1.[Unit Type], dbo.Eddy_Accounting_View_1.Revenue, 
                      dbo.Eddy_Accounting_View_1.[Revenue USD], dbo.Eddy_Accounting_View_1.Cost, dbo.Eddy_Accounting_View_1.[Cost USD], 
                      dbo.Eddy_Accounting_View_1.[Revenue USD] - dbo.Eddy_Accounting_View_1.[Cost USD] AS Margin, 
                      (CASE WHEN [Revenue USD] = 0 THEN 0 ELSE ([Revenue USD] - [Cost USD]) / [Revenue USD] END) * 100 AS [%Margin], dbo.Eddy_Accounting_View_1.[Media Buyer], 
                      dbo.Eddy_Accounting_View_1.[Ad Manager], dbo.Eddy_Accounting_View_1.[Account Manager], dbo.Eddy_Accounting_View_1.Status, 
                      dbo.Eddy_Accounting_View_1.[Accounting Status], dbo.Eddy_Accounting_View_1.name, dbo.Eddy_Accounting_View_1.[Aff Pay Method], 
                      dbo.Eddy_Accounting_View_1.[Pub Pay Curr], dbo.Eddy_Accounting_View_1.[Cost USD] / dbo.Currency.to_usd_multiplier AS [Pub Payout], 
                      dbo.GetCampaignNotes(dbo.Eddy_Accounting_View_1.[Campaign Number]) AS CampaignNotes
FROM         dbo.Eddy_Accounting_View_1 INNER JOIN
                      dbo.Currency ON dbo.Eddy_Accounting_View_1.currency_id = dbo.Currency.id
GO
PRINT N'Creating [dbo].[Item_To_USD_View_1]...';


GO
CREATE VIEW [dbo].[Item_To_USD_View_1]
AS
SELECT     dbo.Item.id, dbo.Item.total_revenue * Currency_1.to_usd_multiplier AS total_revenue_usd, 
                      dbo.Item.total_cost * dbo.Currency.to_usd_multiplier AS total_cost_usd
FROM         dbo.Item INNER JOIN
                      dbo.Currency ON dbo.Item.cost_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.revenue_currency_id = Currency_1.id
GO
PRINT N'Creating [dbo].[Jan11_AccountManager_View_1]...';


GO
CREATE VIEW [dbo].[Jan11_AccountManager_View_1]
AS
SELECT     TOP (100) PERCENT dbo.Affiliate.name2 AS Publisher, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid AS [Campaign Number], 
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.Item.cost_per_unit AS [Cost/Unit], SUM(dbo.Item.num_units) AS Units, dbo.UnitType.name AS [Unit Type], 
                      SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.Item.total_cost) AS Cost, SUM(dbo.Item.margin) AS Margin, dbo.MediaBuyer.name AS [Media Buyer], 
                      dbo.AdManager.name AS [Ad Manager], dbo.AccountManager.name AS [Account Manager], dbo.CampaignStatus.name AS Status, 
                      dbo.ItemAccountingStatus.name AS [Accounting Status]
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[MB_CPA_Ranked_Intl_View_1]...';


GO
CREATE VIEW [dbo].[MB_CPA_Ranked_Intl_View_1]
AS
SELECT     TOP (15) [Campaign Name], [Campaign Number], Revenue
FROM         dbo.Jan11_AccountManager_View_1
GROUP BY [Campaign Name], [Campaign Number], Revenue
HAVING      (NOT ([Campaign Name] LIKE 'US%'))
ORDER BY SUM(Revenue) DESC
GO
PRINT N'Creating [dbo].[MB_Ranked_CPM_1]...';


GO
CREATE VIEW [dbo].[MB_Ranked_CPM_1]
AS
SELECT     TOP (20) [Campaign Name], [Campaign Number]
FROM         dbo.Jan11_AccountManager_View_1
GROUP BY [Campaign Name], [Campaign Number]
HAVING      ([Campaign Name] LIKE '%CPM%')
ORDER BY SUM(Revenue) DESC
GO
PRINT N'Creating [dbo].[MB_Top_20_CPA_View_1]...';


GO
CREATE VIEW [dbo].[MB_Top_20_CPA_View_1]
AS
SELECT     TOP (20) [Campaign Name], [Campaign Number]
FROM         dbo.Jan11_AccountManager_View_1
GROUP BY [Campaign Name], [Campaign Number]
HAVING      ([Campaign Name] LIKE 'US%') AND ([Campaign Name] NOT LIKE '%CPM%')
ORDER BY SUM(Revenue) DESC
GO
PRINT N'Creating [dbo].[MB_View_Support_PID_SUM_Revenue]...';


GO
CREATE VIEW [dbo].[MB_View_Support_PID_SUM_Revenue]
AS
SELECT     dbo.Item.pid, SUM(dbo.Item.total_revenue * dbo.Currency.to_usd_multiplier) AS SumRevenueUSD, dbo.Campaign.campaign_name
FROM         dbo.Item INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id
GROUP BY dbo.Item.pid, dbo.Campaign.campaign_name
GO
PRINT N'Creating [dbo].[MediaBuyerConfirmation_MarkG]...';


GO
CREATE VIEW [dbo].[MediaBuyerConfirmation_MarkG] AS
SELECT
REPLACE(DB_NAME(),'DADatabase','') as Period,
a.name2 as Publisher,
m.name as [Media Buyer],
'' as [Correct Media Buyer]
FROM affiliate a JOIN mediabuyer m on m.id=a.media_buyer_id
WHERE m.id not in (9,33,50,22,27,10,1,15,44,11,45,3,38,52,41,55)
and a.affid in (select distinct affid from item)
GO
PRINT N'Creating [dbo].[MediaBuyerConfirmation_Megan]...';


GO
CREATE VIEW [dbo].[MediaBuyerConfirmation_Megan] AS
SELECT
REPLACE(DB_NAME(),'DADatabase','') as Period,
a.name2 as Publisher,
m.name as [Media Buyer],
'' as [Correct Media Buyer]
FROM affiliate a JOIN mediabuyer m on m.id=a.media_buyer_id
WHERE m.id in (9,33)
and a.affid in (select distinct affid from item)
GO
PRINT N'Creating [dbo].[Publisher Report Approval]...';


GO
CREATE VIEW [dbo].[Publisher Report Approval]
AS
SELECT     *, B.[ToBePaid] + B.[Paid] AS Total, ' ' AS [Media Buyer Comment]
FROM         (SELECT    CampaignStatusName AS CampaignStatus, PublisherName AS Publisher, AffiliateAddCode AS AddCode, CampaignName AS CampaignName, 
                                              NumUnits AS NumUnits, CostPerUnit AS CostPerUnit, NetTermTypeName AS NetTerms, AffiliateCurrencyName AS PayCurrency, IsCPM AS [IsCPM], 
                                              MediaBuyer, COALESCE (COALESCE ([default], 0) + COALESCE ([Verified], 0) + COALESCE ([Approved], 0), 0) AS ToBePaid, 
                                              COALESCE ([Check Signed and Paid], 0) AS [Paid]
                       FROM          (SELECT     COALESCE (Publisher.name, Affiliate.name) AS PublisherName, NetTermType.name AS NetTermTypeName, 
                                                                      AffiliateCurrency.name AS AffiliateCurrencyName, SUM(Item.total_cost * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) 
                                                                      AS SumItemTotalCost, ItemAccountingStatus.name AS ItemAccountingStatusName, CampaignStatus.name AS CampaignStatusName, 
                                                                      Campaign.campaign_name AS CampaignName, SUM(Item.num_units) AS NumUnits, 
                                                                      Item.cost_per_unit * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier AS CostPerUnit, Affiliate.add_code AS AffiliateAddCode, 
                                                                      CASE WHEN UnitType.name = 'CPM' THEN 'Yes' ELSE 'No' END AS IsCPM, MediaBuyer.name AS MediaBuyer, dbo.SumKeys(Item.id) 
                                                                      AS ItemIDs
                                               FROM          Item INNER JOIN
                                                                      UnitType ON Item.unit_type_id = UnitType.id INNER JOIN
                                                                      ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id INNER JOIN
                                                                      Currency ItemCurrency ON Item.cost_currency_id = ItemCurrency.id INNER JOIN
                                                                      Affiliate ON Item.affid = Affiliate.affid INNER JOIN
                                                                      MediaBuyer ON Affiliate.media_buyer_id = MediaBuyer.id INNER JOIN
                                                                      NetTermType ON Affiliate.net_term_type_id = NetTermType.id INNER JOIN
                                                                      Currency AffiliateCurrency ON Affiliate.currency_id = AffiliateCurrency.id INNER JOIN
                                                                      Campaign ON Item.pid = Campaign.pid INNER JOIN
                                                                      CampaignStatus ON Campaign.campaign_status_id = CampaignStatus.id LEFT OUTER JOIN
                                                                      Publisher ON Affiliate.affid = Publisher.affid
                                               GROUP BY COALESCE (Publisher.name, Affiliate.name), NetTermType.name, AffiliateCurrency.name, ItemAccountingStatus.name, CampaignStatus.name, 
                                                                      Campaign.campaign_name, Affiliate.add_code, UnitType.name, MediaBuyer.name, 
                                                                      Item.cost_per_unit * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS A PIVOT (SUM(SumItemTotalCost) FOR 
                                              ItemAccountingStatusName IN ([default], [Verified], [Approved], [Check Signed and Paid])) AS P) AS B
Where CampaignStatus='Verified'
and Publisher not in (select name from FakePublishers)
GO
PRINT N'Creating [dbo].[PublisherPayments]...';


GO
CREATE VIEW [dbo].[PublisherPayments]
AS
SELECT     dbo.Affiliate.net_term_type_id AS NetTermTypeId, dbo.NetTermType.name AS NetTermType, dbo.SumKeys(dbo.Item.affid) AS AffIds, dbo.Affiliate.name AS Publisher, 
                      AffCurrency.name AS PubPayCurr, SUM(dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) * dbo.Item.num_units / AffCurrency.to_usd_multiplier) 
                      AS PubPayout, dbo.Item.item_accounting_status_id AS AccountingStatusId, dbo.ItemAccountingStatus.name AS AccountingStatus, 
                      dbo.Affiliate.payment_method_id AS PaymentMethodId, dbo.AffiliatePaymentMethod.name AS PaymentMethod, dbo.Item.payment_batch_id AS PaymentBatchId, 
                      dbo.PaymentBatch.payment_batch_state_id AS PaymentBatchStateId, dbo.PaymentBatchState.name AS PaymentBatchState, 
                      dbo.PaymentBatch.approver_identity AS ApproverIdentity, dbo.SumKeys(dbo.Item.id) AS ItemIds
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Currency AS AffCurrency ON dbo.Affiliate.currency_id = AffCurrency.id INNER JOIN
                      dbo.Currency AS CostCurrency ON dbo.Item.cost_currency_id = CostCurrency.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.PaymentBatch ON dbo.Item.payment_batch_id = dbo.PaymentBatch.id INNER JOIN
                      dbo.PaymentBatchState ON dbo.PaymentBatch.payment_batch_state_id = dbo.PaymentBatchState.id INNER JOIN
                      dbo.AffiliatePaymentMethod ON dbo.Affiliate.payment_method_id = dbo.AffiliatePaymentMethod.id INNER JOIN
                      dbo.NetTermType ON dbo.Affiliate.net_term_type_id = dbo.NetTermType.id
GROUP BY dbo.Affiliate.name, dbo.Item.item_accounting_status_id, dbo.ItemAccountingStatus.name, dbo.Affiliate.payment_method_id, dbo.AffiliatePaymentMethod.name, 
                      dbo.Item.payment_batch_id, dbo.PaymentBatch.payment_batch_state_id, dbo.PaymentBatchState.name, dbo.PaymentBatch.approver_identity, AffCurrency.name, 
                      dbo.Affiliate.net_term_type_id, dbo.NetTermType.name
GO
PRINT N'Creating [dbo].[PublisherPayouts1]...';


GO
CREATE VIEW [dbo].[PublisherPayouts1]
AS
SELECT     TOP (100) PERCENT dbo.Affiliate.affid, dbo.Affiliate.name2 AS Publisher, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid, 
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit) AS [Rev/Unit USD], 
                      dbo.Item.cost_per_unit AS [Cost/Unit], dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) AS [Cost/Unit USD], SUM(dbo.Item.num_units) AS Units, 
                      dbo.UnitType.name AS [Unit Type], SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit) 
                      * dbo.Item.num_units) AS [Revenue USD], SUM(dbo.Item.total_cost) AS Cost, SUM(dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit) 
                      * dbo.Item.num_units) AS [Cost USD], SUM(dbo.Item.margin) AS Margin, dbo.MediaBuyer.name AS [Media Buyer], dbo.AdManager.name AS [Ad Manager], 
                      dbo.AccountManager.name AS [Account Manager], dbo.Item.campaign_status_id AS status_id, dbo.CampaignStatus.name AS Status, 
                      dbo.Item.item_accounting_status_id AS accounting_status_id, dbo.ItemAccountingStatus.name AS [Accounting Status], dbo.Item.media_buyer_approval_status_id, 
                      dbo.MediaBuyerApprovalStatus.name AS [Media Buyer Approval Status], dbo.NetTermType.name AS [Net Terms], 
                      dbo.AffiliatePaymentMethod.name AS [Aff Pay Method], dbo.Affiliate.currency_id, Currency_2.name AS Expr1, Currency_2.name AS [Pub Pay Curr], 
                      Source.name AS Source, dbo.SumKeys(dbo.Item.id) AS ItemIds, dbo.SumKeys(dbo.Item.batch_id) AS BatchIds
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Item.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.Source AS Source ON dbo.Item.source_id = Source.id INNER JOIN
                      dbo.MediaBuyerApprovalStatus ON dbo.Item.media_buyer_approval_status_id = dbo.MediaBuyerApprovalStatus.id LEFT OUTER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id LEFT OUTER JOIN
                      dbo.Currency AS Currency_2 ON dbo.Affiliate.currency_id = Currency_2.id LEFT OUTER JOIN
                      dbo.NetTermType ON dbo.Affiliate.net_term_type_id = dbo.NetTermType.id LEFT OUTER JOIN
                      dbo.AffiliatePaymentMethod ON dbo.Affiliate.payment_method_id = dbo.AffiliatePaymentMethod.id
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name, dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit), dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit), 
                      dbo.NetTermType.name, dbo.AffiliatePaymentMethod.name, dbo.Affiliate.currency_id, Currency_2.name, Source.name, dbo.Affiliate.affid, 
                      dbo.MediaBuyerApprovalStatus.name, dbo.Item.media_buyer_approval_status_id, dbo.Item.campaign_status_id, dbo.Item.item_accounting_status_id
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[PublisherRelatedItemCounts]...';


GO
CREATE VIEW [dbo].[PublisherRelatedItemCounts] AS
SELECT
       Affiliate.id Id
       ,Affiliate.name Publisher
       ,COUNT(distinct PubNotes.id) NumNotes
       ,COUNT(distinct PubAttachment.id) NumAttachments
FROM
       Item
       INNER JOIN ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id
       INNER JOIN Affiliate ON Item.affid = Affiliate.affid
       LEFT OUTER JOIN PubNotes on Affiliate.name = PubNotes.publisher_name
       LEFT OUTER JOIN PubAttachment on Affiliate.name = PubAttachment.publisher_name
GROUP BY
       Affiliate.id
       ,Affiliate.name
HAVING COUNT(distinct PubNotes.id) != 0 OR COUNT(distinct PubAttachment.id) != 0
GO
PRINT N'Creating [dbo].[PublisherReportDetails]...';


GO
CREATE VIEW [dbo].[PublisherReportDetails]
AS
SELECT
	  COALESCE(Publisher.name, Affiliate.name) AS PublisherName
	 ,NetTermType.name AS NetTermTypeName
	 ,AffiliateCurrency.name AS AffiliateCurrencyName
	 ,SUM(Item.total_cost * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS SumItemTotalCost
	 ,ItemAccountingStatus.name AS ItemAccountingStatusName
	 ,CampaignStatus.name AS CampaignStatusName
	 ,Campaign.campaign_name AS CampaignName
	 ,SUM(Item.num_units) AS NumUnits
	 ,SUM(Item.cost_per_unit * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS CostPerUnit
	 ,Affiliate.add_code AS AffiliateAddCode
	 ,CASE WHEN UnitType.name = 'CPM' THEN 'Yes' ELSE 'No' END AS IsCPM
	 ,MediaBuyer.name AS MediaBuyer
	 ,dbo.SumKeys(Item.id) AS ItemIDs
FROM
	Item
	INNER JOIN UnitType ON Item.unit_type_id = UnitType.id
	INNER JOIN ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id
	INNER JOIN Currency ItemCurrency ON Item.cost_currency_id = ItemCurrency.id
	INNER JOIN Affiliate ON Item.affid = Affiliate.affid
	INNER JOIN MediaBuyer ON Affiliate.media_buyer_id = MediaBuyer.id
	INNER JOIN NetTermType ON Affiliate.net_term_type_id = NetTermType.id
	INNER JOIN Currency AffiliateCurrency ON Affiliate.currency_id = AffiliateCurrency.id
	INNER JOIN Campaign ON Item.pid = Campaign.pid
	INNER JOIN CampaignStatus ON Campaign.campaign_status_id = CampaignStatus.id
	LEFT OUTER JOIN Publisher ON Affiliate.affid = Publisher.affid
GROUP BY
	 COALESCE(Publisher.name, Affiliate.name)
	,NetTermType.name
	,AffiliateCurrency.name
	,ItemAccountingStatus.name
	,CampaignStatus.name
	,Campaign.campaign_name
	,Affiliate.add_code
	,UnitType.name
	,MediaBuyer.name
GO
PRINT N'Creating [dbo].[PublisherReports]...';


GO
CREATE VIEW [dbo].[PublisherReports]
AS
SELECT *, B.[ToBePaid] + B.[Paid] AS Total
FROM
(
	SELECT
		 ItemIDs
		,CampaignStatusName AS CampaignStatus
		,PublisherName AS Publisher
		,AffiliateAddCode AS AddCode
		,CampaignName AS CampaignName
		,NumUnits AS NumUnits
		,CostPerUnit AS CostPerUnit
		,NetTermTypeName AS NetTerms
		,AffiliateCurrencyName AS PayCurrency
		,IsCPM AS [IsCPM]
		,MediaBuyer
		,COALESCE([default], 0) AS ToBePaid
		,COALESCE([Check Signed and Paid], 0) AS [Paid]
	FROM (
		SELECT * FROM PublisherReportDetails ) AS A 
	PIVOT ( 
		SUM(SumItemTotalCost)
		FOR ItemAccountingStatusName in ([default], [Check Signed and Paid])
	) AS P
) AS B
GO
PRINT N'Creating [dbo].[PublisherReportSummary]...';


GO
-- View

CREATE VIEW [dbo].[PublisherReportSummary]
AS
SELECT 
	 *
	,B.[To Be Paid] + B.Paid AS [Total]
FROM
(
	SELECT
		 PublisherName AS Name
		,NetTermTypeName AS [Net Terms]
		,AffiliateCurrencyName AS [Curr]
		,COALESCE([default], 0) AS [To Be Paid]
		,COALESCE([Check Signed and Paid], 0) AS [Paid]
	FROM
	(
		SELECT
			  COALESCE(Publisher.name, Affiliate.name) AS PublisherName
			 ,NetTermType.name AS NetTermTypeName
			 ,AffiliateCurrency.name AS AffiliateCurrencyName
			 ,SUM(Item.total_cost * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS SumItemTotalCost
			 ,ItemAccountingStatus.name AS ItemAccountingStatusName
		FROM
			Item
			INNER JOIN ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id
			INNER JOIN Currency ItemCurrency ON Item.cost_currency_id = ItemCurrency.id
			INNER JOIN Affiliate ON Item.affid = Affiliate.affid
			INNER JOIN NetTermType ON Affiliate.net_term_type_id = NetTermType.id
			INNER JOIN Currency AffiliateCurrency ON Affiliate.currency_id = AffiliateCurrency.id
			INNER JOIN Campaign ON Item.pid = Campaign.pid
			INNER JOIN CampaignStatus ON Campaign.campaign_status_id = CampaignStatus.id
			LEFT OUTER JOIN Publisher ON Affiliate.affid = Publisher.affid
		WHERE
			CampaignStatus.name = 'Verified'
		GROUP BY
			 COALESCE(Publisher.name, Affiliate.name)
			,NetTermType.name
			,AffiliateCurrency.name
			,ItemAccountingStatus.name
	) AS A
	PIVOT
	(
		SUM(SumItemTotalCost)
		FOR ItemAccountingStatusName in ([default], [Check Signed and Paid])
	) AS P
) AS B
GO
PRINT N'Creating [dbo].[Rehena_Jan11EomSheetIntl]...';


GO
CREATE VIEW [dbo].[Rehena_Jan11EomSheetIntl]
AS
SELECT     TOP (100) PERCENT dbo.Affiliate.name2 AS Publisher, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid AS [Campaign Number], 
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.Item.cost_per_unit AS [Cost/Unit], SUM(dbo.Item.num_units) AS Units, dbo.UnitType.name AS [Unit Type], 
                      SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.Item.total_cost) AS Cost, Currency_2.name AS [Pub Pay Curr], 
                      SUM(dbo.Item.total_cost * Currency_1.to_usd_multiplier / Currency_2.to_usd_multiplier) AS [Pub Cost], SUM(dbo.Item.margin) AS Margin, 
                      dbo.MediaBuyer.name AS [Media Buyer], dbo.AdManager.name AS [Ad Manager], dbo.AccountManager.name AS [Account Manager], 
                      dbo.CampaignStatus.name AS Status, dbo.ItemAccountingStatus.name AS [Accounting Status]
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.Currency AS Currency_2 ON dbo.Affiliate.currency_id = Currency_2.id
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name, Currency_2.name
HAVING      (dbo.CampaignStatus.name = 'Verified') AND (Currency_2.name = 'GBP' OR
                      Currency_2.name = 'EUR')
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[StandardView_Accounting_1]...';


GO
CREATE VIEW [dbo].[StandardView_Accounting_1]
AS
SELECT     TOP (100) PERCENT dbo.Affiliate.name2 AS PublisherName, dbo.Advertiser.name AS AdvertiserName, dbo.Campaign.pid, 
                      dbo.Campaign.campaign_name AS CampaignName, dbo.Currency.name AS RevenueCurrencyName, Currency_1.name AS CostCurrencyName, 
                      dbo.Item.revenue_per_unit AS RevenuePerUnit, dbo.Item.cost_per_unit AS CostPerUnit, SUM(dbo.Item.num_units) AS TotalUnits, dbo.UnitType.name AS UnitType, 
                      SUM(dbo.Item.total_revenue) AS TotalRevenue, SUM(dbo.Item.total_cost) AS TotalCost, SUM(dbo.Item.margin) AS TotalMargin, 
                      dbo.MediaBuyer.name AS MediaBuyerName, dbo.AdManager.name AS AdManagerName, dbo.AccountManager.name AS AccountManagerName, 
                      dbo.CampaignStatus.name AS CampaignStatusName, dbo.ItemAccountingStatus.name AS AccountingStatusName
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name
ORDER BY PublisherName
GO
PRINT N'Creating [dbo].[StandardView_CampaignRevenueTotal]...';


GO
CREATE VIEW [dbo].[StandardView_CampaignRevenueTotal]
AS
SELECT     dbo.Item.pid, dbo.Campaign.campaign_name, dbo.Item.revenue_currency_id, SUM(dbo.Item.total_revenue) AS TotalRevenueNative, 
                      SUM(dbo.Item.total_revenue * dbo.Currency.to_usd_multiplier) AS TotalRevenueUSD
FROM         dbo.Item INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id
GROUP BY dbo.Item.pid, dbo.Campaign.campaign_name, dbo.Item.revenue_currency_id
GO
PRINT N'Creating [dbo].[StandardView_CampaignRevenueTotal_CPA]...';


GO
CREATE VIEW [dbo].[StandardView_CampaignRevenueTotal_CPA]
AS
SELECT     pid, campaign_name, revenue_currency_id, TotalRevenueNative, TotalRevenueUSD
FROM         dbo.StandardView_CampaignRevenueTotal
WHERE     (campaign_name LIKE 'US%') AND (campaign_name NOT LIKE '%CPM%')
GO
PRINT N'Creating [dbo].[StandardView_CampaignRevenueTotal_CPM]...';


GO
CREATE VIEW [dbo].[StandardView_CampaignRevenueTotal_CPM]
AS
SELECT     pid, campaign_name, revenue_currency_id, TotalRevenueNative, TotalRevenueUSD
FROM         dbo.StandardView_CampaignRevenueTotal
WHERE     (campaign_name LIKE '%CPM%')
GO
PRINT N'Creating [dbo].[StandardView_CampaignRevenueTotal_Intl]...';


GO
CREATE VIEW [dbo].[StandardView_CampaignRevenueTotal_Intl]
AS
SELECT     pid, campaign_name, revenue_currency_id, TotalRevenueNative, TotalRevenueUSD
FROM         dbo.StandardView_CampaignRevenueTotal
WHERE     (NOT (campaign_name LIKE 'US%'))
GO
PRINT N'Creating [dbo].[Top45Advertisers]...';


GO
CREATE VIEW [dbo].[Top45Advertisers]
AS
SELECT     TOP (45) Advertiser, [Campaign Number], [Campaign Name], [Rev Currency], [Cost Currency], Revenue, [Revenue USD], Cost, [Cost USD]
FROM         dbo.AccountingView2
ORDER BY Revenue DESC
GO
PRINT N'Creating [dbo].[Top45Advertisers2]...';


GO
CREATE VIEW [dbo].[Top45Advertisers2]
AS
SELECT     TOP (45) Advertiser, [Rev Currency], SUM(Revenue) AS Rev, SUM([Revenue USD]) AS RevUSD
FROM         (SELECT     TOP (100) PERCENT Publisher, Advertiser, [Campaign Number], [Campaign Name], [Rev Currency], [Cost Currency], Revenue, [Revenue USD], Cost, 
                                              [Cost USD]
                       FROM          dbo.AccountingView2
                       ORDER BY Revenue DESC) AS A
GROUP BY Advertiser, [Rev Currency]
GO
PRINT N'Creating [dbo].[vAccounting]...';


GO
CREATE VIEW [dbo].[vAccounting] AS
WITH B AS
(
SELECT     
	  dbo.Affiliate.name2 AS Publisher
	, dbo.Advertiser.name AS Advertiser
	, dbo.Campaign.pid AS [Campaign Number]
	, dbo.Campaign.campaign_name AS [Campaign Name]
	, dbo.Currency.name AS [Rev Currency]
	, Currency_1.name AS [Cost Currency]
	, dbo.Item.revenue_per_unit AS [Rev/Unit]
	, dbo.tousd3(dbo.Item.revenue_currency_id
	, dbo.Item.revenue_per_unit) AS [Rev/Unit USD]
	, dbo.Item.cost_per_unit AS [Cost/Unit]
	, dbo.tousd3(dbo.Item.cost_currency_id
	, dbo.Item.cost_per_unit) AS [Cost/Unit USD]
	, SUM(dbo.Item.num_units) AS Units
	, dbo.UnitType.name AS [Unit Type]
	, SUM(dbo.Item.total_revenue) AS Revenue
	, SUM(dbo.tousd3(dbo.Item.revenue_currency_id
	, dbo.Item.revenue_per_unit) * dbo.Item.num_units) AS [Revenue USD]
	, SUM(dbo.Item.total_cost) AS Cost
	, SUM(dbo.tousd3(dbo.Item.cost_currency_id
	, dbo.Item.cost_per_unit) * dbo.Item.num_units) AS [Cost USD]
	, SUM(dbo.Item.margin) AS Margin
	, dbo.MediaBuyer.name AS [Media Buyer]
	, dbo.AdManager.name AS [Ad Manager]
	, dbo.AccountManager.name AS [Account Manager]
	, dbo.CampaignStatus.name AS [Status]
	, dbo.ItemAccountingStatus.name AS [Accounting Status]
	, dbo.NetTermType.name
	, dbo.AffiliatePaymentMethod.name AS [Aff Pay Method]
	, dbo.Affiliate.currency_id, Currency_2.name AS Expr1
	, Currency_2.name AS [Pub Pay Curr]
	, dbo.GetCampaignNotes(dbo.Campaign.pid) AS CampaignNotes
	, dbo.SumKeys(dbo.Item.id) AS ItemIDs
	, CASE WHEN item.[notes] LIKE '%from dt%' THEN '-' ELSE item.[notes] END AS ItemNotes
FROM
	dbo.Item 
	INNER JOIN dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid 
	INNER JOIN dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid 
	INNER JOIN dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id 
	INNER JOIN dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id
	INNER JOIN dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id 
	INNER JOIN dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id 
	INNER JOIN dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id 
	INNER JOIN dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id 
	INNER JOIN dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id 
	INNER JOIN dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id 
	INNER JOIN dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id 
	INNER JOIN dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id 
	INNER JOIN dbo.AffiliatePaymentMethod ON dbo.Affiliate.payment_method_id = dbo.AffiliatePaymentMethod.id 
	INNER JOIN dbo.Currency AS Currency_2 ON dbo.Affiliate.currency_id = Currency_2.id 
	LEFT OUTER JOIN dbo.NetTermType ON dbo.Affiliate.net_term_type_id = dbo.NetTermType.id
WHERE 
	dbo.CampaignStatus.name = 'Verified'
GROUP BY 
	  dbo.Affiliate.name2
	, dbo.Advertiser.name
	, dbo.Campaign.pid
	, dbo.Campaign.campaign_name
	, dbo.Currency.name
	, Currency_1.name
	, dbo.Item.revenue_per_unit
	, dbo.Item.cost_per_unit
	, dbo.MediaBuyer.name
	, dbo.AdManager.name
	, dbo.AccountManager.name
	, dbo.ItemAccountingStatus.name
	, dbo.UnitType.name
	, dbo.CampaignStatus.name
	, dbo.tousd3(dbo.Item.revenue_currency_id, dbo.Item.revenue_per_unit)
	, dbo.tousd3(dbo.Item.cost_currency_id, dbo.Item.cost_per_unit)
	, dbo.NetTermType.name
	, dbo.AffiliatePaymentMethod.name
	, dbo.Affiliate.currency_id
	, Currency_2.name
	, CASE WHEN [item].[notes] LIKE '%from dt%' THEN '-' ELSE [item].[notes] END
)
SELECT
	  B.[Publisher]
	, B.[Advertiser]
	, B.[Campaign Number]
	, B.[Campaign Name]
	, B.[Rev Currency]
	, B.[Cost Currency]
	, B.[Rev/Unit]
	, B.[Rev/Unit USD]
	, B.[Cost/Unit]
	, B.[Cost/Unit USD]
	, B.[Units]
	, B.[Unit Type]
	, B.[Revenue]
	, B.[Revenue USD]
	, B.[Cost]
	, B.[Cost USD]
	, B.[Revenue USD] - B.[Cost USD] AS [Margin]
	, (CASE WHEN [Revenue USD] = 0 THEN 0 ELSE ([Revenue USD] - [Cost USD]) / [Revenue USD] END) * 100 AS [%Margin]
	, B.[Media Buyer]
	, B.[Ad Manager]
	, B.[Account Manager]
	, B.[Status]
	, B.[Accounting Status]
	, B.[name]
	, B.[Aff Pay Method]
	, B.[Pub Pay Curr]
	, B.[Cost USD] / dbo.[Currency].[to_usd_multiplier] AS [Pub Payout]
	, dbo.[GetCampaignNotes](B.[Campaign Number]) AS [CampaignNotes]
	, B.[ItemNotes]
FROM
	B
	INNER JOIN dbo.Currency ON B.currency_id = dbo.Currency.id
GO
PRINT N'Creating [dbo].[VerifiedCampaignsPublisherReportSummary]...';


GO
CREATE VIEW [dbo].[VerifiedCampaignsPublisherReportSummary]
AS
SELECT 
	 *
	,B.[To Be Paid] + B.Paid AS [Total]
FROM
(
	SELECT
		 PublisherName AS Name
		,NetTermTypeName AS [Net Terms]
		,AffiliateCurrencyName AS [Curr]
		,COALESCE([default], 0) AS [To Be Paid]
		,COALESCE([Check Signed and Paid], 0) AS [Paid]
	FROM
	(
		SELECT
			  COALESCE(Publisher.name, Affiliate.name) AS PublisherName
			 ,NetTermType.name AS NetTermTypeName
			 ,AffiliateCurrency.name AS AffiliateCurrencyName
			 ,SUM(Item.total_cost * ItemCurrency.to_usd_multiplier / AffiliateCurrency.to_usd_multiplier) AS SumItemTotalCost
			 ,ItemAccountingStatus.name AS ItemAccountingStatusName
		FROM
			Item
			INNER JOIN ItemAccountingStatus ON Item.item_accounting_status_id = ItemAccountingStatus.id
			INNER JOIN Currency ItemCurrency ON Item.cost_currency_id = ItemCurrency.id
			INNER JOIN Affiliate ON Item.affid = Affiliate.affid
			INNER JOIN NetTermType ON Affiliate.net_term_type_id = NetTermType.id
			INNER JOIN Currency AffiliateCurrency ON Affiliate.currency_id = AffiliateCurrency.id
			INNER JOIN Campaign ON Item.pid = Campaign.pid
			INNER JOIN CampaignStatus ON Campaign.campaign_status_id = CampaignStatus.id
			LEFT OUTER JOIN Publisher ON Affiliate.affid = Publisher.affid
		WHERE
			CampaignStatus.name = 'Verified'
		GROUP BY
			 COALESCE(Publisher.name, Affiliate.name)
			,NetTermType.name
			,AffiliateCurrency.name
			,ItemAccountingStatus.name
	) AS A
	PIVOT
	(
		SUM(SumItemTotalCost)
		FOR ItemAccountingStatusName in ([default], [Check Signed and Paid])
	) AS P
) AS B
GO
PRINT N'Creating [dbo].[VerifiedItemsCampaignRevenueSummary]...';


GO
CREATE VIEW [dbo].[VerifiedItemsCampaignRevenueSummary]
AS
SELECT     dbo.Item.pid, dbo.Campaign.campaign_name AS CampaignName, SUM(dbo.Item.total_revenue) AS TotalRevenue, dbo.Currency.name AS CurrencyName, 
                      dbo.SumKeys(dbo.Item.id) AS ItemIds, dbo.Advertiser.name AS AdvertiserName
FROM         dbo.Campaign INNER JOIN
                      dbo.Item ON dbo.Campaign.pid = dbo.Item.pid INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Item.campaign_status_id = dbo.CampaignStatus.id INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id
GROUP BY dbo.Currency.name, dbo.Item.pid, dbo.Campaign.campaign_name, dbo.CampaignStatus.name, dbo.Advertiser.name
HAVING      (dbo.CampaignStatus.name = 'Verified')
GO
PRINT N'Creating [dbo].[vExtraItems]...';


GO
CREATE VIEW [dbo].[vExtraItems] AS
SELECT     TOP (100) PERCENT dbo.Affiliate.name2 AS Publisher, dbo.Advertiser.name AS Advertiser, dbo.Campaign.pid AS [Campaign Number], 
                      dbo.Campaign.campaign_name AS [Campaign Name], dbo.Currency.name AS [Rev Currency], Currency_1.name AS [Cost Currency], 
                      dbo.Item.revenue_per_unit AS [Rev/Unit], dbo.Item.cost_per_unit AS [Cost/Unit], SUM(dbo.Item.num_units) AS Units, dbo.UnitType.name AS [Unit Type], 
                      SUM(dbo.Item.total_revenue) AS Revenue, SUM(dbo.Item.total_cost) AS Cost, SUM(dbo.Item.margin) AS Margin, dbo.MediaBuyer.name AS [Media Buyer], 
                      dbo.AdManager.name AS [Ad Manager], dbo.AccountManager.name AS [Account Manager], dbo.CampaignStatus.name AS Status, 
                      dbo.ItemAccountingStatus.name AS [Accounting Status]
FROM         dbo.Item INNER JOIN
                      dbo.Affiliate ON dbo.Item.affid = dbo.Affiliate.affid INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id INNER JOIN
                      dbo.Currency ON dbo.Item.revenue_currency_id = dbo.Currency.id INNER JOIN
                      dbo.Currency AS Currency_1 ON dbo.Item.cost_currency_id = Currency_1.id INNER JOIN
                      dbo.MediaBuyer ON dbo.Affiliate.media_buyer_id = dbo.MediaBuyer.id INNER JOIN
                      dbo.AccountManager ON dbo.Campaign.account_manager_id = dbo.AccountManager.id INNER JOIN
                      dbo.AdManager ON dbo.Campaign.ad_manager_id = dbo.AdManager.id INNER JOIN
                      dbo.ItemReportingStatus ON dbo.Item.item_reporting_status_id = dbo.ItemReportingStatus.id INNER JOIN
                      dbo.ItemAccountingStatus ON dbo.Item.item_accounting_status_id = dbo.ItemAccountingStatus.id INNER JOIN
                      dbo.UnitType ON dbo.Item.unit_type_id = dbo.UnitType.id INNER JOIN
                      dbo.CampaignStatus ON dbo.Campaign.campaign_status_id = dbo.CampaignStatus.id
WHERE dbo.Item.stat_id_n is null
GROUP BY dbo.Affiliate.name2, dbo.Advertiser.name, dbo.Campaign.pid, dbo.Campaign.campaign_name, dbo.Currency.name, Currency_1.name, dbo.Item.revenue_per_unit, 
                      dbo.Item.cost_per_unit, dbo.MediaBuyer.name, dbo.AdManager.name, dbo.AccountManager.name, dbo.ItemAccountingStatus.name, dbo.UnitType.name, 
                      dbo.CampaignStatus.name
                      
                      
ORDER BY Publisher
GO
PRINT N'Creating [dbo].[vwSub2]...';


GO
CREATE VIEW [dbo].[vwSub2]
AS
SELECT     SUM(dbo.Item.total_revenue) AS rev, dbo.Advertiser.id AS advid
FROM         dbo.Item INNER JOIN
                      dbo.Campaign ON dbo.Item.pid = dbo.Campaign.pid INNER JOIN
                      dbo.Advertiser ON dbo.Campaign.advertiser_id = dbo.Advertiser.id
GROUP BY dbo.Advertiser.id
GO
PRINT N'Creating [dbo].[WorkflowView]...';


GO
CREATE VIEW [dbo].[WorkflowView] AS
SELECT TOP 100 PERCENT
	  Campaign.id
	, Campaign.pid
	, Campaign.campaign_name
	, Campaign.modified
	, AccountManager.name AS AM
	, Advertiser.name AS Advertiser
	, Currency.name AS Curr
	, SUM(Item.total_revenue) AS Revenue
	, SUM(CASE Item.campaign_status_id WHEN 1 THEN Item.total_revenue ELSE 0 END) AS RevDefault
	, SUM(CASE Item.campaign_status_id WHEN 2 THEN Item.total_revenue ELSE 0 END) AS RevFinalized
	, SUM(CASE Item.campaign_status_id WHEN 4 THEN Item.total_revenue ELSE 0 END) AS RevVerified, CampaignStatus.name AS Status
	, LatestCampaignNote.note AS Note, CampaignStatus_1.name AS ItemCampaignStatus
	, COUNT(DISTINCT Item.affid) AS NumAffiliates
	, COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 1 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet7
	, COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 2 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet15
	, COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 3 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet30
	, COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 4 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet7BiWeekly
	, COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 5 THEN Item.affid ELSE NULL END) AS NumAffiliatesNet15BiWeekly
	, COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 6 THEN Item.affid ELSE NULL END) AS NumAffiliatesWeekly
	, COUNT(DISTINCT CASE Affiliate.net_term_type_id WHEN 7 THEN Item.affid ELSE NULL END) AS NumAffiliatesBiWeekly
	, COUNT(DISTINCT CASE Item.campaign_status_id WHEN 1 THEN Item.affid ELSE NULL END) AS NumDefault
	, COUNT(DISTINCT CASE Item.campaign_status_id WHEN 2 THEN Item.affid ELSE NULL END) AS NumFinalized
	, COUNT(DISTINCT CASE Item.campaign_status_id WHEN 4 THEN Item.affid ELSE NULL END) AS NumVerified
	, MediaBuyerApprovalStatus.name MediaBuyerApprovalStatus
	, dbo.SumKeys(Item.id) ItemIds
FROM
	Campaign INNER JOIN
	AccountManager ON Campaign.account_manager_id = AccountManager.id INNER JOIN
	Advertiser ON Campaign.advertiser_id = Advertiser.id INNER JOIN
	CampaignStatus ON Campaign.campaign_status_id = CampaignStatus.id INNER JOIN
	Item ON Campaign.pid = Item.pid INNER JOIN
	Currency ON Item.revenue_currency_id = Currency.id INNER JOIN
	CampaignStatus AS CampaignStatus_1 ON Item.campaign_status_id = CampaignStatus_1.id LEFT OUTER JOIN
	LatestCampaignNote ON Campaign.pid = LatestCampaignNote.campaign_id INNER JOIN
	Affiliate ON Item.affid = Affiliate.affid INNER JOIN
	MediaBuyerApprovalStatus ON Item.media_buyer_approval_status_id = MediaBuyerApprovalStatus.id
GROUP BY 
	  Campaign.id
	, Campaign.pid
	, Campaign.campaign_name
	, Campaign.modified
	, AccountManager.name
	, Advertiser.name
	, Currency.name
	, CampaignStatus.name
	, LatestCampaignNote.note
	, CampaignStatus_1.name
	, MediaBuyerApprovalStatus.name
ORDER BY 
	Campaign.campaign_name
GO
PRINT N'Creating [dbo].[PublisherPayouts]...';


GO
CREATE VIEW [dbo].[PublisherPayouts]
AS
SELECT     dbo.PublisherPayouts1.affid, dbo.PublisherPayouts1.Publisher, dbo.PublisherPayouts1.Advertiser, dbo.PublisherPayouts1.pid, 
                      dbo.PublisherPayouts1.[Campaign Name], dbo.PublisherPayouts1.[Rev Currency], dbo.PublisherPayouts1.[Cost Currency], dbo.PublisherPayouts1.[Rev/Unit], 
                      dbo.PublisherPayouts1.[Rev/Unit USD], dbo.PublisherPayouts1.[Cost/Unit], dbo.PublisherPayouts1.[Cost/Unit USD], dbo.PublisherPayouts1.Units, 
                      dbo.PublisherPayouts1.[Unit Type], dbo.PublisherPayouts1.Revenue, dbo.PublisherPayouts1.[Revenue USD], dbo.PublisherPayouts1.Cost, 
                      dbo.PublisherPayouts1.[Cost USD], dbo.PublisherPayouts1.[Revenue USD] - dbo.PublisherPayouts1.[Cost USD] AS Margin, 
                      (CASE WHEN [Revenue USD] = 0 THEN 0 ELSE ([Revenue USD] - [Cost USD]) / [Revenue USD] END) * 100 AS MarginPct, dbo.PublisherPayouts1.[Media Buyer], 
                      dbo.PublisherPayouts1.[Ad Manager], dbo.PublisherPayouts1.[Account Manager], dbo.PublisherPayouts1.status_id, dbo.PublisherPayouts1.Status, 
                      dbo.PublisherPayouts1.accounting_status_id, dbo.PublisherPayouts1.[Accounting Status], dbo.PublisherPayouts1.media_buyer_approval_status_id, 
                      dbo.PublisherPayouts1.[Media Buyer Approval Status], dbo.PublisherPayouts1.[Net Terms], dbo.PublisherPayouts1.[Aff Pay Method], 
                      dbo.PublisherPayouts1.[Pub Pay Curr], dbo.PublisherPayouts1.[Cost USD] / dbo.Currency.to_usd_multiplier AS [Pub Payout], 
                      dbo.GetCampaignNotes(dbo.PublisherPayouts1.pid) AS CampaignNotes, dbo.PublisherPayouts1.Source, dbo.PublisherPayouts1.ItemIds, dbo.PublisherPayouts1.BatchIds
FROM         dbo.PublisherPayouts1 INNER JOIN
                      dbo.Currency ON dbo.PublisherPayouts1.currency_id = dbo.Currency.id
GO
PRINT N'Creating [dbo].[CampaignsPublisherReportSummarySummaryByNetTerms]...';


GO
--SELECT Status, USD, EUR, GBP, AUD FROM dbo.CampaignsPublisherReportSummarySummaryByNetTerms('Net 7')
CREATE FUNCTION [dbo].[CampaignsPublisherReportSummarySummaryByNetTerms]
(	
	@p_net_terms varchar(50)
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT [Status], SUM(USD) USD, SUM(EUR) EUR, SUM(GBP) GBP, SUM(AUD) AUD FROM (
		SELECT NetTerms, PayCurrency, [Status], Amount, CampaignStatus
		FROM CampaignsPublisherReportSummary
		UNPIVOT (Amount FOR [Status] IN (Total, ToBePaid, Paid, Approved, Verified, Unverified)) U
		WHERE NetTerms LIKE @p_net_terms
		--WHERE NetTerms LIKE 'Net 7'
		AND CampaignStatus='Verified'
	) A
	PIVOT (SUM(Amount) FOR PayCurrency IN (USD, EUR, GBP, AUD)) P
	GROUP BY [Status]
)
GO
PRINT N'Creating [dbo].[CampaignsPublisherReportSummarySummaryByNetTermsAllRevenue]...';


GO
CREATE FUNCTION [dbo].[CampaignsPublisherReportSummarySummaryByNetTermsAllRevenue]
(	
	@p_net_terms varchar(50)
)
RETURNS TABLE 
AS
RETURN 
(
	SELECT [Status], SUM(USD) USD, SUM(EUR) EUR, SUM(GBP) GBP, SUM(AUD) AUD FROM (
		SELECT NetTerms, PayCurrency, [Status], Amount, CampaignStatus
		FROM CampaignsPublisherReportSummary
		UNPIVOT (Amount FOR [Status] IN (Total, ToBePaid, Paid, Approved, Verified, Unverified)) U
		WHERE NetTerms LIKE @p_net_terms
		--WHERE NetTerms LIKE 'Net 7'
		--AND CampaignStatus='Verified'
	) A
	PIVOT (SUM(Amount) FOR PayCurrency IN (USD, EUR, GBP, AUD)) P
	GROUP BY [Status]
)
GO
PRINT N'Creating [dbo].[GetCampaignsPublisherReportSummaryByNetTerms]...';


GO
CREATE FUNCTION [dbo].[GetCampaignsPublisherReportSummaryByNetTerms](@p_net_terms varchar(50))
RETURNS TABLE AS
RETURN (
	SELECT 'Total' [Status], * 
	FROM(
		SELECT Total,PayCurrency 
		FROM CampaignsPublisherReportSummary 
		WHERE NetTerms LIKE @p_net_terms)A
	PIVOT(SUM(Total) FOR PayCurrency in (USD,EUR,GBP,AUD))P
	UNION
	SELECT 'ToBePaid' [Status], * 
	FROM(
		SELECT ToBePaid,PayCurrency 
		FROM CampaignsPublisherReportSummary 
		WHERE NetTerms LIKE @p_net_terms)A
	PIVOT(SUM(ToBePaid) FOR PayCurrency in (USD,EUR,GBP,AUD))P
	UNION
	SELECT 'Approved' [Status], * 
	FROM(
		SELECT Approved,PayCurrency 
		FROM CampaignsPublisherReportSummary 
		WHERE NetTerms LIKE @p_net_terms)A
	PIVOT(SUM(Approved) FOR PayCurrency in (USD,EUR,GBP,AUD))P
	UNION
	SELECT 'Verified' [Status], * 
	FROM(
		SELECT Verified,PayCurrency 
		FROM CampaignsPublisherReportSummary 
		WHERE NetTerms LIKE @p_net_terms)A
	PIVOT(SUM(Verified) FOR PayCurrency in (USD,EUR,GBP,AUD))P
	UNION
	SELECT 'Unverified' [Status], * 
	FROM(
		SELECT Unverified,PayCurrency 
		FROM CampaignsPublisherReportSummary 
		WHERE NetTerms LIKE @p_net_terms)A
	PIVOT(SUM(Unverified) FOR PayCurrency in (USD,EUR,GBP,AUD))P
)
GO
PRINT N'Creating [dbo].[CascaseDeleteAllItemsByPID]...';


GO
-- =============================================
-- Author:		Aaron Anodide
-- Create date: 1/9/2012
-- Description:	Cascase delete all items with a PID
-- =============================================
CREATE PROCEDURE [dbo].[CascaseDeleteAllItemsByPID] 
	@pid int
AS
BEGIN
	SET NOCOUNT ON;
	BEGIN TRANSACTION

		DELETE FROM Item
		WHERE pid=@pid
		
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RAISERROR ('Error in deleting Items in CascaseDeleteAllItemsWithPID.', 16, 1)
				RETURN
			END
			
		DELETE FROM Stat
		WHERE pid=@pid
		
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RAISERROR ('Error in deleting Stats in CascaseDeleteAllItemsWithPID.', 16, 1)
				RETURN
			END

		DELETE FROM Payout
		WHERE pid=@pid
		
		IF @@ERROR <> 0
			BEGIN
				ROLLBACK
				RAISERROR ('Error in deleting Payouts in CascaseDeleteAllItemsWithPID.', 16, 1)
				RETURN
			END

		COMMIT

	END
GO
PRINT N'Creating [dbo].[InsertPaymentBatchAttachment]...';


GO
CREATE PROCEDURE dbo.InsertPaymentBatchAttachment
	@name nvarchar(255),
	@binary_content varbinary(max),
	@payment_batch_id int,
	@Identity int OUT
AS
BEGIN
	SET NOCOUNT ON;
	INSERT INTO [dbo].[PaymentBatchAttachment] ([name],[binary_content],[payment_batch_id])
    VALUES (@name,@binary_content,@payment_batch_id)
	SET @Identity = SCOPE_IDENTITY()
END
GO
PRINT N'Creating [dbo].[PROC_SELECT_Eddy_Accounting_View_2]...';


GO
---------------------------------------------------------------
-- SELECT ALL ROWS from Eddy_Accounting_View_2
--		Campaign id
--		Affiliate name2
---------------------------------------------------------------
CREATE PROCEDURE [dbo].[PROC_SELECT_Eddy_Accounting_View_2]
AS
BEGIN
	SELECT * FROM Eddy_Accounting_View_2
END
GO
PRINT N'Creating [dbo].[SelectNumUnitsByPidCdCostRev]...';


GO
---------------------------------------------------------------
-- GET Item num units
-- TODO: make the name right (CostRef ==> RevCost)
---------------------------------------------------------------
CREATE PROCEDURE [dbo].[SelectNumUnitsByPidCdCostRev]
	@Pid int,
	@Cd varchar(500),
	@Rev money,
	@Cost money
AS
BEGIN
	SELECT IT.id, IT.pid, AF.name2, IT.revenue_per_unit, IT.cost_per_unit, IT.num_units
	FROM Item IT
	INNER JOIN Affiliate AF ON IT.affid = AF.affid
	WHERE AF.name2 = @Cd
	AND IT.pid = @Pid
	AND IT.revenue_per_unit = @Rev
	AND IT.cost_per_unit = @Cost
END
GO
PRINT N'Creating [dbo].[UpdateLastCampaignSynch]...';


GO
CREATE PROCEDURE [dbo].[UpdateLastCampaignSynch]
	@CampaignNumber int
AS
BEGIN
	SET NOCOUNT ON;
	--UPDATE CampaignSynch
	--SET LastSynched=GETDATE()
	--WHERE CampaignId=(
	--	SELECT id
	--	FROM Campaign
	--	WHERE pid=@CampaignNumber
	--)
END
GO
PRINT N'Creating [dbo].[Affiliate_net_term_type_id_DF]...';


GO
CREATE DEFAULT [dbo].[Affiliate_net_term_type_id_DF]
    AS (3);


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Affiliate_net_term_type_id_DF]', @objname = N'[dbo].[Affiliate].[net_term_type_id]';


GO
PRINT N'Creating [dbo].[Affiliate_payment_method_id_DF]...';


GO
CREATE DEFAULT [dbo].[Affiliate_payment_method_id_DF]
    AS (1);


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Affiliate_payment_method_id_DF]', @objname = N'[dbo].[Affiliate].[payment_method_id]';


GO
PRINT N'Creating [dbo].[Campaign_account_manager_id_DF]...';


GO
CREATE DEFAULT [dbo].[Campaign_account_manager_id_DF]
    AS (1);


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Campaign_account_manager_id_DF]', @objname = N'[dbo].[Campaign].[account_manager_id]';


GO
PRINT N'Creating [dbo].[Campaign_ad_manager_id_DF]...';


GO
CREATE DEFAULT [dbo].[Campaign_ad_manager_id_DF]
    AS (1);


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Campaign_ad_manager_id_DF]', @objname = N'[dbo].[Campaign].[ad_manager_id]';


GO
PRINT N'Creating [dbo].[Campaign_advertiser_id_DF]...';


GO
CREATE DEFAULT [dbo].[Campaign_advertiser_id_DF]
    AS (1);


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Campaign_advertiser_id_DF]', @objname = N'[dbo].[Campaign].[advertiser_id]';


GO
PRINT N'Creating [dbo].[Campaign_campaign_status_id_DF]...';


GO
CREATE DEFAULT [dbo].[Campaign_campaign_status_id_DF]
    AS (3);


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Campaign_campaign_status_id_DF]', @objname = N'[dbo].[Campaign].[campaign_status_id]';


GO
PRINT N'Creating [dbo].[CampaignNotes_added_by_system_user_DF]...';


GO
CREATE DEFAULT [dbo].[CampaignNotes_added_by_system_user_DF]
    AS suser_sname();


GO
EXECUTE sp_bindefault @defname = N'[dbo].[CampaignNotes_added_by_system_user_DF]', @objname = N'[dbo].[CampaignNotes].[added_by_system_user]';


GO
PRINT N'Creating [dbo].[Item_accounting_notes_DF]...';


GO
CREATE DEFAULT [dbo].[Item_accounting_notes_DF]
    AS N'none';


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Item_accounting_notes_DF]', @objname = N'[dbo].[Item].[accounting_notes]';


GO
PRINT N'Creating [dbo].[Item_item_accounting_status_id_DF]...';


GO
CREATE DEFAULT [dbo].[Item_item_accounting_status_id_DF]
    AS (1);


GO
EXECUTE sp_bindefault @defname = N'[dbo].[Item_item_accounting_status_id_DF]', @objname = N'[dbo].[Item].[item_accounting_status_id]';


GO
PRINT N'Creating [dbo].[PubReportInstance_email_status_msg_DF]...';


GO
CREATE DEFAULT [dbo].[PubReportInstance_email_status_msg_DF]
    AS 'unsent';


GO
EXECUTE sp_bindefault @defname = N'[dbo].[PubReportInstance_email_status_msg_DF]', @objname = N'[dbo].[PubReportInstance].[email_status_msg]';


GO
PRINT N'Creating [dbo].[PubReportInstance_saved_DF]...';


GO
CREATE DEFAULT [dbo].[PubReportInstance_saved_DF]
    AS getdate();


GO
EXECUTE sp_bindefault @defname = N'[dbo].[PubReportInstance_saved_DF]', @objname = N'[dbo].[PubReportInstance].[saved]';


GO
PRINT N'Creating [dbo].[Stat_clicks_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_clicks_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_leads_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_leads_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_num_post_impression_sales_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_num_post_impression_sales_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_num_post_impression_sub_sales_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_num_post_impression_sub_sales_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_num_sales_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_num_sales_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_num_sub_sales_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_num_sub_sales_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_post_impression_sale_amount_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_post_impression_sale_amount_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_post_impression_sub_sale_amount_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_post_impression_sub_sale_amount_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_sale_amount_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_sale_amount_DF]
    AS (0);


GO
PRINT N'Creating [dbo].[Stat_sub_sale_amount_DF]...';


GO
CREATE DEFAULT [dbo].[Stat_sub_sale_amount_DF]
    AS (0);


GO
PRINT N'Creating [SqlServerProject1].[SqlAssemblyProjectRoot]...';


GO
EXECUTE sp_addextendedproperty @name = N'SqlAssemblyProjectRoot', @value = N'C:\zzzNovEOM\vs2\EomApps\SqlServerProject1', @level0type = N'Assembly', @level0name = N'SqlServerProject1';


GO
PRINT N'Creating [dbo].[GetCampaignNotes].[SqlAssemblyFile]...';


GO
EXECUTE sp_addextendedproperty @name = N'SqlAssemblyFile', @value = N'GetCampaignNotes.cs', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'FUNCTION', @level1name = N'GetCampaignNotes';


GO
PRINT N'Creating [dbo].[GetCampaignNotes].[SqlAssemblyFileLine]...';


GO
EXECUTE sp_addextendedproperty @name = N'SqlAssemblyFileLine', @value = N'14', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'FUNCTION', @level1name = N'GetCampaignNotes';


GO
PRINT N'Creating [dbo].[AccountingView1].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1[50] 2[25] 3) )"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1[56] 3) )"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1[47] 4) )"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 9
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Item"
            Begin Extent = 
               Top = 47
               Left = 920
               Bottom = 417
               Right = 1153
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Affiliate"
            Begin Extent = 
               Top = 465
               Left = 1014
               Bottom = 763
               Right = 1217
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Campaign"
            Begin Extent = 
               Top = 246
               Left = 38
               Bottom = 365
               Right = 275
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Advertiser"
            Begin Extent = 
               Top = 126
               Left = 279
               Bottom = 215
               Right = 455
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Currency"
            Begin Extent = 
               Top = 216
               Left = 279
               Bottom = 320
               Right = 465
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Currency_1"
            Begin Extent = 
               Top = 366
               Left = 38
               Bottom = 470
               Right = 224
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "AccountManager"
            Begin Extent = 
               Top = 456
               Left = 262
               Bottom = 545
               Right = 438
            End
           ', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'AccountingView1';


GO
PRINT N'Creating [dbo].[AccountingView1].[MS_DiagramPane2]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane2', @value = N' DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "AdManager"
            Begin Extent = 
               Top = 474
               Left = 38
               Bottom = 563
               Right = 214
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "ItemReportingStatus"
            Begin Extent = 
               Top = 546
               Left = 252
               Bottom = 635
               Right = 428
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "ItemAccountingStatus"
            Begin Extent = 
               Top = 564
               Left = 38
               Bottom = 653
               Right = 214
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "UnitType"
            Begin Extent = 
               Top = 636
               Left = 252
               Bottom = 725
               Right = 428
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "CampaignStatus"
            Begin Extent = 
               Top = 654
               Left = 38
               Bottom = 743
               Right = 214
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Source"
            Begin Extent = 
               Top = 282
               Left = 571
               Bottom = 371
               Right = 747
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "MediaBuyer"
            Begin Extent = 
               Top = 432
               Left = 730
               Bottom = 521
               Right = 906
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Currency_2"
            Begin Extent = 
               Top = 521
               Left = 619
               Bottom = 625
               Right = 805
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "NetTermType"
            Begin Extent = 
               Top = 645
               Left = 622
               Bottom = 734
               Right = 798
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "AffiliatePaymentMethod"
            Begin Extent = 
               Top = 745
               Left = 800
               Bottom = 834
               Right = 976
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "MediaBuyerApprovalStatus"
            Begin Extent = 
               Top = 46
               Left = 517
               Bottom = 135
               Right = 693
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
      PaneHidden = 
   End
   Begin DataPane = 
      PaneHidden = 
      Begin ParameterDefaults = ""
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 12
         Column = 1440
         Alias = 2340
         Table = 2175
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'AccountingView1';


GO
PRINT N'Creating [dbo].[AccountingView1].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 2, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'AccountingView1';


GO
PRINT N'Creating [dbo].[CampaignsMargin].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[19] 4[42] 2[10] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "AccountingView2"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 514
               Right = 214
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 12
         Column = 2520
         Alias = 3810
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'CampaignsMargin';


GO
PRINT N'Creating [dbo].[CampaignsMargin].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 1, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'CampaignsMargin';


GO
PRINT N'Creating [dbo].[Top45Advertisers].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[6] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "AccountingView2"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 125
               Right = 214
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'Top45Advertisers';


GO
PRINT N'Creating [dbo].[Top45Advertisers].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 1, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'Top45Advertisers';


GO
PRINT N'Creating [dbo].[Top45Advertisers2].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "A"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 125
               Right = 230
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 12
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'Top45Advertisers2';


GO
PRINT N'Creating [dbo].[Top45Advertisers2].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 1, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'Top45Advertisers2';


GO
PRINT N'Creating [dbo].[vCampaigns].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[41] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "Campaign"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 360
               Right = 259
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "CampaignStatus"
            Begin Extent = 
               Top = 0
               Left = 546
               Bottom = 89
               Right = 706
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "AccountManager"
            Begin Extent = 
               Top = 0
               Left = 369
               Bottom = 89
               Right = 529
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "AdManager"
            Begin Extent = 
               Top = 102
               Left = 369
               Bottom = 191
               Right = 529
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Advertiser"
            Begin Extent = 
               Top = 101
               Left = 544
               Bottom = 190
               Right = 704
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 1500
         Width = 4575
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 4455
         Alia', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'vCampaigns';


GO
PRINT N'Creating [dbo].[vCampaigns].[MS_DiagramPane2]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane2', @value = N's = 5025
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'vCampaigns';


GO
PRINT N'Creating [dbo].[vCampaigns].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 2, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'vCampaigns';


GO
PRINT N'Creating [dbo].[vPublisherReportEmails].[MS_DiagramPane1]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPane1', @value = N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[5] 4[44] 2[21] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = 0
         Left = 0
      End
      Begin Tables = 
         Begin Table = "PubReportEmail"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 180
               Right = 241
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "PubReportInstance"
            Begin Extent = 
               Top = 6
               Left = 279
               Bottom = 191
               Right = 482
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "Vendor"
            Begin Extent = 
               Top = 6
               Left = 520
               Bottom = 95
               Right = 680
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 5490
         Width = 2535
         Width = 1500
         Width = 2145
         Width = 2805
         Width = 2235
         Width = 9555
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End', @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'vPublisherReportEmails';


GO
PRINT N'Creating [dbo].[vPublisherReportEmails].[MS_DiagramPaneCount]...';


GO
EXECUTE sp_addextendedproperty @name = N'MS_DiagramPaneCount', @value = 1, @level0type = N'SCHEMA', @level0name = N'dbo', @level1type = N'VIEW', @level1name = N'vPublisherReportEmails';


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = 'd795b6d6-e3ad-4aee-a748-5c4637b4040a')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('d795b6d6-e3ad-4aee-a748-5c4637b4040a')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '0e04352b-ed9b-4645-8248-bf902eee59a2')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('0e04352b-ed9b-4645-8248-bf902eee59a2')

GO

GO
/*
Post-Deployment Script Template							
--------------------------------------------------------------------------------------
 This file contains SQL statements that will be appended to the build script.		
 Use SQLCMD syntax to include a file in the post-deployment script.			
 Example:      :r .\myfile.sql								
 Use SQLCMD syntax to reference a variable in the post-deployment script.		
 Example:      :setvar TableName MyTable							
               SELECT * FROM [$(TableName)]					
--------------------------------------------------------------------------------------
*/

----insert AdManager rows
--SET IDENTITY_INSERT [$(DatabaseName)].[dbo].[AdManager] ON
--INSERT 
--	[$(DatabaseName)].[dbo].[AdManager] (
--		[id], 
--		[name]
--	) 
--SELECT 
--	*
--FROM 
--	DADatabaseFeb2012.dbo.[AdManager]
--SET IDENTITY_INSERT [$(DatabaseName)].[dbo].[AdManager] OFF
----insert AccountManager rows
--SET IDENTITY_INSERT [$(DatabaseName)].[dbo].[AccountManager] ON
--INSERT 
--	[$(DatabaseName)].[dbo].[AccountManager] (
--		[id], 
--		[name]
--	) 
--SELECT 
--	*
--FROM 
--	DADatabaseFeb2012.dbo.[AccountManager]
--SET IDENTITY_INSERT [$(DatabaseName)].[dbo].[AccountManager] OFF

INSERT INTO [dbo].[InvoiceStatus] VALUES
	 (0, 'default')
	,(1, 'am_review')
	,(2, 'acct_review')
	,(3, 'generated')
GO

INSERT INTO [dbo].[MediaBuyerApprovalStatus] VALUES 
	 ('1', 'default')
	,('2', 'Queued')
	,('3', 'Sent')
	,('4', 'Approved')
	,('5', 'Held')
GO

insert [TrackingSystem] values 
  (1, 'Direct Track'),
  (2, 'Cake Marketing')
GO

INSERT INTO [dbo].[PaymentBatchState] VALUES 
	 ('1', 'default')
	,('3', 'Sent')
	,('6', 'Complete')
GO

DENY VIEW DEFINITION ON SCHEMA::[dbo] TO [accountManagersOnly]
GO
GRANT EXECUTE ON [dbo].[ListAnalysts] TO [accountManagersOnly]
GO
GRANT EXECUTE ON [dbo].[tousd3] TO [accountManagersOnly]
GO
GRANT CONNECT TO [accountManagersOnly] /* not needed? */
GO
ALTER USER [accountManagersOnly] WITH DEFAULT_SCHEMA=[dbo] /* not needed? */
GO

GRANT SELECT ON [dbo].[MediaBuyerConfirmation_Megan] TO [DIRECTAGENTS\MConahan]
GO
GRANT SELECT ON [dbo].[MediaBuyerConfirmation_MarkG] TO [DIRECTAGENTS\MGlauberson]
GO

/*
ALTER TABLE dbo.Item ADD
	payment_batch_id int NULL
GO
ALTER TABLE dbo.Item ADD CONSTRAINT
	FK_Item_PaymentBatch FOREIGN KEY
	(
	payment_batch_id
	) REFERENCES dbo.PaymentBatch
	(
	id
	) ON UPDATE  NO ACTION 
	 ON DELETE  NO ACTION 
GO

//TODO: Add first and second batch approvers to DAMain1 Settings table
//      + thresholds
*/
GO

GO
DECLARE @VarDecimalSupported AS BIT;

SELECT @VarDecimalSupported = 0;

IF ((ServerProperty(N'EngineEdition') = 3)
    AND (((@@microsoftversion / power(2, 24) = 9)
          AND (@@microsoftversion & 0xffff >= 3024))
         OR ((@@microsoftversion / power(2, 24) = 10)
             AND (@@microsoftversion & 0xffff >= 1600))))
    SELECT @VarDecimalSupported = 1;

IF (@VarDecimalSupported > 0)
    BEGIN
        EXECUTE sp_db_vardecimal_storage_format N'$(DatabaseName)', 'ON';
    END


GO
PRINT N'Update complete.';


GO
