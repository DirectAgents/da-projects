@model System.Linq.IGrouping<PaymentGroup, EomTool.Domain.Entities.PublisherPayment>
@{
    PaymentsViewModel pvm = ViewBag.PaymentsViewModel;
    var iGroup = ViewData["iGroup"];
    int iPayment = 0;
    var payoutTotal = Model.Sum(p => p.PubPayout);
}

<table style="border:solid">
<caption style="text-align:left">@Model.Key.Currency | @Model.Key.PaymentMethod | @Model.Key.NetTermType</caption>
@foreach (var payment in Model.OrderBy(p => p.Publisher))
{
<tr>
    <td>@payment.AccountingPeriod</td>
    <td><a href="#" onclick="ShowPubRep('@payment.Publisher', '@payment.AccountingPeriod'); return false">@payment.Publisher</a></td>
    <td style="text-align:right">@Html.FormatCurrency(payment.PubPayCurr, payment.PubPayout.Value)</td>
    <td><a href="#" onclick="ShowNotes('@payment.Publisher');return false">notes</a></td>
    <td id="actionarea@(iGroup)_@(iPayment)">
        @using (Html.BeginForm("ReleaseItems", "PaymentBatches", FormMethod.Post, new { id = "form" + iGroup + "_" + iPayment }))
        {
            <input type="hidden" name="acctperiod" value="@payment.AccountingPeriod" />
            <input type="hidden" name="itemids" value="@payment.ItemIds" />
            if (payment.AccountingStatusId == ItemAccountingStatus.CheckSignedAndPaid) {
                <text>Release</text>
            } else {
                <a href="#" onclick="if (confirm('Press OK to confirm Release')) ReleasePayment('@(iGroup +"_"+ iPayment)'); return false">Release</a>
            }
            if (pvm.AllowHold) {
                if (payment.AccountingStatusId == ItemAccountingStatus.Hold) {
                    <text>Hold</text>
                } else {
                    <a href="#" onclick="ShowNotesForHold('@payment.Publisher', '@(iGroup +"_"+ iPayment)'); return false">Hold</a>
                }
            }
            if (pvm.Test == "all") {
                <a href="#" onclick="if (confirm('Press OK to confirm Reset')) ResetPayment('@(iGroup +"_"+ iPayment)'); return false">Reset</a>
            }
        }
    </td>
@if (pvm.Test == "all") {
    <td>@payment.PaymentBatchId</td>
    <td id="statusarea@(iGroup)_@(iPayment)">@payment.AccountingStatus.Substring(0, 4)</td>
}
</tr>
    iPayment++;
}
<tr>
    <td></td>
    <td style="font-weight:bold">TOTAL</td>
    <td style="font-weight:bold">@Html.FormatCurrency(Model.Key.Currency, payoutTotal.Value)</td>
    <td></td>
    <td>@if(Model.Count() > 1){
            <a href="#" onclick="if (confirm('Press OK to confirm Release All')) ReleaseAll(@iGroup, @Model.Count()); return false">Release All</a>
    }</td>
@if (pvm.Test == "all") {
    <td></td>
    <td></td>
}
</tr>
</table>
