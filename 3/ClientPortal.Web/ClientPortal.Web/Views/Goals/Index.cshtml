@model ClientPortal.Web.Models.GoalsModel

<h3>Goals</h3>

<div id="divGoalsList">
@Html.Partial("List", Model.Goals)
</div>

<div id="divActions">
    @Ajax.ActionLink("Add Goal", "Add", "Goals",
                     new AjaxOptions
                         {
                             InsertionMode = InsertionMode.Replace, UpdateTargetId = "windowGoal", HttpMethod = "GET",
                             OnBegin = "BeginAddGoal",
                             OnSuccess = "EnableValidation('#addGoalWrapper')"
                         })
    | <a href="#" onclick="RefreshGoalsList(); return false">Refresh</a>
</div>

<script>
    //TODO: move this to common script if used again
    function EnableValidation(selector) {
        $.validator.unobtrusive.parse($(selector));
    }

    function RefreshGoalsList() {
        var url = '@Url.Action("List")';
        $('#divGoalsList').load(url);
    }

    function BeginAddGoal() {
        var win = $('#windowGoal').data("kendoWindow");
        win.setOptions({ width: 600, height: 500 });
        win.center();
        win.open();
    }

    function AddGoalSuccess() {
        RefreshGoalsList();
        $('#windowGoal').data("kendoWindow").close();
    }

    $(function () {
        $('#windowGoal').kendoWindow({
            title: "Goal",
            visible: false,
            modal: true
        });
    });
</script>

<div id="windowGoal"></div>
