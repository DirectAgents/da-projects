<div class="chart-wrapper">
    <div id="spendChart"></div>
</div>
<div class="chart-wrapper">
    <div id="spendLineChart"></div>
</div>

<script>
    function CreateSpendChart(value, valueFormat, culture, catName, height) {
        kendo.culture(culture);
        $("#spendChart").kendoChart({
            chartArea: {
                height: height
            },
            legend: {
                visible: false
            },
            seriesDefaults: {
                type: "bar"
            },
            series: [{
                data: [value]
            }],
            valueAxis: {
                labels: { format: valueFormat, step: 2 }
            },
            categoryAxis: {
                categories: [catName]
            },
            tooltip: {
                visible: true,
                format: valueFormat
            }
        });
    }
    function UpdateSpendChartValue(value) {
        var chart = $('#spendChart').data('kendoChart');
        chart.options.series[0].data = [value];
        chart.redraw();
    }

    function CreateDailySpendDataSource(url)
    {
        return new kendo.data.DataSource({
            transport: {
                read: {
                    type: 'post',
                    dataType: 'json',
                    url: url,
                    data: function () {
                        return {
                            startdate: $('#dash_startdate').val(),
                            enddate: $('#dash_enddate').val()
                        };
                    }
                }
            },
            schema: {
                data: 'data',
                total: 'total',
                model: {
                    id: 'Id',
                    fields: {
                        Date: { type: 'date' },
                        Impressions: { type: 'number' },
                        Clicks: { type: 'number' },
                        Conversions: { type: 'number' },
                        ConversionPct: { type: 'number' },
                        Revenue: { type: 'number' },
                        EPC: { type: 'number' }
                    }
                }
            },
            sort: { field: "Date", dir: "asc" },
            aggregate: [
                { field: "Revenue", aggregate: "sum" }
            ]
        });
    }
    function CreateSpendLineChart(dataSource, title, height)
    {
        $("#spendLineChart").kendoChart({
            dataSource: dataSource,
            autoBind: false,
            chartArea: {
                height: height
            },
            series: [
                {
                    type: "line",
                    field: "Revenue",
                    name: "Daily Spend",
                    axis: "spend"
                }
            ],
            categoryAxis: {
                baseUnit: "days",
                field: "Date",
                labels: { rotation: -90 }
            },
            valueAxis: [
                {
                    name: "spend",
                    labels: { format: "C", step: 2 },
                    title: { text: title }
                }
            ],
            legend: {
                visible: false
            },
            tooltip: {
                visible: true,
                format: "C",
                template: "#= kendo.format('{0:d}',category) #: #= kendo.format('{0:C}',value) #"
            }
        });
    }
    function UpdateSpendLineChart() {
        var chart = $('#spendLineChart').data('kendoChart');
        var spark = false;
        if (chart.dataSource.total() > 62)
            spark = true;
        if (spark) {
            chart.options.categoryAxis.labels.visible = false;
        } else {
            chart.options.categoryAxis.labels.visible = true;
        }
        chart.redraw();
    }

    function CreateWeeklySpendBarChart(divId, dataSource, height)
    {
        $("#" + divId).kendoChart({
            dataSource: dataSource,
            autoBind: false,
            chartArea: {
                height: height
            },
            series: [
                {
                    type: "column",
                    aggregate: "sum",
                    field: "Revenue",
                    axis: "spend"
                }
            ],
            categoryAxis: {
                baseUnit: "weeks",
                field: "Date",
                title: { text: "Week of..." }
            },
            valueAxis: [
                {
                    name: "spend",
                    labels: { format: "C", step: 2 }
                }
            ],
            legend: {
                visible: false
            },
            tooltip: {
                visible: true,
                format: "C"
            }
        });
    }
    function SetSpendBarChartBaseUnit(divId, baseUnit) {
        var chart = $('#' + divId).data('kendoChart');
        var catAxis = chart.options.categoryAxis;
        catAxis.baseUnit = baseUnit;
        if (baseUnit == 'weeks') {
            catAxis.title.text = "Week of...";
            catAxis.title.visible = true;
        } else {
            catAxis.title.visible = false;
        }
        chart.redraw();
    }

    function CreateMonthlySpendDataSource(url, startdate, enddate) {
        return new kendo.data.DataSource({
            pageSize: 24,
            transport: {
                read: {
                    type: 'post',
                    dataType: 'json',
                    url: url,
                    data: function () {
                        return {
                            startdate: $('#dash_startdate').val(),
                            enddate: $('#dash_enddate').val()
                        };
                    }
                }
            },
            schema: {
                data: 'data',
                total: 'total',
                model: {
                    id: 'Id',
                    fields: {
                        Year: { type: 'number' },
                        Month: { type: 'number' },
                        Period: { type: 'date' },
                        Revenue: { type: 'number' },
                    }
                }
            },
            sort: { field: "Period", dir: "asc" }
        });
    }

    function CreateMonthlySpendBarChart(divId, dataSource, height) {
        $("#" + divId).kendoChart({
            dataSource: dataSource,
            autoBind: false,
            chartArea: {
                height: height
            },
            series: [
                {
                    type: "column",
                    field: "Revenue",
                    axis: "spend"
                }
            ],
            categoryAxis: {
                field: "Period"
            },
            valueAxis: [
                {
                    name: "spend",
                    labels: { format: "C", step: 2 }
                }
            ],
            legend: {
                visible: false
            },
            tooltip: {
                visible: true,
                format: "C"
            }
        });
    }
</script>
